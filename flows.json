[{"id":"54326a95.39a714","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"b679fedf.127e3","type":"tab","label":"switch","disabled":false,"info":""},{"id":"873bdacb.594338","type":"tab","label":"Artist Menu","disabled":false,"info":""},{"id":"8a997eeb.880fd","type":"tab","label":"Buyer Menu","disabled":false,"info":""},{"id":"aa9d0df9.2dbd7","type":"tab","label":"Contact with administrator","disabled":false,"info":""},{"id":"fe29b5bc.5d8348","type":"tab","label":"Base actions","disabled":false,"info":""},{"id":"85a5817c.1b7c5","type":"ui_tab","z":"","name":"Demo Tab Name","icon":"dashboard","disabled":false,"hidden":false},{"id":"7e6baf98.69239","type":"ui_group","z":"","name":"TEXT DEMO","tab":"85a5817c.1b7c5","order":1,"disp":true,"width":"6","collapse":false},{"id":"2dab8e98.6c5e72","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"d7aa5706.65dfe8","type":"mqtt-broker","z":"","name":"","broker":"cow.rmq2.cloudamqp.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"60143c93.cf8174","type":"mqtt-broker","z":"","name":"","broker":"cow.rmq2.cloudamqp.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"321a3beb.5f6474","type":"dialogflowv2-token","z":0,"name":"pdp-ira-bot-nqgr"},{"id":"2e6cf74a.de58d8","type":"http in","z":"54326a95.39a714","name":"","url":"/webhook","method":"post","upload":false,"swaggerDoc":"","x":140,"y":120,"wires":[["56d008ad.daa428","2e2445d7.3e54fa","50556521.e82b6c"]]},{"id":"2e2445d7.3e54fa","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":110,"y":80,"wires":[]},{"id":"56d008ad.daa428","type":"http response","z":"54326a95.39a714","name":"","statusCode":"200","headers":{},"x":160,"y":160,"wires":[]},{"id":"be9cb38d.12e88","type":"function","z":"54326a95.39a714","name":"","func":"if (msg.payload && msg.payload.callback_query) {\n    msg.text = msg.payload.callback_query.data;\n    msg.chat_id = msg.payload.callback_query.from.id;\n}\n\nif (msg.payload && msg.payload.message && msg.payload.message.contact) {\n    msg.text = msg.payload.message.contact.phone_number;\n    msg.chat_id = msg.payload.message.from.id;\n} else if (msg.payload && msg.payload.message && msg.payload.message.photo) {\n    msg.text = msg.payload.message.photo[1].file_id;\n    msg.chat_id = msg.payload.message.from.id;\n} else if (msg.payload && msg.payload.message && msg.payload.message.successful_payment) {\n    msg.text = msg.payload.message.successful_payment.invoice_payload;\n    msg.chat_id = msg.payload.message.from.id;\n} else if (msg.payload && msg.payload.message) {\n    msg.text = msg.payload.message.text;\n    msg.chat_id = msg.payload.message.from.id;\n}\n\n\nmsg.originalMessage = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":140,"wires":[["62a35bc0.6c9724"]]},{"id":"62a35bc0.6c9724","type":"function","z":"54326a95.39a714","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.chat_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":140,"wires":[["dd6d2178.4f564"]]},{"id":"dd6d2178.4f564","type":"http request","z":"54326a95.39a714","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":140,"wires":[["af6ef821.924b68"]]},{"id":"af6ef821.924b68","type":"function","z":"54326a95.39a714","name":"","func":"msg.lang = msg.payload.lang;\nmsg.type = msg.payload.type;\nmsg.nickname = msg.payload.nickname;\nmsg.phone = msg.payload.phone;\nmsg.state = msg.payload.state;\nmsg.settings = msg.payload.settings;\n\n\nmsg.picture = msg.payload.picture;\nif (msg.payload.settings){\nmsg.currentViewPicture = msg.payload.settings.currentViewPicture;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":140,"wires":[["af353f47.2795b","81aa2d79.7576a"]]},{"id":"e0ffdf26.177ec","type":"switch","z":"b679fedf.127e3","name":"Artist ","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"regex","v":"((\\+38)?\\(?\\d{3}\\)?[\\s\\.-]?(\\d{7}|\\d{3}[\\s\\.-]\\d{2}[\\s\\.-]\\d{2}|\\d{3}-\\d{4}))","vt":"str","case":false},{"t":"eq","v":"uk","vt":"str"},{"t":"eq","v":"ru","vt":"str"},{"t":"eq","v":"en","vt":"str"},{"t":"eq","v":"artist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"changeTypeToBuyer","vt":"str"},{"t":"eq","v":"artActionsWithPicturesHello","vt":"str"},{"t":"eq","v":"actionsWithPictures","vt":"str"},{"t":"eq","v":"advertisingPicture","vt":"str"},{"t":"eq","v":"advertising","vt":"str"},{"t":"eq","v":"viewStatistics","vt":"str"},{"t":"eq","v":"viewApplications","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"setting","vt":"str"},{"t":"eq","v":"exhibitPicture","vt":"str"},{"t":"eq","v":"editPostOfPicture","vt":"str"},{"t":"eq","v":"deletePainting","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"},{"t":"cont","v":"categId","vt":"str"},{"t":"eq","v":"viewCreatedPost","vt":"str"},{"t":"eq","v":"moreAboutAdvertising","vt":"str"},{"t":"eq","v":"toAdvertisingPicture","vt":"str"},{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"artActionsPostPictureSize","vt":"str"},{"t":"eq","v":"artActionsPostPictureHashtags","vt":"str"},{"t":"eq","v":"advertisingPicture","vt":"str"},{"t":"eq","v":"moreAboutAdvertising","vt":"str"},{"t":"eq","v":"thisPictureForAdvertising","vt":"str"},{"t":"eq","v":"statisticByHashtags","vt":"str"},{"t":"eq","v":"statisticByPictures","vt":"str"},{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"cont","v":"deletePicture","vt":"str"},{"t":"cont","v":"deleteSelectedPicture","vt":"str"},{"t":"eq","v":"noDeleteSelectedPicture","vt":"str"},{"t":"cont","v":"editPicture","vt":"str"},{"t":"cont","v":"editCategory","vt":"str"},{"t":"cont","v":"editImage","vt":"str"},{"t":"cont","v":"editDescription","vt":"str"},{"t":"cont","v":"editSize","vt":"str"},{"t":"cont","v":"editHashtags","vt":"str"},{"t":"cont","v":"editNamePicture","vt":"str"},{"t":"eq","v":"viewEditedPost","vt":"str"},{"t":"eq","v":"backToEditPost","vt":"str"},{"t":"cont","v":"advertisePicture","vt":"str"},{"t":"eq","v":"payAdvertisingPicture","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":50,"x":850,"y":560,"wires":[["5b520799.ac1c68","f08512f5.2edce"],["2fa4c692.15b67a","f812d108.3c505"],["71f40aae.a69dd4","728bbef4.c6673"],["71f40aae.a69dd4","c0cbbe94.e45cb"],["71f40aae.a69dd4","510f1fc7.4d7e4"],[],["8c8dcc51.d0fa9"],["8c8dcc51.d0fa9","797cf1d1.f6b3f"],["869ac865.ed00b8"],["869ac865.ed00b8"],["869ac865.ed00b8","c64d4ef.76b21b"],["869ac865.ed00b8","b584cd9d.a8bc6"],["869ac865.ed00b8","96bd9c5f.24f64"],["869ac865.ed00b8","323d5422.d5eb5c"],["869ac865.ed00b8","24c1f101.5e146e"],["869ac865.ed00b8","25bfba67.6068a6"],["eb6a4e9d.7f26c","c722378c.f1d678"],["eb6a4e9d.7f26c","461e7749.c0f938"],["eb6a4e9d.7f26c"],["eb6a4e9d.7f26c"],["510419e5.0861b8","2fd759d7.458196"],["510419e5.0861b8"],[],[],["510419e5.0861b8"],["510419e5.0861b8"],["510419e5.0861b8"],["510419e5.0861b8"],["a0b90be.9637cf8"],["a0b90be.9637cf8"],["a0b90be.9637cf8"],["c80a9cfe.78211"],["c80a9cfe.78211"],["d794e3df.6af82"],["d794e3df.6af82"],["d794e3df.6af82"],["d794e3df.6af82"],["d794e3df.6af82"],["d794e3df.6af82"],["136eb217.ad073e"],["136eb217.ad073e"],["136eb217.ad073e"],["136eb217.ad073e"],["136eb217.ad073e"],["136eb217.ad073e"],["bc570903.b6ae78"],["5eff25f7.20c1bc"],["a0b90be.9637cf8"],[],["45447cab.7b1bf4","456176da.dfb858"]]},{"id":"772e2472.071adc","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":300,"wires":[[]]},{"id":"5b520799.ac1c68","type":"function","z":"b679fedf.127e3","name":"startNumberMessage","func":"msg.url = msg.messageApiHost+\"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    templateName: \"startNumberMessage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1380,"y":300,"wires":[["772e2472.071adc"]]},{"id":"7daa56a4.2f1c68","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":380,"wires":[["d1264c79.6108d"]]},{"id":"71f40aae.a69dd4","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":380,"wires":[["7daa56a4.2f1c68"]]},{"id":"af353f47.2795b","type":"link out","z":"54326a95.39a714","name":"","links":["c956b82f.666e58"],"x":1315,"y":140,"wires":[]},{"id":"c956b82f.666e58","type":"link in","z":"b679fedf.127e3","name":"","links":["af353f47.2795b"],"x":95,"y":480,"wires":[["edeaf273.21ed1","635e5f59.5606e"]]},{"id":"65213e07.1ff39","type":"function","z":"b679fedf.127e3","name":"artistMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2750,"y":520,"wires":[["58f09de9.b5ab24"]]},{"id":"58f09de9.b5ab24","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2930,"y":520,"wires":[[]]},{"id":"81aa2d79.7576a","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":100,"wires":[]},{"id":"5ac1c307.db7c6c","type":"function","z":"54326a95.39a714","name":"","func":"msg.buyerType = \"buyer\";\nmsg.artistType = \"artist\";\nmsg.delete_picture_action = 'delete_picture';\nmsg.edit_picture_action = 'edit_picture';\nmsg.advertise_picture_action = 'advertise_picture';\nmsg.byArtistSearchType = 'byArtistSearchType';\nmsg.byCategorySearchType = 'byCategorySearchType';\nmsg.bySizeSearchType = 'bySizeSearchType';\nmsg.byHashtagSearchType = 'byHashtagSearchType';\nmsg.byHistorySearchType = 'byHistorySearchType';\nmsg.byLikedSearchType = 'byLikedSearchType';\nmsg.messageApiHost = \"https://messageapi-pdp-art-bot.herokuapp.com\";\nmsg.userApiHost = \"https://userapi-pdp-art-bot.herokuapp.com\";\nmsg.imageApiHost = \"https://imageapi-pdp-art-bot.herokuapp.com\";\n//msg.state = msg.payload.state;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":140,"wires":[["be9cb38d.12e88"]]},{"id":"2a7a03e2.f8866c","type":"function","z":"b679fedf.127e3","name":"helloArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistStiker\",\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2120,"y":420,"wires":[["cbf28b76.c6f4f8"]]},{"id":"cbf28b76.c6f4f8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2310,"y":420,"wires":[["c56116e1.9855f8"]]},{"id":"dcec827a.ec07b","type":"switch","z":"b679fedf.127e3","name":"Buyer","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"changeTypeToBuyer","vt":"str"},{"t":"eq","v":"changeTypeToArtist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"searchPictures","vt":"str"},{"t":"eq","v":"searchByArtist","vt":"str"},{"t":"eq","v":"searchByCategory","vt":"str"},{"t":"eq","v":"searchBySize","vt":"str"},{"t":"eq","v":"searchByHashtag","vt":"str"},{"t":"cont","v":"artistIdSPic","vt":"str"},{"t":"cont","v":"categIdSPic","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"viewHistory","vt":"str"},{"t":"eq","v":"viewLiked","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"backToBuyerMenu","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"},{"t":"cont","v":"like","vt":"str"},{"t":"cont","v":"apply","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":20,"x":330,"y":1740,"wires":[["e946de01.d6084"],["d8658172.5a3c5"],["c2123795.ca3f28"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["74aa0be6.dee674"],["836c1127.be573"],["836c1127.be573"],["f38355d2.4a88c8"],["215d0721.62eb28"],["215d0721.62eb28"],["99a62305.e1bb6"],["99a62305.e1bb6"],["df0f91a7.18f7c"]]},{"id":"881f640.37671a","type":"link in","z":"b679fedf.127e3","name":"","links":["8c8dcc51.d0fa9","2204ff5a.f2969","574f5803.7a1418"],"x":75,"y":1740,"wires":[["dcec827a.ec07b","ec92b9bf.83c5d8"]]},{"id":"edeaf273.21ed1","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":190,"y":480,"wires":[]},{"id":"9dc2ed93.c827a","type":"function","z":"b679fedf.127e3","name":"helloArtistMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":1100,"wires":[["cad7a9dd.545648"]]},{"id":"cad7a9dd.545648","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1870,"y":1100,"wires":[["fd6d0983.c09248"]]},{"id":"276884e1.d46d9c","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2010,"y":380,"wires":[[]]},{"id":"d1264c79.6108d","type":"function","z":"b679fedf.127e3","name":"chooseWhoAreYou","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text,\n    templateName: \"chooseWhoAreYou\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1790,"y":380,"wires":[["276884e1.d46d9c"]]},{"id":"ed95a437.c899c8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":1100,"wires":[["3c619c16.0277d4"]]},{"id":"fd6d0983.c09248","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    nickname: msg.text,\n    state: \"helloArtistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":1100,"wires":[["ed95a437.c899c8"]]},{"id":"9a6b5115.8d7e7","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":340,"wires":[["73cf7600.1e6edc"]]},{"id":"2fa4c692.15b67a","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    phone: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":340,"wires":[["9a6b5115.8d7e7"]]},{"id":"c56116e1.9855f8","type":"function","z":"b679fedf.127e3","name":"artistName","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistName\",\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2490,"y":420,"wires":[["72fe3931.0439e8"]]},{"id":"72fe3931.0439e8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2670,"y":420,"wires":[["19794842.ed10a8"]]},{"id":"19794842.ed10a8","type":"function","z":"b679fedf.127e3","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artistName\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2860,"y":420,"wires":[["334390b5.92205"]]},{"id":"73cf7600.1e6edc","type":"function","z":"b679fedf.127e3","name":"succesRegistration","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"succesRegistration\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1790,"y":340,"wires":[["efd6030a.d041e"]]},{"id":"efd6030a.d041e","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2010,"y":340,"wires":[["653cd022.89bd7"]]},{"id":"e47bdcf0.e14c8","type":"function","z":"b679fedf.127e3","name":"chooseLanguage","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"chooseLanguage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2650,"y":340,"wires":[["91b04b34.a971f8"]]},{"id":"91b04b34.a971f8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2830,"y":340,"wires":[[]]},{"id":"653cd022.89bd7","type":"function","z":"b679fedf.127e3","name":"succesRegistrationStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"succesRegistrationStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2230,"y":340,"wires":[["c1dc5f2.162baa"]]},{"id":"c1dc5f2.162baa","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2450,"y":340,"wires":[["e47bdcf0.e14c8"]]},{"id":"334390b5.92205","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3030,"y":420,"wires":[["2367d439.4fd5dc"]]},{"id":"2367d439.4fd5dc","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3210,"y":420,"wires":[]},{"id":"45447cab.7b1bf4","type":"switch","z":"b679fedf.127e3","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"artistName","vt":"str"},{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"addPictureSize","vt":"str"},{"t":"eq","v":"addPictureHashtags","vt":"str"},{"t":"eq","v":"addPictureName","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"cont","v":"editPostCategory","vt":"str"},{"t":"cont","v":"editPostImage","vt":"str"},{"t":"cont","v":"editPostDescription","vt":"str"},{"t":"cont","v":"editPostSize","vt":"str"},{"t":"cont","v":"editPostHashtags","vt":"str"},{"t":"cont","v":"editPostName","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"},{"t":"eq","v":"startNumberMessage","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":16,"x":1070,"y":1200,"wires":[["511d1e6f.2beed"],["691e3a32.a55a24"],["691e3a32.a55a24"],["691e3a32.a55a24"],["691e3a32.a55a24"],["691e3a32.a55a24"],["a3437c1e.4ec7c"],["1e8953f0.82cd7c"],["1e8953f0.82cd7c"],["e68e3a0e.a40148"],["e68e3a0e.a40148"],["e68e3a0e.a40148"],["e68e3a0e.a40148"],["1e8953f0.82cd7c"],["581a4d7a.1aea24"],["1ac28f58.55a621"]]},{"id":"511d1e6f.2beed","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    // nickname: msg.text,\n    nickname: msg.originalMessage.message.text\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1100,"wires":[["e53e41e2.e913f"]]},{"id":"e53e41e2.e913f","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1490,"y":1100,"wires":[["9dc2ed93.c827a"]]},{"id":"869ac865.ed00b8","type":"link out","z":"b679fedf.127e3","name":"Artist Menu","links":["b8fcc20d.781f"],"x":1190,"y":560,"wires":[],"l":true},{"id":"38fed8b7.7bc2a8","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"artActionsWithPicturesHello","vt":"str"},{"t":"eq","v":"actionsWithPictures","vt":"str"},{"t":"eq","v":"advertising","vt":"str"},{"t":"eq","v":"viewStatistics","vt":"str"},{"t":"eq","v":"viewApplications","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"setting","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":310,"y":320,"wires":[["d6ebb52e.f556d8","1678fbec.f5aee4"],["e8604ad0.dbc038","8948a095.e6f6c"],["89e972fd.f4405","b0fbbc5f.e6557"],["dbac5a57.7ef848","9d448f4a.51da5"],["8f74fe5a.d27af","c0da844.590da78"],["641837f4.7a2f78","9837332.8ab5bd"],["8a778b20.682dc8","2435a6b.0b23f5a"]]},{"id":"b8fcc20d.781f","type":"link in","z":"873bdacb.594338","name":"","links":["869ac865.ed00b8"],"x":155,"y":320,"wires":[["38fed8b7.7bc2a8"]]},{"id":"e8604ad0.dbc038","type":"function","z":"873bdacb.594338","name":"artActionsWithPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithPictures\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":160,"wires":[["4dbf1e3a.f9be"]]},{"id":"4dbf1e3a.f9be","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":850,"y":160,"wires":[[]]},{"id":"eb6a4e9d.7f26c","type":"link out","z":"b679fedf.127e3","name":"Actions with pictures","links":["5617c1e2.2f6c6"],"x":1220,"y":600,"wires":[],"l":true},{"id":"5617c1e2.2f6c6","type":"link in","z":"873bdacb.594338","name":"","links":["eb6a4e9d.7f26c","ffce86a9.8fcaa8"],"x":155,"y":1020,"wires":[["f61e5696.d0f028"]]},{"id":"f61e5696.d0f028","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"exhibitPicture","vt":"str"},{"t":"eq","v":"editPostOfPicture","vt":"str"},{"t":"eq","v":"deletePainting","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":310,"y":1020,"wires":[["7fa7b09.158b75","f6d581b4.d2a79"],["b27bbfa6.1f569","7ce40b74.401894"],["4a7f6e65.9277b","ef450874.c03c38"],["da2c8ab4.64f668"]]},{"id":"17adb43.e4bd34c","type":"function","z":"873bdacb.594338","name":"artActionsPostPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPicture\",\n    templateVars: {\n      categories: msg.categories,  \n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":860,"wires":[["9619d988.13d628"]]},{"id":"9619d988.13d628","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1490,"y":860,"wires":[["2cd55850.d86358"]]},{"id":"76c4af56.221ee","type":"comment","z":"873bdacb.594338","name":"Actions with pictures","info":"","x":240,"y":940,"wires":[]},{"id":"8192b2c3.1dd61","type":"comment","z":"873bdacb.594338","name":"Artist Menu","info":"","x":210,"y":240,"wires":[]},{"id":"89e972fd.f4405","type":"function","z":"873bdacb.594338","name":"artAdvertising","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertising\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":260,"wires":[["79e802e3.ada57c"]]},{"id":"79e802e3.ada57c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":810,"y":260,"wires":[["b98dfd57.b08df"]]},{"id":"dbac5a57.7ef848","type":"function","z":"873bdacb.594338","name":"artViewStatistics","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artViewStatistics\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":360,"wires":[["5dc5a637.b025d8"]]},{"id":"8f74fe5a.d27af","type":"function","z":"873bdacb.594338","name":"artActionsWithPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithPictures\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":460,"wires":[["1283a48d.a3d1eb"]]},{"id":"1283a48d.a3d1eb","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":850,"y":460,"wires":[[]]},{"id":"641837f4.7a2f78","type":"function","z":"873bdacb.594338","name":"contactWithAdministratorStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"contactWithAdministratorStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":560,"wires":[["e1202d2f.95e9d"]]},{"id":"e1202d2f.95e9d","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":560,"wires":[["ddccc4df.3e6e88"]]},{"id":"1d71e531.7608ab","type":"function","z":"873bdacb.594338","name":"changeTypeToBuyer","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    //templateName: \"changeWhoAreYou\"\n    templateName: \"changeTypeToBuyer\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":660,"wires":[["9d42bec2.88cf2"]]},{"id":"9d42bec2.88cf2","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":660,"wires":[["635046ad.368b98"]]},{"id":"da2c8ab4.64f668","type":"function","z":"873bdacb.594338","name":"artistMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1300,"wires":[["21d562ce.55150e"]]},{"id":"21d562ce.55150e","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":1300,"wires":[["e44ef84e.5bb858"]]},{"id":"8e433eeb.e7138","type":"function","z":"873bdacb.594338","name":"artistMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":1540,"wires":[["5a8e81ea.d685c"]]},{"id":"5a8e81ea.d685c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2130,"y":1540,"wires":[[]]},{"id":"f251784d.4708f8","type":"function","z":"873bdacb.594338","name":"перелік картин -карусель","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2720,"y":760,"wires":[["d33dd8f7.f1ac28"]]},{"id":"d33dd8f7.f1ac28","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2950,"y":760,"wires":[[]]},{"id":"a0a3dd03.fe369","type":"comment","z":"873bdacb.594338","name":"Post Picture","info":"","x":190,"y":1700,"wires":[]},{"id":"dbb55b50.7b1928","type":"link in","z":"873bdacb.594338","name":"","links":["510419e5.0861b8","691e3a32.a55a24"],"x":135,"y":1800,"wires":[["ca5e2162.c6d6f"]]},{"id":"ca5e2162.c6d6f","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"categId","vt":"str"},{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"artActionsPostPictureSize","vt":"str"},{"t":"eq","v":"artActionsPostPictureHashtags","vt":"str"},{"t":"eq","v":"viewCreatedPost","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":290,"y":1800,"wires":[["27fe366d.028afa","134b9a16.817176"],["27fe366d.028afa"],["b648b794.1ec4c8","c14ec69b.0a2468"],["b0f5a28b.1c2c8","4e9bba3d.330514"],["1adec588.c1154a","4f0ce570.701c8c"],["814d5732.0fcda8","91c8e521.2dac68"],["a0883127.0e2c1","16de86b9.cf1e29"]]},{"id":"27fe366d.028afa","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureImage","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureImage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1500,"wires":[["84d6ccd3.68833"]]},{"id":"84d6ccd3.68833","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1010,"y":1500,"wires":[["2d3202a5.0bb84e"]]},{"id":"510419e5.0861b8","type":"link out","z":"b679fedf.127e3","name":"Post Picture","links":["dbb55b50.7b1928"],"x":1190,"y":640,"wires":[],"l":true},{"id":"2e2a51f8.c3b21e","type":"comment","z":"873bdacb.594338","name":"1 ❤️ треба записувати в бд дану категорію картин","info":"","x":1000,"y":1460,"wires":[]},{"id":"2d3202a5.0bb84e","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.chosed_category_id = msg.text.split('_')[1];\nmsg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artActionsPostPictureImage\",\n    settings: {\n        chosed_category_id: msg.chosed_category_id,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":1500,"wires":[["5d2b3cbd.09b194"]]},{"id":"5d2b3cbd.09b194","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1500,"wires":[[]]},{"id":"691e3a32.a55a24","type":"link out","z":"b679fedf.127e3","name":"to artist menu","links":["dbb55b50.7b1928"],"x":1340,"y":1140,"wires":[],"l":true},{"id":"28c12a3a.bfac36","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureDescript","func":"msg.picture = msg.payload;\nmsg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDescript\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1620,"wires":[["1fcbe4bd.09dcbb"]]},{"id":"1fcbe4bd.09dcbb","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":1620,"wires":[["66c40aa4.36fb34"]]},{"id":"66c40aa4.36fb34","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artActionsPostPictureDescript\",\n    settings: {\n        picture_id: msg.picture.id\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":1620,"wires":[["551b7858.d43a38"]]},{"id":"551b7858.d43a38","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":1620,"wires":[[]]},{"id":"a0883127.0e2c1","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"addPictureSize","vt":"str"},{"t":"eq","v":"addPictureHashtags","vt":"str"},{"t":"eq","v":"addPictureName","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":6,"x":470,"y":2180,"wires":[["285d1fee.0a84a","ae60fe3.cc54"],["7ca6204e.90294","ab106b7.1919d98"],["6c22d7ae.196248","b96b99b2.62f758"],["35f6bd26.78a122","8ec9accf.0b5f6"],["d5882533.57aed8","273d90f2.2c657"],[]]},{"id":"b0f5a28b.1c2c8","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureSize","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureSize\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1740,"wires":[["acf0cb79.6db0b8"]]},{"id":"acf0cb79.6db0b8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":990,"y":1740,"wires":[["e48f09f1.304d48"]]},{"id":"e48f09f1.304d48","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"addPictureSize\",\n    settings: {\n        picture_id: msg.picture.id\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":1740,"wires":[["3dbc5aec.49bc66"]]},{"id":"3dbc5aec.49bc66","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1330,"y":1740,"wires":[[]]},{"id":"1adec588.c1154a","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureHashtags","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureHashtags\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1860,"wires":[["501324ef.933d3c"]]},{"id":"501324ef.933d3c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":1860,"wires":[["6d7bb44f.ff64ec"]]},{"id":"6d7bb44f.ff64ec","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"addPictureHashtags\",\n    settings: {\n        picture_id: msg.picture.id\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":1860,"wires":[["9ce06343.74fa3"]]},{"id":"9ce06343.74fa3","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":1860,"wires":[[]]},{"id":"68234734.09ae58","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureDoneText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDoneText\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1430,"y":2620,"wires":[["36de3185.0400de"]]},{"id":"36de3185.0400de","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1670,"y":2620,"wires":[["8395e9bb.4dcb08"]]},{"id":"8395e9bb.4dcb08","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureDoneStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDoneStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":2620,"wires":[["f24c4e8e.1d4c1"]]},{"id":"f24c4e8e.1d4c1","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2170,"y":2620,"wires":[["f2bb0653.2a1a78"]]},{"id":"de9bd35e.a5fda","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureCreated","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureCreated\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags:msg.picture.hashtags ? '#' + msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1790,"y":1980,"wires":[["5aed253.ed04ddc"]]},{"id":"5aed253.ed04ddc","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2030,"y":1980,"wires":[["12d52cc4.a432b3"]]},{"id":"f2bb0653.2a1a78","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureDoneView","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDoneView\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2410,"y":2620,"wires":[["36569183.5025ce"]]},{"id":"36569183.5025ce","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2650,"y":2620,"wires":[["c17d1fef.f97ee"]]},{"id":"2fd759d7.458196","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":260,"wires":[]},{"id":"134b9a16.817176","type":"debug","z":"873bdacb.594338","name":"121","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1460,"wires":[]},{"id":"9abfe6b.649bc18","type":"comment","z":"873bdacb.594338","name":"Edit Post","info":"","x":240,"y":4100,"wires":[]},{"id":"7aa568c1.0f5e28","type":"comment","z":"873bdacb.594338","name":"Action With Post","info":"","x":220,"y":3020,"wires":[]},{"id":"12d52cc4.a432b3","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureCreatedMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureCreatedMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":1980,"wires":[["53589876.fe77f8"]]},{"id":"53589876.fe77f8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2530,"y":1980,"wires":[[]]},{"id":"d6ebb52e.f556d8","type":"function","z":"873bdacb.594338","name":"artActionsWithPicturesHello","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithPicturesHello\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":60,"wires":[["1f68fd36.97bc03"]]},{"id":"1f68fd36.97bc03","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":60,"wires":[[]]},{"id":"36adb7ff.268888","type":"function","z":"873bdacb.594338","name":"artDeletePictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeletePictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2410,"y":1240,"wires":[["8bce843.eaafd78"]]},{"id":"8bce843.eaafd78","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2610,"y":1240,"wires":[["28155f43.e1f96"]]},{"id":"87b21d73.bf096","type":"comment","z":"873bdacb.594338","name":"нема ще картин в художника","info":"","x":1510,"y":1100,"wires":[]},{"id":"2204ff5a.f2969","type":"link out","z":"b679fedf.127e3","name":"","links":["881f640.37671a"],"x":755,"y":600,"wires":[]},{"id":"780781bb.ea5b","type":"function","z":"b679fedf.127e3","name":"helloArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtist\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":420,"wires":[["237820f3.d36df"]]},{"id":"237820f3.d36df","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":420,"wires":[["b77078bf.0fa388"]]},{"id":"dc68750e.538b68","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1930,"y":420,"wires":[["2a7a03e2.f8866c"]]},{"id":"b77078bf.0fa388","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1760,"y":420,"wires":[["dc68750e.538b68"]]},{"id":"c219d213.ddc47","type":"function","z":"b679fedf.127e3","name":"helloArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1560,"wires":[["da6c5255.328c4"]]},{"id":"f035850a.c7f4b8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1560,"wires":[["c219d213.ddc47"]]},{"id":"19ac8857.e7e038","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1600,"wires":[["597cd3af.4b255c"]]},{"id":"e946de01.d6084","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.buyerType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1600,"wires":[["19ac8857.e7e038"]]},{"id":"da6c5255.328c4","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1510,"y":1560,"wires":[["a2a4710d.91c8b"]]},{"id":"ec92b9bf.83c5d8","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":170,"y":1720,"wires":[]},{"id":"3c619c16.0277d4","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2370,"y":1100,"wires":[]},{"id":"a2a4710d.91c8b","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1670,"y":1560,"wires":[]},{"id":"6872b79.f316348","type":"switch","z":"b679fedf.127e3","name":"","property":"type","propertyType":"msg","rules":[{"t":"eq","v":"artistType","vt":"msg"},{"t":"eq","v":"buyerType","vt":"msg"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":580,"wires":[["e0ffdf26.177ec"],["2204ff5a.f2969"]]},{"id":"8c8dcc51.d0fa9","type":"link out","z":"b679fedf.127e3","name":"buyer","links":["881f640.37671a"],"x":1170,"y":500,"wires":[],"l":true},{"id":"f08512f5.2edce","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":20,"wires":[]},{"id":"f812d108.3c505","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":60,"wires":[]},{"id":"728bbef4.c6673","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":100,"wires":[]},{"id":"c0cbbe94.e45cb","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":140,"wires":[]},{"id":"510f1fc7.4d7e4","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":180,"wires":[]},{"id":"797cf1d1.f6b3f","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2108.5714721679688,"y":302.857177734375,"wires":[]},{"id":"c64d4ef.76b21b","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":20,"wires":[]},{"id":"b584cd9d.a8bc6","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":60,"wires":[]},{"id":"96bd9c5f.24f64","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":100,"wires":[]},{"id":"323d5422.d5eb5c","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":140,"wires":[]},{"id":"24c1f101.5e146e","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":180,"wires":[]},{"id":"25bfba67.6068a6","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":220,"wires":[]},{"id":"c722378c.f1d678","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":260,"wires":[]},{"id":"461e7749.c0f938","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":300,"wires":[]},{"id":"57c62bae.9c9194","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":2100,"wires":[["80218d5a.31d65"]]},{"id":"1d6a761a.46d98a","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = \"https://api.telegram.org/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":2100,"wires":[["57c62bae.9c9194"]]},{"id":"16de86b9.cf1e29","type":"debug","z":"873bdacb.594338","name":"6","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":2100,"wires":[]},{"id":"3a27e663.ebfe4a","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1530,"y":2100,"wires":[["417afa8d.ea9374"]]},{"id":"80218d5a.31d65","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    artist_id: msg.chat_id,\n    category_id: msg.settings.chosed_category_id,\n    //externalPictureUrl: \"https://api.telegram.org/file/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/\"+msg.payload.result.file_path,\n    externalPictureUrl: \"https://api.telegram.org/file/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/\"+msg.payload.result.file_path,\n\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":2100,"wires":[["3a27e663.ebfe4a"]]},{"id":"255da93f.91e096","type":"function","z":"873bdacb.594338","name":"artActionsPostPictureName","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureName\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1580,"y":2480,"wires":[["3842933b.45893c"]]},{"id":"3842933b.45893c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1810,"y":2480,"wires":[["a288fd7f.8d0af"]]},{"id":"a288fd7f.8d0af","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"addPictureName\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":2480,"wires":[["dd48128f.271af"]]},{"id":"dd48128f.271af","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":2480,"wires":[[]]},{"id":"9841a3cf.6aa63","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":2240,"wires":[["6e06d2b7.851c7c"]]},{"id":"e48edd43.2a0e6","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    description: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":2240,"wires":[["9841a3cf.6aa63"]]},{"id":"34ad9291.90f6ee","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1790,"y":2400,"wires":[["dec980cc.3c5a2"]]},{"id":"812c3aa2.9d0e98","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.size = msg.text.split(\"-\");\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    //height: msg.text.split('-')[0],\n    //width: msg.text.split('-')[1]\n    height: msg.size[0],\n    width: msg.size[1]\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":2400,"wires":[["34ad9291.90f6ee"]]},{"id":"ac380e33.c7c1b","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":2480,"wires":[["255da93f.91e096"]]},{"id":"1e7a8e67.bede12","type":"function","z":"873bdacb.594338","name":"","func":"let text = msg.text;\n\n//text = text.replace(/\\s/g, '');\n\ntext = text.replace(/# /g, \"#\");\n\ntext = text.replace(',', \"\");\n\nif(text[0] == '#') {\ntext = text.substring(1, text.length);\nconsole.log(text);\n}\n\nmsg.hashtags = text.split('#');\n\nreturn msg;\n//msg.picture.hashtags = msg.picture.hashtags.replace(/# /g, \"#\");","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":2480,"wires":[["6b66068.1b307f8"]]},{"id":"ddccc4df.3e6e88","type":"function","z":"873bdacb.594338","name":"contactWithAdministrator","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"contactWithAdministrator\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":560,"wires":[["6d1c975d.e85b78"]]},{"id":"6d1c975d.e85b78","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":560,"wires":[["ceaa44fd.25f3c8"]]},{"id":"ceaa44fd.25f3c8","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"contactWithAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":560,"wires":[["63106b81.eac324"]]},{"id":"63106b81.eac324","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":560,"wires":[[]]},{"id":"a3437c1e.4ec7c","type":"link out","z":"b679fedf.127e3","name":"to contact with administrator","links":["1fdc624a.7065ee"],"x":1380,"y":1180,"wires":[],"l":true},{"id":"43251307.a9a41c","type":"function","z":"aa9d0df9.2dbd7","name":"Set user text to payload","func":"msg.payload = msg.text;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":260,"wires":[["8bef2357.2d37f"]]},{"id":"c8225250.c0788","type":"function","z":"aa9d0df9.2dbd7","name":"Set Dialogflow responce to msg.answer","func":"msg.answer = msg._dialogflow.fulfillmentText;\nmsg.intent = msg._dialogflow.intent.displayName;\n//msg.prevState = msg.user.state;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":260,"wires":[["d99a1ea5.609a6"]]},{"id":"d99a1ea5.609a6","type":"function","z":"aa9d0df9.2dbd7","name":"","func":"msg.intent = msg._dialogflow.intent.displayName;\nif(msg.intent === \"Greetings\") {\n    msg.state = \"nlp_welcome\"\n}\nelse if(msg.intent === \"Додати категорію\") {\n    msg.state = \"nlp_addCategory\"\n}\nelse if(msg.intent === \"Кількість на рекламу\") {\n    msg.state = \"nlp_quantityForAdvertising\"\n}\nelse if(msg.intent === \"Не публікується\") {\n    msg.state = \"nlp_notPublishing\"\n}\nelse if(msg.intent === \"Не публікується - yes\") {\n    msg.state = \"nlp_notPublishing_yes\"\n}\nelse if(msg.state == \"nlp_notPublishing\") {\n    msg.intent === \"Не публікується - yes\";\n    msg.state = \"nlp_notPublishing_yes\"\n}\nelse if(msg.intent === \"Не рекламується\") {\n    msg.state = \"nlp_notAdvertising\"\n}\nelse if(msg.intent === \"Охоплення поста\") {\n    msg.state = \"nlp_сoverageOfPost\"\n}\nelse if(msg.intent === \"Попит\") {\n    msg.state = \"nlp_demand\"\n}\nelse if(msg.intent === \"Реклама\") {\n    msg.state = \"nlp_advertising\"\n}\nelse if(msg.intent === \"Час реклами\") {\n    msg.state = \"nlp_advertisingTime\"\n}\nelse if(msg.intent === \"Що публікується\") {\n    msg.state = \"nlp_whatIsPublishing\"\n}\nelse if(msg.intent === \"Що рекламується\") {\n    msg.state = \"nlp_whatIsAdvertising\"\n}\nelse if(msg.intent === \"До побачення\") {\n    msg.state = \"nlp_goodbye\"\n}\nelse if(msg.intent === \"Подяка\") {\n    msg.state = \"nlp_thank_you\"\n}\nelse if(msg.intent === \"Підтвердження\") {\n    msg.state = \"nlp_yes\"\n}\nelse if(msg.intent === \"Заперечення\") {\n    msg.state = \"nlp_no\"\n}\nelse if(msg.intent === \"Default Fallback Intent\") {\n    msg.state = \"nlp_noIntent\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":260,"wires":[["d4045504.f5d7a8"]]},{"id":"9f96171c.bd0fe8","type":"function","z":"aa9d0df9.2dbd7","name":"helloArtistMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1900,"y":180,"wires":[["c9f68720.2b6478"]]},{"id":"c9f68720.2b6478","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2090,"y":180,"wires":[["f040ebcb.19e088"]]},{"id":"d4045504.f5d7a8","type":"switch","z":"aa9d0df9.2dbd7","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"nlp_welcome","vt":"str"},{"t":"eq","v":"nlp_addCategory","vt":"str"},{"t":"eq","v":"nlp_quantityForAdvertising","vt":"str"},{"t":"eq","v":"nlp_notPublishing","vt":"str"},{"t":"eq","v":"nlp_notPublishing_yes","vt":"str"},{"t":"eq","v":"nlp_notAdvertising","vt":"str"},{"t":"eq","v":"nlp_сoverageOfPost","vt":"str"},{"t":"eq","v":"nlp_demand","vt":"str"},{"t":"eq","v":"nlp_advertising","vt":"str"},{"t":"eq","v":"nlp_advertisingTime","vt":"str"},{"t":"eq","v":"nlp_whatIsPublishing","vt":"str"},{"t":"eq","v":"nlp_whatIsAdvertising","vt":"str"},{"t":"eq","v":"nlp_yes","vt":"str"},{"t":"eq","v":"nlp_noIntent","vt":"str"},{"t":"eq","v":"nlp_goodbye","vt":"str"},{"t":"eq","v":"nlp_no","vt":"str"},{"t":"eq","v":"nlp_thank_you","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":18,"x":1270,"y":260,"wires":[["571d206a.d9535","52cefedb.8b06"],["a7b8f140.0bcf4","52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["52cefedb.8b06"],["cf3a9ecd.6a09"],["cf3a9ecd.6a09"],["52cefedb.8b06"],["b27d0085.fed65","cf3a9ecd.6a09"]]},{"id":"d792022.0a80c","type":"function","z":"aa9d0df9.2dbd7","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    nickname: msg.text,\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":180,"wires":[["6f7c096c.92a5d8"]]},{"id":"6f7c096c.92a5d8","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":180,"wires":[["9f96171c.bd0fe8"]]},{"id":"571d206a.d9535","type":"debug","z":"aa9d0df9.2dbd7","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":140,"wires":[]},{"id":"a7b8f140.0bcf4","type":"debug","z":"aa9d0df9.2dbd7","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":220,"wires":[]},{"id":"b27d0085.fed65","type":"debug","z":"aa9d0df9.2dbd7","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":440,"wires":[]},{"id":"f040ebcb.19e088","type":"debug","z":"aa9d0df9.2dbd7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":180,"wires":[]},{"id":"cb54b513.07aa38","type":"debug","z":"aa9d0df9.2dbd7","name":"Dialogflow","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":570,"y":220,"wires":[]},{"id":"1fdc624a.7065ee","type":"link in","z":"aa9d0df9.2dbd7","name":"","links":["a3437c1e.4ec7c","28b487fc.15e448"],"x":155,"y":260,"wires":[["43251307.a9a41c"]]},{"id":"4a11693d.e996d8","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2050,"y":280,"wires":[["3d99d48b.dfa9dc"]]},{"id":"52cefedb.8b06","type":"function","z":"aa9d0df9.2dbd7","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\n\nmsg.payload = {\n    chat_id: msg.chat_id,\n    \n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":280,"wires":[["56e8f104.4e84c"]]},{"id":"56e8f104.4e84c","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":280,"wires":[["2effb856.846b58"]]},{"id":"2effb856.846b58","type":"function","z":"aa9d0df9.2dbd7","name":"","func":"msg.url = \"https://api.telegram.org/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/sendMessage\";\nmsg.method = \"POST\";\n\nlet answ = msg.answer.split(\"\\n\")\n\nif(msg.lang == \"uk\") {\n    msg.answ = answ[0]\n}\nelse if(msg.lang == \"ru\") {\n    msg.answ = answ[1]\n}\nelse msg.answ = answ[2]\n\nmsg.payload = {\n    \"text\": msg.answ,\n    \"chat_id\": msg.chat_id,\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":280,"wires":[["4a11693d.e996d8"]]},{"id":"3d99d48b.dfa9dc","type":"debug","z":"aa9d0df9.2dbd7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2210,"y":280,"wires":[]},{"id":"9e4bd31a.bd212","type":"function","z":"aa9d0df9.2dbd7","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\n\nmsg.payload = {\n    chat_id: msg.chat_id,\n    \n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":380,"wires":[["90a16c67.55d3"]]},{"id":"90a16c67.55d3","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1850,"y":380,"wires":[["4796d293.b13e9c"]]},{"id":"4796d293.b13e9c","type":"function","z":"aa9d0df9.2dbd7","name":"artistMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2030,"y":380,"wires":[["c031c02e.4bf8e"]]},{"id":"c031c02e.4bf8e","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":380,"wires":[["c2c47e7f.03319"]]},{"id":"ab65b6b8.a7b2f8","type":"inject","z":"54326a95.39a714","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":340,"wires":[["d91f2c8a.358bb"]]},{"id":"d91f2c8a.358bb","type":"function","z":"54326a95.39a714","name":"","func":"msg.method = \"POST\";\nmsg.payload = {\n    \"url\": \"https://node-red-ira-art-bot.herokuapp.com/webhook\"\n};\n//msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/deleteWebhook\"\n//msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/setWebhook\"\nmsg.url = \"https://api.telegram.org/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/setWebhook\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":340,"wires":[["9b9191d4.3ad44"]]},{"id":"9b9191d4.3ad44","type":"http request","z":"54326a95.39a714","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":450,"y":340,"wires":[["82144781.b3a328"]]},{"id":"82144781.b3a328","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":340,"wires":[]},{"id":"814d5732.0fcda8","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1980,"wires":[["7dbda2fe.4ba9dc"]]},{"id":"7dbda2fe.4ba9dc","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":1980,"wires":[["489b2b69.8ea654"]]},{"id":"489b2b69.8ea654","type":"function","z":"873bdacb.594338","name":" save picture","func":"msg.picture = msg.payload;\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":1980,"wires":[["bfea180d.f6d458"]]},{"id":"6b66068.1b307f8","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/hashtags\";\nmsg.method = \"POST\";\nmsg.payload = {\n  picture_id: msg.settings.picture_id, \n  hashtags: msg.hashtags,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":2480,"wires":[["ac380e33.c7c1b"]]},{"id":"81f535a0.2ebdc8","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    name: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":2620,"wires":[["b4e98467.a03aa8"]]},{"id":"b4e98467.a03aa8","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":2620,"wires":[["68234734.09ae58"]]},{"id":"635046ad.368b98","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToArtistMenu\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1460,"y":660,"wires":[["378bddc1.2d5db2"]]},{"id":"378bddc1.2d5db2","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1630,"y":660,"wires":[[]]},{"id":"a0b90be.9637cf8","type":"link out","z":"b679fedf.127e3","name":"Advertising Picture","links":["fb09f894.f9cd68"],"x":1210,"y":680,"wires":[],"l":true},{"id":"bb785b0e.349908","type":"comment","z":"873bdacb.594338","name":"Advertising Picture","info":"","x":210,"y":3680,"wires":[]},{"id":"fb09f894.f9cd68","type":"link in","z":"873bdacb.594338","name":"","links":["a0b90be.9637cf8"],"x":155,"y":3760,"wires":[["66c5f84e.0231a8"]]},{"id":"66c5f84e.0231a8","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"advertisingPicture","vt":"str"},{"t":"eq","v":"moreAboutAdvertising","vt":"str"},{"t":"cont","v":"advertisePicture","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":260,"y":3760,"wires":[["4a22644c.99b6fc"],["fbb828cc.ed15a8"],["66c873e2.902fec"],[]]},{"id":"fbb828cc.ed15a8","type":"function","z":"873bdacb.594338","name":"artAdvertisingMore","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingMore\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":3720,"wires":[["b9030649.442d88"]]},{"id":"b9030649.442d88","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":680,"y":3720,"wires":[[]]},{"id":"765a2c6a.4bed04","type":"function","z":"873bdacb.594338","name":"artAdvertisingAllPicturesText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesText\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":3680,"wires":[["2b8217ca.8b3298"]]},{"id":"2b8217ca.8b3298","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":740,"y":3680,"wires":[["b2023fe0.0252f"]]},{"id":"b2023fe0.0252f","type":"function","z":"873bdacb.594338","name":"artAdvertisingAllPicturesButton","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesButton\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":3680,"wires":[["2f68ed6e.a1aa32"]]},{"id":"2f68ed6e.a1aa32","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":3680,"wires":[[]]},{"id":"54c5a194.09b59","type":"function","z":"873bdacb.594338","name":"artAdvertisingPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingSelectedPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3760,"wires":[["58af3e46.abefb"]]},{"id":"58af3e46.abefb","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":720,"y":3760,"wires":[["a6f8b155.7d589"]]},{"id":"a6f8b155.7d589","type":"function","z":"873bdacb.594338","name":"artAdvertisingPictureButton","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingPictureButton\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":3760,"wires":[["236645bb.40050a"]]},{"id":"236645bb.40050a","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1180,"y":3760,"wires":[[]]},{"id":"56e3a9a7.a35b68","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"statisticByPictures","vt":"str"},{"t":"eq","v":"statisticByHashtags","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":260,"y":3920,"wires":[["dfdf59ec.597678"],[]]},{"id":"e1c97b28.b79248","type":"link in","z":"873bdacb.594338","name":"","links":["c80a9cfe.78211"],"x":145,"y":3920,"wires":[["56e3a9a7.a35b68"]]},{"id":"c80a9cfe.78211","type":"link out","z":"b679fedf.127e3","name":"Statistic","links":["e1c97b28.b79248"],"x":1180,"y":720,"wires":[],"l":true},{"id":"dfdf59ec.597678","type":"function","z":"873bdacb.594338","name":"statisticByPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artViewStatistics\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3920,"wires":[["999c291c.fa3378"]]},{"id":"999c291c.fa3378","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":3920,"wires":[[]]},{"id":"5dc5a637.b025d8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":830,"y":360,"wires":[[]]},{"id":"25d48fc3.f4f11","type":"link in","z":"873bdacb.594338","name":"","links":["d794e3df.6af82"],"x":175,"y":3140,"wires":[["9a53babc.356558"]]},{"id":"4a7f6e65.9277b","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&limit=1`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1160,"wires":[["efffac3.995945"]]},{"id":"efffac3.995945","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1160,"wires":[["186c0c8b.8cbfe3"]]},{"id":"b1f127eb.3130e8","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1240,"wires":[["9931fb3c.3c3e18"]]},{"id":"28155f43.e1f96","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.delete_picture_action,\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2780,"y":1240,"wires":[["1020e601.98f40a"]]},{"id":"1020e601.98f40a","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2950,"y":1240,"wires":[[]]},{"id":"d794e3df.6af82","type":"link out","z":"b679fedf.127e3","name":"Action With Post","links":["25d48fc3.f4f11"],"x":1210,"y":760,"wires":[],"l":true},{"id":"9a53babc.356558","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"cont","v":"deletePicture","vt":"str"},{"t":"cont","v":"deleteSelectedPicture","vt":"str"},{"t":"eq","v":"noDeleteSelectedPicture","vt":"str"},{"t":"cont","v":"editPicture","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":290,"y":3140,"wires":[["68d7a97.8d7ce58"],["fe44aed9.3afa3"],["b5edcaf2.a29a48"],["e97ead3c.5cd2d"],["fc54500d.91237"],["5c3f785d.a6fbe8"]]},{"id":"68d7a97.8d7ce58","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + `/picture?artist_id=${msg.chat_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3000,"wires":[["bdf1a842.a05a58"]]},{"id":"bdf1a842.a05a58","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3000,"wires":[["b8f98807.5114f8"]]},{"id":"b8f98807.5114f8","type":"function","z":"873bdacb.594338","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = 1;\n} else {\n    msg.picture_index++;\n}\nif(msg.picture_index >= msg.numberOfArtistsPictures) {\n    msg.picture_index = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3000,"wires":[["fbd7cc51.c325b"]]},{"id":"bc22c972.99b468","type":"comment","z":"54326a95.39a714","name":"set webhook","info":"","x":130,"y":300,"wires":[]},{"id":"9931fb3c.3c3e18","type":"function","z":"873bdacb.594338","name":"artDeletePicturesText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeletePicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":1240,"wires":[["e693f587.1b16c8"]]},{"id":"e693f587.1b16c8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":1240,"wires":[["e1c4b70b.9b8238"]]},{"id":"b648b794.1ec4c8","type":"debug","z":"873bdacb.594338","name":"122","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1540,"wires":[]},{"id":"4e9bba3d.330514","type":"debug","z":"873bdacb.594338","name":"123","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1700,"wires":[]},{"id":"4f0ce570.701c8c","type":"debug","z":"873bdacb.594338","name":"124","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1820,"wires":[]},{"id":"91c8e521.2dac68","type":"debug","z":"873bdacb.594338","name":"126","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1940,"wires":[]},{"id":"285d1fee.0a84a","type":"debug","z":"873bdacb.594338","name":"121","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2080,"wires":[]},{"id":"cf15cced.31bff","type":"link out","z":"873bdacb.594338","name":"","links":["94b5a6e8.655738"],"x":1795,"y":2120,"wires":[]},{"id":"94b5a6e8.655738","type":"link in","z":"873bdacb.594338","name":"","links":["cf15cced.31bff","cde2a2cf.442c"],"x":635,"y":1660,"wires":[["28c12a3a.bfac36"]]},{"id":"7ca6204e.90294","type":"debug","z":"873bdacb.594338","name":"122","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2200,"wires":[]},{"id":"6e06d2b7.851c7c","type":"link out","z":"873bdacb.594338","name":"","links":["d4e69ac9.efb728"],"x":1315,"y":2240,"wires":[]},{"id":"d4e69ac9.efb728","type":"link in","z":"873bdacb.594338","name":"","links":["6e06d2b7.851c7c"],"x":635,"y":1780,"wires":[["b0f5a28b.1c2c8"]]},{"id":"6c22d7ae.196248","type":"debug","z":"873bdacb.594338","name":"123","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2400,"wires":[]},{"id":"dec980cc.3c5a2","type":"link out","z":"873bdacb.594338","name":"","links":["79e82596.8c6f3c"],"x":1915,"y":2400,"wires":[]},{"id":"79e82596.8c6f3c","type":"link in","z":"873bdacb.594338","name":"","links":["dec980cc.3c5a2","6ecfb529.f03e6c"],"x":635,"y":1900,"wires":[["1adec588.c1154a"]]},{"id":"35f6bd26.78a122","type":"debug","z":"873bdacb.594338","name":"124","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2440,"wires":[]},{"id":"d5882533.57aed8","type":"debug","z":"873bdacb.594338","name":"125","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2600,"wires":[]},{"id":"1678fbec.f5aee4","type":"debug","z":"873bdacb.594338","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":20,"wires":[]},{"id":"8948a095.e6f6c","type":"debug","z":"873bdacb.594338","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":120,"wires":[]},{"id":"b0fbbc5f.e6557","type":"debug","z":"873bdacb.594338","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":220,"wires":[]},{"id":"9d448f4a.51da5","type":"debug","z":"873bdacb.594338","name":"4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":320,"wires":[]},{"id":"c0da844.590da78","type":"debug","z":"873bdacb.594338","name":"5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":420,"wires":[]},{"id":"9837332.8ab5bd","type":"debug","z":"873bdacb.594338","name":"6","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":520,"wires":[]},{"id":"8a778b20.682dc8","type":"debug","z":"873bdacb.594338","name":"7","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":620,"wires":[]},{"id":"7fa7b09.158b75","type":"debug","z":"873bdacb.594338","name":"12","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":760,"wires":[]},{"id":"67691dd6.61ece4","type":"comment","z":"873bdacb.594338","name":"2 ❤️ погано ропарсує хештеги","info":"","x":1130,"y":1940,"wires":[]},{"id":"b27bbfa6.1f569","type":"debug","z":"873bdacb.594338","name":"21","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":960,"wires":[]},{"id":"ef450874.c03c38","type":"debug","z":"873bdacb.594338","name":"31","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":1120,"wires":[]},{"id":"186c0c8b.8cbfe3","type":"switch","z":"873bdacb.594338","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1160,"wires":[["46db99dc.0484f8","a45d76a3.856c88"],["b3127088.c30d5","b1f127eb.3130e8"]]},{"id":"b3127088.c30d5","type":"debug","z":"873bdacb.594338","name":"> 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1200,"wires":[]},{"id":"46db99dc.0484f8","type":"debug","z":"873bdacb.594338","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1100,"wires":[]},{"id":"a45d76a3.856c88","type":"function","z":"873bdacb.594338","name":"artActionsWithoutPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithoutPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":1140,"wires":[["61676108.6296c"]]},{"id":"61676108.6296c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1570,"y":1140,"wires":[[]]},{"id":"7ce40b74.401894","type":"function","z":"873bdacb.594338","name":"","func":"msg.payload = null;\nmsg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&limit=1`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1000,"wires":[["b55247b8.918f88","9da3df59.b4037"]]},{"id":"c4dbfd75.5e323","type":"function","z":"873bdacb.594338","name":"artEditPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":1060,"wires":[["e17a124e.3e0a"]]},{"id":"e17a124e.3e0a","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2570,"y":1060,"wires":[["40155071.2ac4f"]]},{"id":"12e70e6f.7b0062","type":"comment","z":"873bdacb.594338","name":"нема ще картин в художника","info":"","x":1510,"y":920,"wires":[]},{"id":"6ac70f33.4a0ea","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1060,"wires":[["13bc33c7.31a98c"]]},{"id":"40155071.2ac4f","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.edit_picture_action,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2740,"y":1060,"wires":[["b08ba935.033a68"]]},{"id":"b08ba935.033a68","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2910,"y":1060,"wires":[[]]},{"id":"13bc33c7.31a98c","type":"function","z":"873bdacb.594338","name":"artEditPicturesText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1060,"wires":[["214def9a.f22df"]]},{"id":"61774785.1fa288","type":"switch","z":"873bdacb.594338","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1000,"wires":[["7f8832d1.094d0c","48013.6f400fed8"],["76bb1409.69f74c","6ac70f33.4a0ea"]]},{"id":"76bb1409.69f74c","type":"debug","z":"873bdacb.594338","name":"> 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1020,"wires":[]},{"id":"7f8832d1.094d0c","type":"debug","z":"873bdacb.594338","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":920,"wires":[]},{"id":"48013.6f400fed8","type":"function","z":"873bdacb.594338","name":"artActionsWithoutPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithoutPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":960,"wires":[["1d73d4c6.e13fab"]]},{"id":"1d73d4c6.e13fab","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1570,"y":960,"wires":[[]]},{"id":"214def9a.f22df","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":1060,"wires":[["c145718a.96921"]]},{"id":"561a2eaa.dbb08","type":"comment","z":"873bdacb.594338","name":"3 ❤️ натискання кнопки \"далі\" при видаленні чи редагуванні поста","info":"","x":670,"y":2960,"wires":[]},{"id":"46554462.bf288c","type":"comment","z":"873bdacb.594338","name":"4 ❤️ натискання кнопки \"назад\" при видаленні чи редагуванні поста","info":"","x":680,"y":3040,"wires":[]},{"id":"30e7ee42.203182","type":"comment","z":"873bdacb.594338","name":"5 ❤️ вибір поста для видалення","info":"","x":560,"y":3140,"wires":[]},{"id":"c49f4364.9704e","type":"comment","z":"873bdacb.594338","name":"7 ❤️ вибір поста для редагування","info":"","x":560,"y":3340,"wires":[]},{"id":"85eabf9.449af4","type":"comment","z":"873bdacb.594338","name":"8 ❤️ можливість перегляду зредагованого поста","info":"","x":610,"y":3420,"wires":[]},{"id":"b5edcaf2.a29a48","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nmsg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&id=${msg.picture_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3180,"wires":[["5dbbc1c0.b440b"]]},{"id":"5dbbc1c0.b440b","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3180,"wires":[["96a36709.1c3518"]]},{"id":"a9643e82.bb1ed","type":"function","z":"873bdacb.594338","name":"artDeleteSelectedPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":3180,"wires":[["bb9e3c9e.c7d4f"]]},{"id":"bb9e3c9e.c7d4f","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1750,"y":3180,"wires":[["b2c9b15c.2baf9"]]},{"id":"96a36709.1c3518","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\nmsg.picture.hashtags = msg.picture.Hashtags.map(hashtag => {return hashtag.tag; }).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3180,"wires":[["f0c31433.2b5a38"]]},{"id":"83b87f5d.86ac6","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        currentViewPicture: msg.picture\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":3180,"wires":[["9c9efd13.6f40d"]]},{"id":"9c9efd13.6f40d","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2550,"y":3180,"wires":[[]]},{"id":"b2c9b15c.2baf9","type":"function","z":"873bdacb.594338","name":"artDeleteSelectedPictureText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPictureButtons\",\n    templateVars: {\n        picture_id: msg.picture_id,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":3180,"wires":[["c0776ddc.7ff5b"]]},{"id":"c0776ddc.7ff5b","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":3180,"wires":[["83b87f5d.86ac6"]]},{"id":"5c3f785d.a6fbe8","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nmsg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&id=${msg.picture_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3380,"wires":[["1fbef308.cd926d"]]},{"id":"1fbef308.cd926d","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3380,"wires":[["9fc5ab9c.5e7758"]]},{"id":"7b92689.695ef98","type":"function","z":"873bdacb.594338","name":"artEditSelectedPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditSelectedPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":3380,"wires":[["5583ba9b.b34264","aa23ee55.5a794"]]},{"id":"5583ba9b.b34264","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1750,"y":3380,"wires":[["7b5bde2e.f7cc2"]]},{"id":"9fc5ab9c.5e7758","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\nmsg.picture.hashtags = msg.picture.Hashtags.map(hashtag => {return hashtag.tag; }).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3380,"wires":[["6814c3de.03a33c"]]},{"id":"3d40fdee.cfd2d2","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: \"backFromEditPost\",\n    settings: {\n        currentViewPicture: msg.picture\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":3380,"wires":[["512281e7.fdeb3"]]},{"id":"512281e7.fdeb3","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2550,"y":3380,"wires":[[]]},{"id":"7b5bde2e.f7cc2","type":"function","z":"873bdacb.594338","name":"artEditSelectedPictureButtons","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditSelectedPictureButtons\",\n    templateVars: {\n        picture_id: msg.picture_id,\n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1990,"y":3380,"wires":[["ba54d920.a0d2b8","64afe071.4e93a"]]},{"id":"ba54d920.a0d2b8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":3380,"wires":[["3d40fdee.cfd2d2"]]},{"id":"85f4d28a.71758","type":"comment","z":"873bdacb.594338","name":"6 ❤️ видалення вибраного поста","info":"","x":560,"y":3220,"wires":[]},{"id":"e97ead3c.5cd2d","type":"function","z":"873bdacb.594338","name":"artDeleteSelectedPictureStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPictureStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":3260,"wires":[["6372a47a.5e410c"]]},{"id":"6372a47a.5e410c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":3260,"wires":[["140ff17.982590f"]]},{"id":"140ff17.982590f","type":"function","z":"873bdacb.594338","name":"artDeleteSelectedPictureText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPictureText\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":3260,"wires":[["2730c28a.de212e"]]},{"id":"2730c28a.de212e","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":3260,"wires":[["876d06f6.cb5748"]]},{"id":"2877861c.e6d9da","type":"function","z":"873bdacb.594338","name":"artNotDeleteSelectedPictureStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artNotDeleteSelectedPictureStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":3300,"wires":[["212b3c5d.b7d384"]]},{"id":"212b3c5d.b7d384","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":3300,"wires":[["8ea13710.6c7298"]]},{"id":"8ea13710.6c7298","type":"link out","z":"873bdacb.594338","name":"","links":["7433a1b7.ffc66"],"x":1435,"y":3300,"wires":[]},{"id":"7433a1b7.ffc66","type":"link in","z":"873bdacb.594338","name":"","links":["8ea13710.6c7298"],"x":515,"y":200,"wires":[["e8604ad0.dbc038"]]},{"id":"fc54500d.91237","type":"function","z":"873bdacb.594338","name":"artNotDeleteSelectedPictureText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artNotDeleteSelectedPictureText\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":3300,"wires":[["e45ad4d8.9667f8"]]},{"id":"e45ad4d8.9667f8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":810,"y":3300,"wires":[["2877861c.e6d9da"]]},{"id":"136eb217.ad073e","type":"link out","z":"b679fedf.127e3","name":"Edit Post","links":["ba0ec49a.bba4c8"],"x":1180,"y":800,"wires":[],"l":true},{"id":"ba0ec49a.bba4c8","type":"link in","z":"873bdacb.594338","name":"","links":["136eb217.ad073e"],"x":75,"y":4200,"wires":[["8bf4ac74.6ef1e","6ff6cbf4.ef7534"]]},{"id":"36849d40.92f9b2","type":"switch","z":"873bdacb.594338","name":"","property":"originalMessage.callback_query.data","propertyType":"msg","rules":[{"t":"cont","v":"editCategory","vt":"str"},{"t":"cont","v":"editImage","vt":"str"},{"t":"cont","v":"editDescription","vt":"str"},{"t":"cont","v":"editSize","vt":"str"},{"t":"cont","v":"editHashtags","vt":"str"},{"t":"cont","v":"editNamePicture","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":330,"y":4200,"wires":[["784611ea.1fd5f","b3ce595e.97c3c8"],["32c5f2f8.dbecae","b7faec6f.17aff"],["79363867.f2c638","de025e86.211ce"],["df5f1129.7a9d9","f1b470bb.124fb"],["c580b55.568a248","c7343fa8.f4e33"],["8e4902bb.0e998","7fd11bea.997c04"]]},{"id":"784611ea.1fd5f","type":"debug","z":"873bdacb.594338","name":"editCategory","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":3980,"wires":[]},{"id":"32c5f2f8.dbecae","type":"debug","z":"873bdacb.594338","name":"editImage","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":4060,"wires":[]},{"id":"79363867.f2c638","type":"debug","z":"873bdacb.594338","name":"editDescription","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":500,"y":4140,"wires":[]},{"id":"df5f1129.7a9d9","type":"debug","z":"873bdacb.594338","name":"editSize","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":4220,"wires":[]},{"id":"c580b55.568a248","type":"debug","z":"873bdacb.594338","name":"editHashtags","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":4300,"wires":[]},{"id":"8e4902bb.0e998","type":"debug","z":"873bdacb.594338","name":"editNamePicture","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":510,"y":4380,"wires":[]},{"id":"5d41d9bf.43e118","type":"link in","z":"873bdacb.594338","name":"","links":[],"x":635,"y":1540,"wires":[["27fe366d.028afa"]]},{"id":"fbd7cc51.c325b","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/picture?user_id=${msg.chat_id}&artist_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3000,"wires":[["a934b61f.9cac48"]]},{"id":"a934b61f.9cac48","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":3000,"wires":[["3becced2.e34eb2"]]},{"id":"3becced2.e34eb2","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":3000,"wires":[["ce15308c.df4d3"]]},{"id":"fe44aed9.3afa3","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3080,"wires":[["166b2da8.6ff352"]]},{"id":"166b2da8.6ff352","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3080,"wires":[["72339df.127a264"]]},{"id":"72339df.127a264","type":"function","z":"873bdacb.594338","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n} else {\n    msg.picture_index--;\n}\nif(msg.picture_index < 0) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3080,"wires":[["dade7e32.329"]]},{"id":"9352ad04.a211","type":"function","z":"873bdacb.594338","name":"artEditDeletePictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditDeletePictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2500,"y":3000,"wires":[["508a058a.a72c8c"]]},{"id":"508a058a.a72c8c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2710,"y":3000,"wires":[[]]},{"id":"dade7e32.329","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/picture?user_id=${msg.chat_id}&artist_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3080,"wires":[["d4abf4be.2ae838"]]},{"id":"d4abf4be.2ae838","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":3080,"wires":[["28efee4e.0bd7a2"]]},{"id":"28efee4e.0bd7a2","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":3080,"wires":[["ce15308c.df4d3"]]},{"id":"876d06f6.cb5748","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1420,"y":3260,"wires":[["e096089e.48d978"]]},{"id":"e096089e.48d978","type":"function","z":"873bdacb.594338","name":"","func":"msg.method = \"DELETE\";\nmsg.url = msg.imageApiHost +`/picture/${msg.picture_id}`;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1580,"y":3260,"wires":[["754bc225.ecb34c"]]},{"id":"754bc225.ecb34c","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1750,"y":3260,"wires":[[]]},{"id":"eed4086b.1ab768","type":"switch","z":"873bdacb.594338","name":"","property":"settings.action","propertyType":"msg","rules":[{"t":"eq","v":"delete_picture_action","vt":"msg"},{"t":"eq","v":"edit_picture_action","vt":"msg"},{"t":"eq","v":"advertise_picture_action","vt":"msg"}],"checkall":"true","repair":false,"outputs":3,"x":1810,"y":3040,"wires":[["630080eb.000d8"],["d2f93ccf.59878"],["4d09dde6.bb3a84"]]},{"id":"36117cee.865bd4","type":"function","z":"873bdacb.594338","name":"artEditEditPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditEditPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2490,"y":3040,"wires":[["deef7e0c.75de4"]]},{"id":"deef7e0c.75de4","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2690,"y":3040,"wires":[[]]},{"id":"55eae37a.d340bc","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/categories`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":860,"wires":[["6a630fc3.634b3"]]},{"id":"6a630fc3.634b3","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":860,"wires":[["d86a89cf.ee8ac8"]]},{"id":"d86a89cf.ee8ac8","type":"function","z":"873bdacb.594338","name":"","func":"msg.categories = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":860,"wires":[["17adb43.e4bd34c"]]},{"id":"8bf4ac74.6ef1e","type":"debug","z":"873bdacb.594338","name":"editCategory","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":270,"y":4020,"wires":[]},{"id":"7603c44b.c58c6c","type":"comment","z":"873bdacb.594338","name":"9 ❤️ перезапис в бд кожного поля зробити треба","info":"","x":1690,"y":4420,"wires":[]},{"id":"a400e2b4.4be7f","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":1420,"wires":[[]]},{"id":"249d9bee.190ad4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    description: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1420,"wires":[["a400e2b4.4be7f"]]},{"id":"b7faec6f.17aff","type":"function","z":"873bdacb.594338","name":"artEditPictureImage","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureImage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4100,"wires":[["4c40e5bf.03765c"]]},{"id":"4c40e5bf.03765c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":4100,"wires":[["1073e1d8.82b7ae"]]},{"id":"1073e1d8.82b7ae","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostImage_${msg.picture_id}`\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":4100,"wires":[["c4b9c531.5124b8"]]},{"id":"c4b9c531.5124b8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":4100,"wires":[[]]},{"id":"c95ba03b.5a817","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"cont","v":"editPostCategory","vt":"str"},{"t":"cont","v":"editPostImage","vt":"str"},{"t":"cont","v":"editPostDescription","vt":"str"},{"t":"cont","v":"editPostSize","vt":"str"},{"t":"cont","v":"editPostHashtags","vt":"str"},{"t":"cont","v":"editPostName","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":290,"y":4620,"wires":[["ed972ec7.c1809"],["e780d4f6.057678"],["cae2549a.3b3e18"],["15910595.1bb30a"],["811cd1e2.d987b"],["da641564.a5aea8"]]},{"id":"26af6457.735fcc","type":"link in","z":"873bdacb.594338","name":"","links":["e68e3a0e.a40148"],"x":35,"y":4620,"wires":[["40559bc8.d60644"]]},{"id":"27f3d190.e6d03e","type":"comment","z":"873bdacb.594338","name":"Successfull Edit Post","info":"","x":160,"y":4540,"wires":[]},{"id":"4653f28e.d83bdc","type":"function","z":"873bdacb.594338","name":"artEditPictureCategoryDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureCategoryDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":4580,"wires":[["a798ff8c.ca3fa"]]},{"id":"a798ff8c.ca3fa","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1430,"y":4580,"wires":[["17374dde.675e02"]]},{"id":"e68e3a0e.a40148","type":"link out","z":"b679fedf.127e3","name":"Successfull Edit Post","links":["26af6457.735fcc"],"x":1500,"y":1240,"wires":[],"l":true},{"id":"b50385e8.75be28","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1670,"y":4460,"wires":[["786879cc.a9cc58"]]},{"id":"22b102e3.5678ce","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":4460,"wires":[["b50385e8.75be28"]]},{"id":"bcc82e57.38fce","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1990,"y":4460,"wires":[[]]},{"id":"786879cc.a9cc58","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    artist_id: msg.chat_id,\n    externalPictureUrl: \"https://api.telegram.org/file/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/\"+msg.payload.result.file_path,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":4460,"wires":[["bcc82e57.38fce"]]},{"id":"5bc9b73f.773c18","type":"function","z":"873bdacb.594338","name":"artEditPictureCategory","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureCategory\",\n    templateVars: {\n        picture_id: msg.picture_id,\n        categories: msg.categories,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":4020,"wires":[["1736fc6a.170fb4"]]},{"id":"1736fc6a.170fb4","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":4020,"wires":[["77809877.886a18"]]},{"id":"77809877.886a18","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostCategory_${msg.picture_id}`\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1420,"y":4020,"wires":[["eb7d0717.ab2988"]]},{"id":"eb7d0717.ab2988","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":4020,"wires":[[]]},{"id":"de025e86.211ce","type":"function","z":"873bdacb.594338","name":"artEditPictureDescription","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureDescription\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":4180,"wires":[["362e6931.56a686"]]},{"id":"362e6931.56a686","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":4180,"wires":[["4920bbbc.d7f1c4"]]},{"id":"4920bbbc.d7f1c4","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostDescription_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":4180,"wires":[["e5169f34.4bcdb"]]},{"id":"e5169f34.4bcdb","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1090,"y":4180,"wires":[[]]},{"id":"f1b470bb.124fb","type":"function","z":"873bdacb.594338","name":"artEditPictureSize","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureSize\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4260,"wires":[["b503e343.8d096"]]},{"id":"b503e343.8d096","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":4260,"wires":[["342a6ae2.078c66"]]},{"id":"342a6ae2.078c66","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostSize_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":4260,"wires":[["2740574d.abfc88"]]},{"id":"2740574d.abfc88","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":4260,"wires":[[]]},{"id":"c7343fa8.f4e33","type":"function","z":"873bdacb.594338","name":"artEditPictureHashtags","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureHashtags\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":4340,"wires":[["7f8fb140.77c3f"]]},{"id":"7f8fb140.77c3f","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":4340,"wires":[["5d3ff3cb.ab023c"]]},{"id":"5d3ff3cb.ab023c","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostHashtags_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":4340,"wires":[["d7e20bea.ccce98"]]},{"id":"d7e20bea.ccce98","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1090,"y":4340,"wires":[[]]},{"id":"7fd11bea.997c04","type":"function","z":"873bdacb.594338","name":"artEditPictureName","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureName\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4420,"wires":[["a8471801.4070e8"]]},{"id":"a8471801.4070e8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":4420,"wires":[["63bc7368.f07a4c"]]},{"id":"63bc7368.f07a4c","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostName_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":4420,"wires":[["b3cf24f0.b485c8"]]},{"id":"b3cf24f0.b485c8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":4420,"wires":[[]]},{"id":"7cce4959.fe1f58","type":"function","z":"873bdacb.594338","name":"artEditPictureImageDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureImageDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":4640,"wires":[["c189921d.4fa6c"]]},{"id":"c189921d.4fa6c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1890,"y":4640,"wires":[["17374dde.675e02"]]},{"id":"f1d6ac99.307be","type":"function","z":"873bdacb.594338","name":"artEditPictureDescriptionDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureDescriptionDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":4720,"wires":[["fa39a794.d2c858"]]},{"id":"fa39a794.d2c858","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":4720,"wires":[["17374dde.675e02"]]},{"id":"aae36342.6df7a","type":"function","z":"873bdacb.594338","name":"artEditPictureSizeDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureSizeDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2310,"y":4980,"wires":[["4decc83b.1e5c88"]]},{"id":"4decc83b.1e5c88","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2530,"y":4980,"wires":[["17374dde.675e02"]]},{"id":"1866f3ff.b9ef2c","type":"function","z":"873bdacb.594338","name":"artEditPictureHashtagsDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureHashtagsDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":4800,"wires":[["c0f7c12b.3aa89"]]},{"id":"c0f7c12b.3aa89","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2070,"y":4800,"wires":[["17374dde.675e02"]]},{"id":"94bbf698.c09468","type":"function","z":"873bdacb.594338","name":"artEditPictureNameDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureNameDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1330,"y":4880,"wires":[["d809f718.b3cb58"]]},{"id":"d809f718.b3cb58","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1550,"y":4880,"wires":[["17374dde.675e02"]]},{"id":"7dc96063.78c5b","type":"link in","z":"873bdacb.594338","name":"","links":["5eff25f7.20c1bc","dd0e469.39117b8","cd51c3af.ef3dd","9d01a722.a046a8"],"x":1795,"y":3420,"wires":[["7b5bde2e.f7cc2","6f018b10.7cf5b4"]]},{"id":"5eff25f7.20c1bc","type":"link out","z":"b679fedf.127e3","name":"","links":["7dc96063.78c5b","54afbb3f.87fd44"],"x":1135,"y":880,"wires":[]},{"id":"8cdb5160.4d2f3","type":"function","z":"873bdacb.594338","name":"artEditSelectedPictureDone","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditSelectedPictureDone\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags:msg.picture.hashtags ? '#' + msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1560,"y":4520,"wires":[["824774a1.448af8"]]},{"id":"824774a1.448af8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1790,"y":4520,"wires":[["2f407d3e.111662"]]},{"id":"19041e.0a340be3","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":4520,"wires":[["8ac3fa11.b0d308"]]},{"id":"8ac3fa11.b0d308","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":4520,"wires":[["760839fa.2efd38"]]},{"id":"760839fa.2efd38","type":"function","z":"873bdacb.594338","name":" save picture","func":"msg.picture = msg.payload;\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":4520,"wires":[["39c0dafa.b0de26"]]},{"id":"125cc298.baa36d","type":"comment","z":"873bdacb.594338","name":"10 ❤️підтянуввання зредагованої картинки зробити треба","info":"","x":800,"y":4480,"wires":[]},{"id":"bc570903.b6ae78","type":"link out","z":"b679fedf.127e3","name":"","links":["c259d0d8.e23ef"],"x":1135,"y":840,"wires":[]},{"id":"c259d0d8.e23ef","type":"link in","z":"873bdacb.594338","name":"","links":["bc570903.b6ae78"],"x":375,"y":4520,"wires":[["19041e.0a340be3"]]},{"id":"d061295d.0f3e38","type":"comment","z":"873bdacb.594338","name":"1 ❤️ через категоріі крашнулося і категоріі не приходять","info":"","x":900,"y":820,"wires":[]},{"id":"b98dfd57.b08df","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.advertise_picture_action,\n    }\n};\nreturn msg;\n//msg.advertise_picture_action = 'advertise_picture';","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":260,"wires":[["845569db.eebca8"]]},{"id":"845569db.eebca8","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":260,"wires":[[]]},{"id":"d03733dc.0f3c","type":"function","z":"873bdacb.594338","name":"artAdvertisingAllPicturesButton","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesButton\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":3640,"wires":[["9107678b.3927a8"]]},{"id":"9107678b.3927a8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":3640,"wires":[[]]},{"id":"e8170d52.66dc6","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3640,"wires":[["354d1d71.c7c7b2"]]},{"id":"d41d035a.468d6","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.delete_picture_action,\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":3640,"wires":[["592ed2ca.f0570c"]]},{"id":"592ed2ca.f0570c","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":3640,"wires":[[]]},{"id":"354d1d71.c7c7b2","type":"function","z":"873bdacb.594338","name":"artAdvertisingAllPicturesText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":3640,"wires":[["f59d7334.0777f"]]},{"id":"f59d7334.0777f","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":3640,"wires":[["d03733dc.0f3c"]]},{"id":"59b12533.68a51c","type":"function","z":"873bdacb.594338","name":"artAdvertisingAllPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.artist.nickname,\n\t   //nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2470,"y":3600,"wires":[["1d6ac563.701ffb"]]},{"id":"1d6ac563.701ffb","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2690,"y":3600,"wires":[["d6aaf0d1.3cc53"]]},{"id":"72b97a6d.52b724","type":"comment","z":"873bdacb.594338","name":"нема ще картин в художника","info":"","x":1530,"y":3480,"wires":[]},{"id":"4a22644c.99b6fc","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&limit=1&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3580,"wires":[["36ab041d.2961bc"]]},{"id":"36ab041d.2961bc","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3580,"wires":[["5bd7308.411ebd"]]},{"id":"888813e8.7a13d","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":3600,"wires":[["43389508.7891cc"]]},{"id":"d6aaf0d1.3cc53","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.advertise_picture_action,\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2860,"y":3600,"wires":[["164fe091.c4092f"]]},{"id":"164fe091.c4092f","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3030,"y":3600,"wires":[[]]},{"id":"43389508.7891cc","type":"function","z":"873bdacb.594338","name":"artAdvertisingAllPicturesText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":3600,"wires":[["c526cb20.de0168"]]},{"id":"c526cb20.de0168","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1750,"y":3600,"wires":[["cd93b18b.6fbfc"]]},{"id":"5bd7308.411ebd","type":"switch","z":"873bdacb.594338","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1150,"y":3540,"wires":[["7ca24ba4.1dcf84","6e15dd75.5d3e64"],["a8d256d0.ea4b18","888813e8.7a13d"]]},{"id":"a8d256d0.ea4b18","type":"debug","z":"873bdacb.594338","name":"> 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":3560,"wires":[]},{"id":"7ca24ba4.1dcf84","type":"debug","z":"873bdacb.594338","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":3480,"wires":[]},{"id":"6e15dd75.5d3e64","type":"function","z":"873bdacb.594338","name":"artActionsWithoutPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertiseWithoutPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1370,"y":3520,"wires":[["898c1336.ed8d3"]]},{"id":"898c1336.ed8d3","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":3520,"wires":[[]]},{"id":"c213324b.530c9","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2370,"y":2960,"wires":[]},{"id":"b6ecff6a.e62ea","type":"function","z":"873bdacb.594338","name":"artEditAdvertisingAllPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditAdvertisingAllPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2520,"y":3080,"wires":[["44125fa2.f2378"]]},{"id":"44125fa2.f2378","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2750,"y":3080,"wires":[[]]},{"id":"b3e43966.5e2af8","type":"comment","z":"873bdacb.594338","name":"4 ❤️ коли вперід то нове повідомлення прихолить, а коли назад то все ок","info":"","x":2310,"y":2820,"wires":[]},{"id":"25d77da5.1ce9e2","type":"comment","z":"873bdacb.594338","name":"8 ❤️ можливість перегляду зредагованого поста","info":"","x":610,"y":3840,"wires":[]},{"id":"66c873e2.902fec","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nmsg.url = msg.imageApiHost +`/picture?artist_id=${msg.chat_id}&id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3800,"wires":[["a49389cf.74b8a8"]]},{"id":"a49389cf.74b8a8","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3800,"wires":[["d20a7d92.a9a95"]]},{"id":"9c9f7abd.ed23a8","type":"function","z":"873bdacb.594338","name":"artEditSelectedPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingSelectedPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":3800,"wires":[["87a8d37f.c0cf8"]]},{"id":"87a8d37f.c0cf8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1730,"y":3800,"wires":[["430071ed.6e138"]]},{"id":"d20a7d92.a9a95","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\nmsg.picture.hashtags = msg.picture.Hashtags.map(hashtag => {return hashtag.tag; }).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3800,"wires":[["15e98be.49c5074"]]},{"id":"7593ec40.ed3ca4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    // settings: {\n    //     currentViewPicture: msg.picture\n    // }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":3800,"wires":[["c0cb4ece.e44e4"]]},{"id":"c0cb4ece.e44e4","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2530,"y":3800,"wires":[[]]},{"id":"430071ed.6e138","type":"function","z":"873bdacb.594338","name":"artAdvertisingPictureButton","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingPictureButton\",\n    templateVars: {\n        picture_id: msg.picture_id,\n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":3800,"wires":[["825a8003.a1a32"]]},{"id":"825a8003.a1a32","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2190,"y":3800,"wires":[["7593ec40.ed3ca4"]]},{"id":"6ff6cbf4.ef7534","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":4200,"wires":[["36849d40.92f9b2"]]},{"id":"b3ce595e.97c3c8","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/categories`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":4020,"wires":[["dca82e01.44fd"]]},{"id":"dca82e01.44fd","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":4020,"wires":[["49a4e84e.3bac38"]]},{"id":"49a4e84e.3bac38","type":"function","z":"873bdacb.594338","name":"","func":"msg.categories = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":4020,"wires":[["5bc9b73f.773c18"]]},{"id":"6a4b9dff.23d6a4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.picture_id = msg.currentViewPicture.id;\nmsg.payload = {\n    id: msg.picture_id,\n    category_id: msg.category_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":4580,"wires":[["ce1579dc.262588"]]},{"id":"ce1579dc.262588","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":970,"y":4580,"wires":[["4653f28e.d83bdc"]]},{"id":"40559bc8.d60644","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.state.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":140,"y":4620,"wires":[["c95ba03b.5a817"]]},{"id":"ed972ec7.c1809","type":"function","z":"873bdacb.594338","name":"","func":"msg.category_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4580,"wires":[["6a4b9dff.23d6a4"]]},{"id":"17374dde.675e02","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backFromEditPost\",\n    settings: {\n    picture_id: msg.picture_id,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2720,"y":4980,"wires":[["a6d7434c.57dda","580c29a3.de99f8"]]},{"id":"a6d7434c.57dda","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2890,"y":4980,"wires":[[]]},{"id":"2f407d3e.111662","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1950,"y":4520,"wires":[]},{"id":"580c29a3.de99f8","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2710,"y":4940,"wires":[]},{"id":"81ce59ed.829f28","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4640,"wires":[["28609283.56b00e"]]},{"id":"20711b8.88135e4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = \"https://api.telegram.org/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4640,"wires":[["81ce59ed.829f28"]]},{"id":"6b583fd1.b7149","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":4640,"wires":[["7cce4959.fe1f58"]]},{"id":"28609283.56b00e","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.picture_id = msg.currentViewPicture.id;\nmsg.payload = {\n    id: msg.picture_id,\n    externalPictureUrl: \"https://api.telegram.org/file/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/\"+msg.payload.result.file_path,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":4640,"wires":[["6b583fd1.b7149"]]},{"id":"b6eb11eb.f04f4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.picture_id = msg.currentViewPicture.id;\nmsg.payload = {\n    //id: msg.picture_id,\n    id: msg.picture_id,\n    description: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4720,"wires":[["ffa3b23.d3f405"]]},{"id":"ffa3b23.d3f405","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4720,"wires":[["f1d6ac99.307be"]]},{"id":"6cf10bac.540ac4","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2090,"y":4980,"wires":[["aae36342.6df7a"]]},{"id":"c4d02f4f.f18c8","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.size = msg.text.split(\"-\");\n\nmsg.picture_id = msg.currentViewPicture.id;\n\nmsg.payload = {\n    id: msg.picture_id,\n    //height: msg.text.split('-')[0],\n    //width: msg.text.split('-')[1]\n    height: msg.size[0],\n    width: msg.size[1]\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":4980,"wires":[["6cf10bac.540ac4"]]},{"id":"598a97e3.fe43a8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1610,"y":4800,"wires":[["1866f3ff.b9ef2c"]]},{"id":"a8d6686b.706688","type":"function","z":"873bdacb.594338","name":"","func":"let text = msg.text;\n\n//text = text.replace(/\\s/g, '');\n\ntext = text.replace(/# /g, \"#\");\n\ntext = text.replace(',', \"\");\n\nif(text[0] == '#') {\ntext = text.substring(1, text.length);\nconsole.log(text);\n}\n\nmsg.hashtags = text.split('#');\n\nreturn msg;\n//msg.picture.hashtags = msg.picture.hashtags.replace(/# /g, \"#\");","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":4800,"wires":[["dbcab055.50a4"]]},{"id":"dbcab055.50a4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/hashtags\";\nmsg.method = \"POST\";\nmsg.payload = {\n  picture_id: msg.picture_id, \n  hashtags: msg.hashtags,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1440,"y":4800,"wires":[["598a97e3.fe43a8"]]},{"id":"f108ff04.3734","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4800,"wires":[["a8d6686b.706688"]]},{"id":"bc1def2e.034c5","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.currentViewPicture.id;\n\nmsg.url = msg.imageApiHost +`/hashtags/${msg.picture_id}`;\nmsg.method = \"DELETE\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4800,"wires":[["f108ff04.3734"]]},{"id":"a90383c8.8467","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.picture_id = msg.currentViewPicture.id;\nmsg.payload = {\n    id: msg.picture_id,\n    name: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4880,"wires":[["272d4665.3f12fa"]]},{"id":"272d4665.3f12fa","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4880,"wires":[["94bbf698.c09468"]]},{"id":"597cd3af.4b255c","type":"function","z":"b679fedf.127e3","name":"helloBuyer","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloBuyer\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":1600,"wires":[["2bfb3cac.293174"]]},{"id":"2bfb3cac.293174","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1600,"wires":[["a37065a4.4bf768"]]},{"id":"a37065a4.4bf768","type":"function","z":"b679fedf.127e3","name":"helloBuyerStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloBuyerStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1600,"wires":[["556ed1c.b68a03"]]},{"id":"556ed1c.b68a03","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1510,"y":1600,"wires":[["279a2f04.524f2"]]},{"id":"279a2f04.524f2","type":"function","z":"b679fedf.127e3","name":"buyerMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.buyerType,\n    lang: msg.lang,\n    templateName: \"buyerMenu\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":1600,"wires":[["eb59cf93.3edff"]]},{"id":"eb59cf93.3edff","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1870,"y":1600,"wires":[["2dad1ff.8f0dae"]]},{"id":"1e33a5a6.c2132a","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"searchPictures","vt":"str"},{"t":"eq","v":"searchByArtist","vt":"str"},{"t":"eq","v":"searchByCategory","vt":"str"},{"t":"eq","v":"searchBySize","vt":"str"},{"t":"eq","v":"searchByHashtag","vt":"str"},{"t":"cont","v":"categIdSPic","vt":"str"},{"t":"cont","v":"artistIdSPic","vt":"str"},{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":10,"x":190,"y":560,"wires":[["d5caa23c.a413a"],["8882a82a.9c1ca8"],["31e6decf.c80722"],["fe143a49.87dd08"],["1f6985d1.b984ea"],["88c37f70.8b576"],["23b38487.0b46fc"],["8e7b747b.a53838"],["1ac642e9.c5193d"],["b721e972.dac418"]]},{"id":"a1a93aa9.e4ab18","type":"comment","z":"8a997eeb.880fd","name":"пошук картин","info":"","x":670,"y":200,"wires":[]},{"id":"ed8694a4.4b21f8","type":"link in","z":"8a997eeb.880fd","name":"","links":["74aa0be6.dee674","2fce8b7f.6fff74"],"x":85,"y":560,"wires":[["1e33a5a6.c2132a","da23b1ee.51feb"]]},{"id":"5c6ac94.cc82b38","type":"function","z":"8a997eeb.880fd","name":"buyerSerchPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSerchPictures\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":180,"wires":[["82452cd4.887c5"]]},{"id":"82452cd4.887c5","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":180,"wires":[["cbfc9ef1.c2a65"]]},{"id":"74aa0be6.dee674","type":"link out","z":"b679fedf.127e3","name":"searchPictures","links":["ed8694a4.4b21f8"],"x":620,"y":1720,"wires":[],"l":true},{"id":"3e7d6391.e6022c","type":"function","z":"8a997eeb.880fd","name":"buyerSearchPicturesByArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchPicturesByArtist\",\n    templateVars: {\n        artists: msg.artists,\n    }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":280,"wires":[["5724d23c.90197c"]]},{"id":"5724d23c.90197c","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1770,"y":280,"wires":[[]]},{"id":"cab47b48.114828","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":280,"wires":[["82714381.0cf26"]]},{"id":"8882a82a.9c1ca8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/artists\";\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":280,"wires":[["cab47b48.114828"]]},{"id":"82714381.0cf26","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist_ids = msg.payload.map(artist => artist.artist_id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":280,"wires":[["a11e1058.91849"]]},{"id":"f76440b.fbdfac","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":280,"wires":[["316c2820.523b08"]]},{"id":"a11e1058.91849","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/findUsers\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.artist_ids,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":280,"wires":[["f76440b.fbdfac"]]},{"id":"316c2820.523b08","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artists = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":280,"wires":[["3e7d6391.e6022c"]]},{"id":"51c8e1a0.87be1","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":820,"wires":[["a31b9999.2f62a8"]]},{"id":"23b38487.0b46fc","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist_id = msg.text.split('_')[1];\nmsg.url = msg.imageApiHost+`/picture?artist_id=${msg.artist_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":820,"wires":[["51c8e1a0.87be1"]]},{"id":"a40fd9ad.44fb28","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":800,"wires":[["5c6bb266.03f27c"]]},{"id":"aae96a5a.ffff98","type":"function","z":"8a997eeb.880fd","name":"buyerViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   \n\t   //category: msg.picture.category.settings[msg.lang],\n\t   \n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length,\n\t   \n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":800,"wires":[["8b7e830b.a4f0c"]]},{"id":"8b7e830b.a4f0c","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1850,"y":800,"wires":[["4bbe44d5.07bc8c"]]},{"id":"4bbe44d5.07bc8c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byArtistSearchType,\n        artist_id: msg.artist_id,\n    }\n};\nmsg.settings.searchType = msg.byArtistSearchType;\nmsg.settings.artist_id = msg.artist_id;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2020,"y":800,"wires":[["84bcce89.74157"]]},{"id":"84bcce89.74157","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2190,"y":800,"wires":[["cf6526ef.21ef08"]]},{"id":"635e5f59.5606e","type":"switch","z":"b679fedf.127e3","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"regex","v":"((\\+38)?\\(?\\d{3}\\)?[\\s\\.-]?(\\d{7}|\\d{3}[\\s\\.-]\\d{2}[\\s\\.-]\\d{2}|\\d{3}-\\d{4}))","vt":"str","case":false},{"t":"eq","v":"uk","vt":"str"},{"t":"eq","v":"ru","vt":"str"},{"t":"eq","v":"en","vt":"str"},{"t":"eq","v":"artist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"buyerSettings","vt":"str"},{"t":"eq","v":"changeType","vt":"str"},{"t":"eq","v":"changeArtistName","vt":"str"},{"t":"cont","v":"advertising_","vt":"str"},{"t":"cont","v":"statisic_","vt":"str"},{"t":"eq","v":"artistSettings","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":14,"x":350,"y":480,"wires":[["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["2f1ed026.fb0a4"],["62efcbaa.635294"],["62efcbaa.635294"],["2f1ed026.fb0a4"],["310d4b4f.e5f174"]]},{"id":"f2cb3c2a.60f0e","type":"link in","z":"fe29b5bc.5d8348","name":"","links":["581a4d7a.1aea24","2f1ed026.fb0a4","66430dc1.7996b4"],"x":15,"y":240,"wires":[["79391291.079a2c","cb4899b4.729e58"]]},{"id":"53138185.ba408","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":730,"y":100,"wires":[["3d4e7656.6bd0da"]]},{"id":"e6d03c8e.2ad37","type":"function","z":"fe29b5bc.5d8348","name":"startNumberMessage","func":"//msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.url = msg.messageApiHost+\"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    templateName: \"startNumberMessage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":100,"wires":[["53138185.ba408"]]},{"id":"13f3af4d.4c9d81","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":320,"wires":[["f7b8bf90.3f935"]]},{"id":"e6145026.895e9","type":"function","z":"fe29b5bc.5d8348","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":320,"wires":[["13f3af4d.4c9d81"]]},{"id":"d9b75658.c7f098","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":320,"wires":[["e387d46b.820318"]]},{"id":"f7b8bf90.3f935","type":"function","z":"fe29b5bc.5d8348","name":"chooseWhoAreYou","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text,\n    templateName: \"chooseWhoAreYou\",\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":320,"wires":[["d9b75658.c7f098"]]},{"id":"6406051.98fcdfc","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":160,"wires":[["6249abee.057094"]]},{"id":"92ba5cc6.f33d9","type":"function","z":"fe29b5bc.5d8348","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    phone: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":160,"wires":[["6406051.98fcdfc"]]},{"id":"6249abee.057094","type":"function","z":"fe29b5bc.5d8348","name":"succesRegistration","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"succesRegistration\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":160,"wires":[["d10d0e44.2bf5"]]},{"id":"d10d0e44.2bf5","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":160,"wires":[["226c690b.265aa6"]]},{"id":"4a050ff3.39e28","type":"function","z":"fe29b5bc.5d8348","name":"chooseLanguage","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"chooseLanguage\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1830,"y":160,"wires":[["ed4d56ec.9ce838"]]},{"id":"ed4d56ec.9ce838","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2030,"y":160,"wires":[["b60a7f4d.1ebc4"]]},{"id":"226c690b.265aa6","type":"function","z":"fe29b5bc.5d8348","name":"succesRegistrationStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"succesRegistrationStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1410,"y":160,"wires":[["1e67b3a3.6f6ffc"]]},{"id":"1e67b3a3.6f6ffc","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1630,"y":160,"wires":[["4a050ff3.39e28"]]},{"id":"2f1ed026.fb0a4","type":"link out","z":"b679fedf.127e3","name":"","links":["f2cb3c2a.60f0e"],"x":495,"y":400,"wires":[]},{"id":"79391291.079a2c","type":"switch","z":"fe29b5bc.5d8348","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"regex","v":"((\\+38)?\\(?\\d{3}\\)?[\\s\\.-]?(\\d{7}|\\d{3}[\\s\\.-]\\d{2}[\\s\\.-]\\d{2}|\\d{3}-\\d{4}))","vt":"str","case":false},{"t":"eq","v":"uk","vt":"str"},{"t":"eq","v":"ru","vt":"str"},{"t":"eq","v":"en","vt":"str"},{"t":"eq","v":"artist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"buyerSettings","vt":"str"},{"t":"eq","v":"artistSettings","vt":"str"},{"t":"eq","v":"changeType","vt":"str"},{"t":"eq","v":"changeArtistName","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":12,"x":170,"y":240,"wires":[["e6d03c8e.2ad37"],["71e3a6da.6b83f8"],["e6145026.895e9"],["e6145026.895e9"],["e6145026.895e9"],["e8d4018d.5be46"],["574f5803.7a1418"],["253816ef.0383fa"],["ba8c6628.114478"],["5ece3c50.7a99c4"],["53f51767.63ff08"],["6a01d400.e013bc"]]},{"id":"574f5803.7a1418","type":"link out","z":"fe29b5bc.5d8348","name":"buyer","links":["881f640.37671a"],"x":470,"y":400,"wires":[],"l":true},{"id":"e8d4018d.5be46","type":"link out","z":"fe29b5bc.5d8348","name":"artist","links":["5b36f5ca.00b06c"],"x":470,"y":360,"wires":[],"l":true},{"id":"5b36f5ca.00b06c","type":"link in","z":"b679fedf.127e3","name":"","links":["e8d4018d.5be46","d8658172.5a3c5","a8e3c2f2.17eed"],"x":1275,"y":500,"wires":[["3df5045a.a5803c"]]},{"id":"8e7b747b.a53838","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = msg.imageApiHost +`/picture?artist_id=${msg.settings.artist_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = msg.imageApiHost +`/picture?category_id=${msg.settings.category_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByHistory?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByLiked?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = msg.imageApiHost +`/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":960,"wires":[["ddfae211.90176"]]},{"id":"ddfae211.90176","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":960,"wires":[["7c9e945e.c1b8ec"]]},{"id":"7c9e945e.c1b8ec","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = 1;\n} else {\n    msg.picture_index++;\n}\nif(msg.picture_index >= msg.numberOfArtistsPictures) {\n    msg.picture_index = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":960,"wires":[["ce5387ed.d0aaa8"]]},{"id":"abf06e15.7ca17","type":"comment","z":"8a997eeb.880fd","name":"3 ❤️ натискання кнопки \"далі\"","info":"","x":570,"y":920,"wires":[]},{"id":"936c8a88.70ca28","type":"comment","z":"8a997eeb.880fd","name":"4 ❤️ натискання кнопки \"назад\"","info":"","x":580,"y":1000,"wires":[]},{"id":"ce5387ed.d0aaa8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = msg.imageApiHost +`/picture?user_id=${msg.chat_id}&artist_id=${msg.settings.artist_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = msg.imageApiHost +`/picture?user_id=${msg.chat_id}&category_id=${msg.settings.category_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByHistory?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByLiked?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = msg.imageApiHost +`/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":960,"wires":[["d6890517.95c4a8"]]},{"id":"d6890517.95c4a8","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":960,"wires":[["b8209f42.3c032"]]},{"id":"b8209f42.3c032","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0].Picture ? msg.payload[0].Picture : msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":960,"wires":[["76e78d9f.cd8b14"]]},{"id":"1ac642e9.c5193d","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = msg.imageApiHost +`/picture?artist_id=${msg.settings.artist_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = msg.imageApiHost +`/picture?category_id=${msg.settings.category_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByHistory?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByLiked?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = msg.imageApiHost +`/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1040,"wires":[["6a384d92.534a44"]]},{"id":"6a384d92.534a44","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":1040,"wires":[["fd9a571a.cb25a8"]]},{"id":"fd9a571a.cb25a8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n} else {\n    msg.picture_index--;\n}\nif(msg.picture_index < 0) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":1040,"wires":[["5650a384.8f951c"]]},{"id":"5650a384.8f951c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = msg.imageApiHost +`/picture?user_id=${msg.chat_id}&artist_id=${msg.settings.artist_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = msg.imageApiHost +`/picture?user_id=${msg.chat_id}&category_id=${msg.settings.category_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByHistory?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesByLiked?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = msg.imageApiHost +`/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = msg.imageApiHost +`/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":1040,"wires":[["6a47fd83.b071d4"]]},{"id":"6a47fd83.b071d4","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":1040,"wires":[["d30215de.57a978","ead39258.72887"]]},{"id":"d30215de.57a978","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0].Picture ? msg.payload[0].Picture : msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1040,"wires":[["76e78d9f.cd8b14"]]},{"id":"76e78d9f.cd8b14","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: msg.picture_index,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":980,"wires":[["a0807c0b.2aecc"]]},{"id":"a0807c0b.2aecc","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1650,"y":980,"wires":[["e75d6cf2.8c6c3"]]},{"id":"ead39258.72887","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":1080,"wires":[]},{"id":"1c535839.af4c78","type":"function","z":"8a997eeb.880fd","name":"bayerSearchCategoryId","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"bayerSearchCategoryId\",\n    templateVars: {\n        categories: msg.categories,\n    }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":340,"wires":[["e87d323e.1289"]]},{"id":"e87d323e.1289","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":340,"wires":[[]]},{"id":"bee73095.d35a4","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":340,"wires":[["ac171046.815c1"]]},{"id":"31e6decf.c80722","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/categories\";\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":340,"wires":[["bee73095.d35a4"]]},{"id":"ac171046.815c1","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.categories = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":340,"wires":[["1c535839.af4c78"]]},{"id":"9cde7a02.c31638","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":660,"wires":[["96c12299.e54c8"]]},{"id":"88c37f70.8b576","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.category_id = msg.text.split('_')[1];\nmsg.url = msg.imageApiHost +`/picture?category_id=${msg.category_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":660,"wires":[["9cde7a02.c31638"]]},{"id":"4a28022.7a7c6fc","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":660,"wires":[["6ddbff1a.8e727"]]},{"id":"29eeb34b.f4259c","type":"function","z":"8a997eeb.880fd","name":"buyerViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\t   \n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":660,"wires":[["91f00779.e65568","44ff613c.07aee"]]},{"id":"91f00779.e65568","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":660,"wires":[["a48d4639.82cef8"]]},{"id":"a48d4639.82cef8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byCategorySearchType,\n        category_id: msg.category_id,\n    }\n};\nmsg.settings.searchType = msg.byCategorySearchType;\nmsg.settings.category_id = msg.category_id;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":660,"wires":[["8af0a7c.9bf4458"]]},{"id":"8af0a7c.9bf4458","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1510,"y":660,"wires":[["63813bb9.7b2c54"]]},{"id":"44ff613c.07aee","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1150,"y":700,"wires":[]},{"id":"2435a6b.0b23f5a","type":"function","z":"873bdacb.594338","name":"changeTypeToArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    //templateName: \"changeWhoAreYou\"\n    templateName: \"changeTypeToArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":660,"wires":[["61ab100a.90341"]]},{"id":"61ab100a.90341","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":870,"y":660,"wires":[["1d71e531.7608ab"]]},{"id":"da23b1ee.51feb","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":190,"y":460,"wires":[]},{"id":"253816ef.0383fa","type":"function","z":"fe29b5bc.5d8348","name":"changeTypeToArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":440,"wires":[["ac22d002.7e5db"]]},{"id":"ac22d002.7e5db","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":440,"wires":[["c03bd492.8271d8"]]},{"id":"c03bd492.8271d8","type":"function","z":"fe29b5bc.5d8348","name":"changeTypeToArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToArtist\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":440,"wires":[["a147359b.1ac728"]]},{"id":"a147359b.1ac728","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":440,"wires":[[]]},{"id":"d8658172.5a3c5","type":"link out","z":"b679fedf.127e3","name":"","links":["5b36f5ca.00b06c"],"x":555,"y":1640,"wires":[]},{"id":"5ece3c50.7a99c4","type":"function","z":"fe29b5bc.5d8348","name":"changeTypeToArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":520,"wires":[["ff1502f3.7ee41"]]},{"id":"ff1502f3.7ee41","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":520,"wires":[["25331d0a.abb3a2"]]},{"id":"25331d0a.abb3a2","type":"function","z":"fe29b5bc.5d8348","name":"changeTypeToBuyer","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToBuyer\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":520,"wires":[["942c669c.7ffc88"]]},{"id":"942c669c.7ffc88","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":520,"wires":[["4f7aee9d.b3254"]]},{"id":"215d0721.62eb28","type":"function","z":"b679fedf.127e3","name":"buyerMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1840,"wires":[["fb8ba89d.f99b78"]]},{"id":"fb8ba89d.f99b78","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":1840,"wires":[["298960a6.4eaf1"]]},{"id":"fe143a49.87dd08","type":"function","z":"8a997eeb.880fd","name":"buyerSearchBySizeSetMin","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchBySizeSetMin\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":400,"wires":[["accc3552.fa7ea8"]]},{"id":"accc3552.fa7ea8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":400,"wires":[["4256ea21.db4204"]]},{"id":"4256ea21.db4204","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: 'inputMinSize',\n    settings: {\n        picture_index: 0,\n        searchType: msg.bySizeSearchType,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":400,"wires":[["111bd7ff.f1e3c8"]]},{"id":"111bd7ff.f1e3c8","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":400,"wires":[[]]},{"id":"5e92021c.5f9abc","type":"switch","z":"8a997eeb.880fd","name":"state","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"inputMinSize","vt":"str"},{"t":"eq","v":"inputMaxSize","vt":"str"},{"t":"eq","v":"inputSearchHashtags","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"buyerSerchPictures","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":6,"x":170,"y":1520,"wires":[["6baafda9.2cbd24"],["7ad9b5da.641d6c"],["88b3bca7.b54de"],["28b487fc.15e448"],["88b3bca7.b54de"],["378ad992.26e356"]]},{"id":"52e1963b.7de678","type":"link in","z":"8a997eeb.880fd","name":"","links":["df0f91a7.18f7c"],"x":75,"y":1520,"wires":[["5e92021c.5f9abc"]]},{"id":"df0f91a7.18f7c","type":"link out","z":"b679fedf.127e3","name":"","links":["52e1963b.7de678"],"x":555,"y":1960,"wires":[]},{"id":"737f83fd.b005bc","type":"function","z":"8a997eeb.880fd","name":"buyerSearchBySizeSetMax","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchBySizeSetMax\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1560,"y":1360,"wires":[["cd7d2ac2.4d6048"]]},{"id":"cd7d2ac2.4d6048","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1790,"y":1360,"wires":[["b9653c0f.162ec"]]},{"id":"b9653c0f.162ec","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: 'inputMaxSize',\n    settings: {\n        picture_index: 0,\n        searchType: msg.bySizeSearchType,\n        searchMinSize: msg.text,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":1360,"wires":[["4f80d477.e2705c"]]},{"id":"4f80d477.e2705c","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2130,"y":1360,"wires":[[]]},{"id":"6a3a7d3a.55a1c4","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.minSize = msg.settings.searchMinSize.split('-');\nmsg.maxSize = msg.text.split('-');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1460,"y":1500,"wires":[["34643237.08cc8e"]]},{"id":"4540c0c2.afb5d","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1790,"y":1500,"wires":[["a0f4eb8d.e71ab8"]]},{"id":"34643237.08cc8e","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost +`/findPicturesBySize`;\nmsg.method = \"POST\";\nmsg.payload = {\n    minSize: msg.minSize,\n    maxSize: msg.maxSize,\n    limit: 1,\n    user_id: msg.chat_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":1500,"wires":[["4540c0c2.afb5d"]]},{"id":"e5cf7529.f1af08","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;\n\n// msg.picture = msg.payload[0].Picture ? msg.payload[0].Picture : msg.payload[0];\n// if(msg.picture.Hashtags.length) {\n//     msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n// }\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":1480,"wires":[["c3380de0.34c54"]]},{"id":"8af4dab7.34f5a8","type":"function","z":"8a997eeb.880fd","name":"buyerViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":1480,"wires":[["d5034174.9caf6"]]},{"id":"d5034174.9caf6","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3010,"y":1480,"wires":[["cce7f326.53a66"]]},{"id":"cce7f326.53a66","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.bySizeSearchType,\n        category_id: msg.category_id,\n        maxSize: msg.maxSize,\n        minSize: msg.minSize,\n    },\n};\nmsg.settings.searchType = msg.bySizeSearchType;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3180,"y":1480,"wires":[["3be27a44.d1a726"]]},{"id":"3be27a44.d1a726","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3350,"y":1480,"wires":[["714b032.4d427fc"]]},{"id":"1f6985d1.b984ea","type":"function","z":"8a997eeb.880fd","name":"buyerSearchByHashtag","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchByHashtag\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":460,"wires":[["b9201b3b.9ecdb8"]]},{"id":"b9201b3b.9ecdb8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":460,"wires":[["28fff71e.4375f8"]]},{"id":"28fff71e.4375f8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: 'inputSearchHashtags',\n    settings: {\n        picture_index: 0,\n        searchType: msg.byHashtagSearchType,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":460,"wires":[["f3d326c4.2530d8"]]},{"id":"f3d326c4.2530d8","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1090,"y":460,"wires":[[]]},{"id":"88b3bca7.b54de","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.text = msg.text.toLowerCase();\nmsg.hashtags = msg.text.replace(/\\s,./g, '');\nmsg.hashtags = msg.hashtags.split('#');\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1600,"wires":[["7ecb35fb.2681ac"]]},{"id":"b2a6ee1.8a67b1","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":810,"y":1600,"wires":[["9196a755.9472c8"]]},{"id":"7ecb35fb.2681ac","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost +`/pictureByHashtags`;\nmsg.method = \"POST\";\nmsg.payload = {\n    hashtags: msg.hashtags,\n    limit: 1,\n    user_id: msg.chat_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1600,"wires":[["b2a6ee1.8a67b1"]]},{"id":"c7ef5564.5479c8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":1580,"wires":[["f12fbc5c.38eda"]]},{"id":"2b47cb25.9ca664","type":"function","z":"8a997eeb.880fd","name":"buyerViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1810,"y":1580,"wires":[["5a4e156e.73accc"]]},{"id":"5a4e156e.73accc","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2010,"y":1580,"wires":[["122b98c7.32d097"]]},{"id":"122b98c7.32d097","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byHashtagSearchType,\n        category_id: msg.category_id,\n        searchHashtags: msg.hashtags,\n    },\n};\nmsg.settings.searchHashtags = msg.hashtags;\nmsg.settings.searchType = msg.byHashtagSearchType;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2180,"y":1580,"wires":[["7417e9f.426c818"]]},{"id":"7417e9f.426c818","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2350,"y":1580,"wires":[["88375f9b.0db04"]]},{"id":"375dcd42.a8f472","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3380,"y":1000,"wires":[["2f164512.1efeca"]]},{"id":"2f164512.1efeca","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3550,"y":1000,"wires":[["23c52bea.59c674"]]},{"id":"65877403.6b30fc","type":"switch","z":"8a997eeb.880fd","name":"","property":"settings.searchType","propertyType":"msg","rules":[{"t":"eq","v":"byHashtagSearchType","vt":"msg"},{"t":"eq","v":"byArtistSearchType","vt":"msg"},{"t":"eq","v":"byCategorySearchType","vt":"msg"},{"t":"eq","v":"bySizeSearchType","vt":"msg"},{"t":"eq","v":"byHistorySearchType","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":6,"x":2730,"y":980,"wires":[["b9e51f73.5f289"],["c7320762.a093c8"],["375dcd42.a8f472"],["375dcd42.a8f472"],["fefa9353.6b023"],[]]},{"id":"c7320762.a093c8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.settings.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2880,"y":960,"wires":[["c75b9ecc.161de"]]},{"id":"c75b9ecc.161de","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3050,"y":960,"wires":[["def3d540.bbe338"]]},{"id":"b9e51f73.5f289","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.Hashtags = msg.picture.Hashtags;\nmsg.searchHashtags = msg.settings.searchHashtags;\nmsg.searchHashtags = msg.searchHashtags.map(hashtag => hashtag.toLowerCase());\nmsg.Hashtags = msg.Hashtags.map(hashtag => ({\n    id: hashtag.id,\n    tag: hashtag.tag.toLowerCase(),\n}));\n\n\nmsg.hashtags_history_view_ids = msg.Hashtags.filter(hashtag => {\n    return msg.searchHashtags.includes(hashtag.tag);\n}).map(hashtag => hashtag.id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2880,"y":920,"wires":[["375dcd42.a8f472"]]},{"id":"def3d540.bbe338","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3220,"y":960,"wires":[["375dcd42.a8f472"]]},{"id":"b7a30da1.b4454","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2860,"y":800,"wires":[["df200b6d.02ae08"]]},{"id":"df200b6d.02ae08","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3030,"y":800,"wires":[[]]},{"id":"cf6526ef.21ef08","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.settings.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":800,"wires":[["91e5a11a.71c95"]]},{"id":"91e5a11a.71c95","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2530,"y":800,"wires":[["af4845e3.e29298"]]},{"id":"af4845e3.e29298","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2700,"y":800,"wires":[["b7a30da1.b4454"]]},{"id":"63813bb9.7b2c54","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":660,"wires":[["3242c486.19444c","4d9a2e39.6659a"]]},{"id":"3242c486.19444c","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1850,"y":660,"wires":[["5224ba5c.a6b974"]]},{"id":"4d9a2e39.6659a","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1670,"y":620,"wires":[]},{"id":"5224ba5c.a6b974","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1850,"y":620,"wires":[]},{"id":"714b032.4d427fc","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3520,"y":1480,"wires":[["c98eac.f2932158"]]},{"id":"c98eac.f2932158","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3690,"y":1480,"wires":[["a5653b25.29e7d8"]]},{"id":"88375f9b.0db04","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.Hashtags = msg.picture.Hashtags;\nmsg.searchHashtags = msg.settings.searchHashtags;\nmsg.searchHashtags = msg.searchHashtags.map(hashtag => hashtag.toLowerCase());\nmsg.Hashtags = msg.Hashtags.map(hashtag => ({\n    id: hashtag.id,\n    tag: hashtag.tag.toLowerCase(),\n}));\n\n\nmsg.hashtags_history_view_ids = msg.Hashtags.filter(hashtag => {\n    return msg.searchHashtags.includes(hashtag.tag);\n}).map(hashtag => hashtag.id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2520,"y":1580,"wires":[["b19b4895.184568"]]},{"id":"b19b4895.184568","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2680,"y":1580,"wires":[["9db071a0.6f697"]]},{"id":"9db071a0.6f697","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2850,"y":1580,"wires":[["5f9aae9d.9c3fb"]]},{"id":"239335f5.cecbba","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"viewHistory","vt":"str"},{"t":"eq","v":"viewLiked","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":190,"y":1920,"wires":[["ce7f30fc.caeac"],["14c8ea0d.4cf8e6"]]},{"id":"335fcd1b.c64cd2","type":"link in","z":"8a997eeb.880fd","name":"","links":["836c1127.be573"],"x":75,"y":1920,"wires":[["239335f5.cecbba"]]},{"id":"836c1127.be573","type":"link out","z":"b679fedf.127e3","name":"","links":["335fcd1b.c64cd2","5d43bcf3.5f73c4"],"x":555,"y":1760,"wires":[]},{"id":"ce7f30fc.caeac","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost +`/findPicturesByHistory?user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1860,"wires":[["98f30063.e81d9"]]},{"id":"98f30063.e81d9","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":1860,"wires":[["175bd892.a5dcc7"]]},{"id":"78fba30f.0f65dc","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0].Picture;\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":1840,"wires":[["f4449008.b5abb"]]},{"id":"c572824b.2f2ff","type":"function","z":"8a997eeb.880fd","name":"buyerViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1840,"wires":[["8cea2263.39d18"]]},{"id":"8cea2263.39d18","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":1840,"wires":[["92363db7.cb3ca"]]},{"id":"92363db7.cb3ca","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byHistorySearchType,\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1860,"y":1840,"wires":[["3840944e.00c90c"]]},{"id":"3840944e.00c90c","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2030,"y":1840,"wires":[["2576d9f3.4d04f6"]]},{"id":"b97f2026.5a3ab","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"like","vt":"str"},{"t":"cont","v":"apply","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":190,"y":2180,"wires":[["fb3b5f81.f882a"],["82d95903.4387e8"]]},{"id":"a264be47.14307","type":"link in","z":"8a997eeb.880fd","name":"","links":["99a62305.e1bb6"],"x":75,"y":2180,"wires":[["b97f2026.5a3ab"]]},{"id":"99a62305.e1bb6","type":"link out","z":"b679fedf.127e3","name":"","links":["a264be47.14307"],"x":555,"y":1880,"wires":[]},{"id":"fb3b5f81.f882a","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":2160,"wires":[["1e20f4fa.5d511b"]]},{"id":"1e20f4fa.5d511b","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost + \"/like\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    picture_id: msg.picture_id,\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2160,"wires":[["a3d5ddf.42caf2"]]},{"id":"a3d5ddf.42caf2","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":2160,"wires":[["e320631f.52454"]]},{"id":"a1c77f6c.13f1","type":"function","z":"8a997eeb.880fd","name":"buyerEditViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"buyerEditViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":2160,"wires":[["cd7d98cd.4261b8"]]},{"id":"cd7d98cd.4261b8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2250,"y":2160,"wires":[[]]},{"id":"e320631f.52454","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.like = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2160,"wires":[["40360cdd.978a24"]]},{"id":"40360cdd.978a24","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost +`/picture?id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":2160,"wires":[["3b17fb30.c872d4"]]},{"id":"3b17fb30.c872d4","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":2160,"wires":[["b7d91a9f.a2af38"]]},{"id":"17da4cda.df3303","type":"function","z":"8a997eeb.880fd","name":"buyerEditViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"buyerEditViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":980,"wires":[["9f998967.08b848"]]},{"id":"9f998967.08b848","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2570,"y":980,"wires":[["65877403.6b30fc"]]},{"id":"ce15308c.df4d3","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: msg.picture_index,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":3040,"wires":[["c36b2926.0c0548"]]},{"id":"c36b2926.0c0548","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1650,"y":3040,"wires":[["5d79baa0.b1d144","eed4086b.1ab768"]]},{"id":"5d79baa0.b1d144","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1630,"y":3000,"wires":[]},{"id":"d9b6d08f.6e615","type":"function","z":"873bdacb.594338","name":"artEditDeletePictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditDeletePictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":2880,"wires":[["adbfc453.341888"]]},{"id":"adbfc453.341888","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2170,"y":2880,"wires":[[]]},{"id":"1e550ad5.99f335","type":"switch","z":"873bdacb.594338","name":"","property":"settings.action","propertyType":"msg","rules":[{"t":"eq","v":"delete_picture_action","vt":"msg"},{"t":"eq","v":"edit_picture_action","vt":"msg"},{"t":"eq","v":"advertise_picture_action","vt":"msg"}],"checkall":"true","repair":false,"outputs":3,"x":1770,"y":2920,"wires":[["d9b6d08f.6e615"],["3154a306.4b143c"],["f025e4e5.ab3118"]]},{"id":"3154a306.4b143c","type":"function","z":"873bdacb.594338","name":"artEditEditPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditEditPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":2920,"wires":[["b3bcad39.c66a1"]]},{"id":"b3bcad39.c66a1","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":2920,"wires":[[]]},{"id":"f025e4e5.ab3118","type":"function","z":"873bdacb.594338","name":"artEditAdvertisingAllPictures","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditAdvertisingAllPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":2960,"wires":[["e2dde742.a640e8"]]},{"id":"e2dde742.a640e8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":2960,"wires":[["c213324b.530c9"]]},{"id":"14c8ea0d.4cf8e6","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost +`/findPicturesByLiked?user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1960,"wires":[["f3e02efb.ffcdd"]]},{"id":"f3e02efb.ffcdd","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":1960,"wires":[["90509969.5dd3d8"]]},{"id":"cf55df4c.f9cdb","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":1940,"wires":[["c501e2c0.1294e"]]},{"id":"8328657f.b7ecd8","type":"function","z":"8a997eeb.880fd","name":"buyerViewPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   //nickname: msg.nickname,\n\t   nickname: msg.artist.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":1940,"wires":[["6554095.4b642f8"]]},{"id":"6554095.4b642f8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1730,"y":1940,"wires":[["a3d6cc4d.b37f6"]]},{"id":"a3d6cc4d.b37f6","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byLikedSearchType,\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":1940,"wires":[["aa8e7c1e.70b5d"]]},{"id":"aa8e7c1e.70b5d","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2030,"y":1940,"wires":[["b66f6400.f78e28"]]},{"id":"8f51070c.8416a8","type":"function","z":"8a997eeb.880fd","name":"applicationWasSent","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"applicationWasSent\",\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":2200,"wires":[["8ceb6f52.db21a"]]},{"id":"8ceb6f52.db21a","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":2200,"wires":[["1dd63628.aa385a"]]},{"id":"82d95903.4387e8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":2200,"wires":[["8f51070c.8416a8"]]},{"id":"1dd63628.aa385a","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.imageApiHost +`/picture?id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":2200,"wires":[["e4cdb8f7.a062e8"]]},{"id":"e4cdb8f7.a062e8","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1090,"y":2200,"wires":[["8cc07272.1f93d"]]},{"id":"5a9f4347.aec2fc","type":"function","z":"8a997eeb.880fd","name":"notificationToAstistAboutApplying","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\n//msg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.picture.artist_id,\n    lang: msg.artist.lang,\n    templateName: \"notificationToAstistAboutApplying\",\n    templateVars: {\n        user_login: msg.originalMessage.callback_query.from.username,\n        phone: msg.phone,\n        picture_name: msg.picture.name,\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2000,"y":2200,"wires":[["9a560648.6eef78"]]},{"id":"9a560648.6eef78","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2250,"y":2200,"wires":[[]]},{"id":"50556521.e82b6c","type":"switch","z":"54326a95.39a714","name":"","property":"payload.pre_checkout_query","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":430,"y":120,"wires":[["6710975a.c011a8"],["5ac1c307.db7c6c"]]},{"id":"6710975a.c011a8","type":"function","z":"54326a95.39a714","name":"","func":"msg.url = `https://api.telegram.org/bot1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY/answerPreCheckoutQuery`\nmsg.payload = {\n    \"pre_checkout_query_id\": msg.payload.pre_checkout_query.id,\n    \"ok\": \"true\",\n    \"error_message\": \"\"\n};\nmsg.method = 'POST';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":100,"wires":[["c75e7077.96d6d"]]},{"id":"c75e7077.96d6d","type":"http request","z":"54326a95.39a714","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":100,"wires":[["f2558846.566378"]]},{"id":"b02c5959.cd1a18","type":"comment","z":"b679fedf.127e3","name":"сюди оплата зайшла","info":"","x":2360,"y":1060,"wires":[]},{"id":"8b82365f.af6558","type":"mqtt out","z":"54326a95.39a714","name":"","topic":"","qos":"0","retain":"false","broker":"60143c93.cf8174","x":390,"y":420,"wires":[]},{"id":"e82b06ef.4c3808","type":"inject","z":"54326a95.39a714","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"advertising","payload":"","payloadType":"date","x":160,"y":420,"wires":[["8b82365f.af6558"]]},{"id":"51cb7465.731efc","type":"link in","z":"873bdacb.594338","name":"","links":["9461190b.bf0578","62efcbaa.635294"],"x":2935,"y":360,"wires":[["a72c6316.5c896"]]},{"id":"61911fb1.80d29","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3280,"y":360,"wires":[["3d965ecd.947d62"]]},{"id":"6615acad.39a8e4","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost +`/findUsers`;\nmsg.method = \"POST\";\nmsg.payload = {\n    type: msg.buyerType\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4160,"y":360,"wires":[["13ce5a29.820776","3910b160.f5a37e"]]},{"id":"13ce5a29.820776","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":4330,"y":360,"wires":[["8f1c00f1.b2faa","934ce9cd.9afe58"]]},{"id":"934ce9cd.9afe58","type":"split","z":"873bdacb.594338","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":4470,"y":360,"wires":[["63c4b644.ecd118","381a9da6.086712"]]},{"id":"79f641f3.6f6ea","type":"mqtt out","z":"873bdacb.594338","name":"","topic":"","qos":"0","retain":"false","broker":"60143c93.cf8174","x":4790,"y":360,"wires":[]},{"id":"381a9da6.086712","type":"function","z":"873bdacb.594338","name":"","func":"msg.topic = \"advertising\";\nmsg.payload = {\n    chat_id: msg.payload.chat_id,\n    lang: msg.payload.lang,\n    \n    //nickname: msg.payload.nickname,\n    nickname: msg.artist.nickname,\n    \n    picture: msg.picture,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4640,"y":360,"wires":[["79f641f3.6f6ea","32969831.639f18"]]},{"id":"63c4b644.ecd118","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4750,"y":220,"wires":[]},{"id":"f1a6df55.000ba","type":"inject","z":"54326a95.39a714","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":240,"wires":[["61baf29.ed02b0c"]]},{"id":"61baf29.ed02b0c","type":"function","z":"54326a95.39a714","name":"","func":"msg.payload = {\n    \"update_id\": 642369448,\n    \"message\": {\n        \"message_id\": 5492,\n        \"from\": {\n            \"id\": 467013671,\n            \"is_bot\": false,\n            \"first_name\": \"Ірина\",\n            \"last_name\": \"Макар\",\n            \"username\": \"makarova_16\",\n            \"language_code\": \"uk\"\n        },\n        \"chat\": {\n            \"id\": 467013671,\n            \"first_name\": \"Ірина\",\n            \"last_name\": \"Макар\",\n            \"username\": \"makarova_16\",\n            \"type\": \"private\"\n        },\n        \"date\": 1616356947,\n        \"successful_payment\": {\n            \"currency\": \"UAH\",\n            \"total_amount\": 100,\n            \"invoice_payload\": \"advertising_52\",\n            \"telegram_payment_charge_id\": \"_\",\n            \"provider_payment_charge_id\": \"1597733822\"\n        }\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":240,"wires":[["50556521.e82b6c"]]},{"id":"8f1c00f1.b2faa","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4430,"y":200,"wires":[]},{"id":"3910b160.f5a37e","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3930,"y":180,"wires":[]},{"id":"62efcbaa.635294","type":"link out","z":"b679fedf.127e3","name":"","links":["51cb7465.731efc"],"x":495,"y":520,"wires":[]},{"id":"3d965ecd.947d62","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/picture?id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3420,"y":360,"wires":[["642fec77.487d54"]]},{"id":"642fec77.487d54","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3570,"y":360,"wires":[["f754635d.e4a5e"]]},{"id":"f754635d.e4a5e","type":"function","z":"873bdacb.594338","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":360,"wires":[["f181befb.4fc85"]]},{"id":"5a154b93.830524","type":"mqtt in","z":"8a997eeb.880fd","name":"","topic":"advertising","qos":"2","datatype":"auto","broker":"60143c93.cf8174","x":100,"y":2420,"wires":[["29df960.b67046a"]]},{"id":"29df960.b67046a","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.payload = JSON.parse(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":2420,"wires":[["3f280e25.092462"]]},{"id":"b7bc09de.b17298","type":"function","z":"8a997eeb.880fd","name":"","func":"//msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.messageApiHost = \"https://messageapi-pdp-art-bot.herokuapp.com\";\nmsg.url = msg.messageApiHost+\"/sendMessage\";\nmsg.method = \"POST\";\n\nmsg.picture = msg.payload.picture;\n\nmsg.payload = {\n    chat_id: msg.payload.chat_id,\n    lang: msg.payload.lang,\n    templateName: \"advertisingPictureMessage\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   \n\t   nickname: msg.payload.nickname,\n\t   \n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":2420,"wires":[["9345f44d.3576e8"]]},{"id":"9345f44d.3576e8","type":"http request","z":"8a997eeb.880fd","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":2420,"wires":[[]]},{"id":"46746ac5.d495a4","type":"inject","z":"54326a95.39a714","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":560,"wires":[["a13a62fc.7397d"]]},{"id":"d070e20a.b1bb3","type":"http request","z":"54326a95.39a714","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":610,"y":560,"wires":[["f417b2c4.32cac","d422d4e0.25c2b8"]]},{"id":"f417b2c4.32cac","type":"function","z":"54326a95.39a714","name":"","func":"msg.statistic = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":560,"wires":[["f3d723af.6cebb","cfdfaf4.bdeee5"]]},{"id":"f3d723af.6cebb","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":520,"wires":[]},{"id":"b0cccb6e.67e6e8","type":"function","z":"54326a95.39a714","name":"","func":"msg.url = msg.imageApiHost +`/getTotalStatisticByArtist?artist_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":560,"wires":[["b12b091.07e12f8","d070e20a.b1bb3"]]},{"id":"b12b091.07e12f8","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":520,"wires":[]},{"id":"d422d4e0.25c2b8","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":520,"wires":[]},{"id":"a13a62fc.7397d","type":"function","z":"54326a95.39a714","name":"","func":"msg.chat_id = 467013671;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":560,"wires":[["b0cccb6e.67e6e8"]]},{"id":"cfdfaf4.bdeee5","type":"function","z":"54326a95.39a714","name":"showStatisticByArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: 'uk',\n    templateName: \"showStatisticByArtist\",\n    templateVars: msg.statistic\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":560,"wires":[["20d0551b.0e678a"]]},{"id":"20d0551b.0e678a","type":"http request","z":"54326a95.39a714","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":560,"wires":[[]]},{"id":"a72c6316.5c896","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"advertising_","vt":"str"},{"t":"cont","v":"statisic_","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3060,"y":360,"wires":[["61911fb1.80d29"],["dc488d98.12771"]]},{"id":"aacfce5a.bca73","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3510,"y":460,"wires":[["73c196fc.d0b938","988f2e4e.83403"]]},{"id":"73c196fc.d0b938","type":"function","z":"873bdacb.594338","name":"","func":"msg.statistic = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3660,"y":460,"wires":[["647e4f7b.7c783","ed28502c.ed085"]]},{"id":"647e4f7b.7c783","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3650,"y":420,"wires":[]},{"id":"dc488d98.12771","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost +`/getTotalStatisticByArtist?artist_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3320,"y":460,"wires":[["63ca1bb8.9540c4","aacfce5a.bca73"]]},{"id":"63ca1bb8.9540c4","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3310,"y":420,"wires":[]},{"id":"988f2e4e.83403","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3490,"y":420,"wires":[]},{"id":"ed28502c.ed085","type":"function","z":"873bdacb.594338","name":"showStatisticByArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"showStatisticByArtist\",\n    templateVars: msg.statistic\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3940,"y":460,"wires":[["845953e4.77d58"]]},{"id":"845953e4.77d58","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":4210,"y":460,"wires":[[]]},{"id":"b55247b8.918f88","type":"http request","z":"873bdacb.594338","name":"","method":"use","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1000,"wires":[["61774785.1fa288"]]},{"id":"9da3df59.b4037","type":"debug","z":"873bdacb.594338","name":"21","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":1040,"wires":[]},{"id":"f38355d2.4a88c8","type":"function","z":"b679fedf.127e3","name":"contactWithAdministratorStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"contactWithAdministratorStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":1800,"wires":[["e60351f1.0159"]]},{"id":"e60351f1.0159","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":1800,"wires":[["13f4fa0d.d5f4a6"]]},{"id":"13f4fa0d.d5f4a6","type":"function","z":"b679fedf.127e3","name":"contactWithAdministrator","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"contactWithAdministrator\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":1800,"wires":[["c812947c.027858"]]},{"id":"c812947c.027858","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1800,"wires":[["54394d20.6a6404"]]},{"id":"54394d20.6a6404","type":"function","z":"b679fedf.127e3","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"contactWithAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":1800,"wires":[["8112ec3a.f1e3c"]]},{"id":"8112ec3a.f1e3c","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":1800,"wires":[[]]},{"id":"28b487fc.15e448","type":"link out","z":"8a997eeb.880fd","name":"to contact with administrator","links":["1fdc624a.7065ee"],"x":540,"y":1660,"wires":[],"l":true},{"id":"cf3a9ecd.6a09","type":"switch","z":"aa9d0df9.2dbd7","name":"","property":"type","propertyType":"msg","rules":[{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"artist","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1530,"y":360,"wires":[["fff496a1.7cdaf8"],["9e4bd31a.bd212"]]},{"id":"eaaa641a.5d7348","type":"function","z":"aa9d0df9.2dbd7","name":"helloBuyer","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloBuyer\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":420,"wires":[["45e0c2c1.9a74fc"]]},{"id":"45e0c2c1.9a74fc","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1870,"y":420,"wires":[[]]},{"id":"fff496a1.7cdaf8","type":"function","z":"aa9d0df9.2dbd7","name":"helloBuyerStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloBuyerStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":340,"wires":[["63de03b4.3037bc"]]},{"id":"63de03b4.3037bc","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1890,"y":340,"wires":[["52e2f19e.3d721"]]},{"id":"52e2f19e.3d721","type":"function","z":"aa9d0df9.2dbd7","name":"buyerMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2070,"y":340,"wires":[["d13d3dc0.32718"]]},{"id":"d13d3dc0.32718","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2250,"y":340,"wires":[["cdb962cb.7d393"]]},{"id":"b2c687b7.e4fd68","type":"switch","z":"b679fedf.127e3","name":"","property":"nickname","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":110,"y":880,"wires":[["799f8c6.7353774","a8e3c2f2.17eed"],[]]},{"id":"799f8c6.7353774","type":"function","z":"b679fedf.127e3","name":"helloArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":900,"wires":[["e4cc3aa3.4172b8"]]},{"id":"e4cc3aa3.4172b8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":430,"y":900,"wires":[[]]},{"id":"e387d46b.820318","type":"debug","z":"fe29b5bc.5d8348","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":320,"wires":[]},{"id":"2dad1ff.8f0dae","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2010,"y":1620,"wires":[]},{"id":"c2123795.ca3f28","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.buyerType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1680,"wires":[["1e5dbdad.63eba2"]]},{"id":"1e5dbdad.63eba2","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1680,"wires":[["597cd3af.4b255c"]]},{"id":"2576d9f3.4d04f6","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"viewHistory\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2200,"y":1840,"wires":[["a8054b26.b46078"]]},{"id":"a8054b26.b46078","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2370,"y":1840,"wires":[["35f48bde.b0a134"]]},{"id":"63f363dd.9d7bcc","type":"comment","z":"8a997eeb.880fd","name":"viewHistory","info":"","x":1840,"y":1860,"wires":[]},{"id":"d5caa23c.a413a","type":"switch","z":"8a997eeb.880fd","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"viewHistory","vt":"str"},{"t":"eq","v":"viewLiked","vt":"str"},{"t":"eq","v":"buyerMenu","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":470,"y":160,"wires":[["d98d4fa4.3dc3d"],["d98d4fa4.3dc3d"],["5c6ac94.cc82b38"],["5c6ac94.cc82b38"]]},{"id":"b66f6400.f78e28","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"viewLiked\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2200,"y":1940,"wires":[["42bc7a42.f05e84"]]},{"id":"42bc7a42.f05e84","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2370,"y":1940,"wires":[["99bbd6db.37a9e8"]]},{"id":"99bbd6db.37a9e8","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2510,"y":1940,"wires":[]},{"id":"35f48bde.b0a134","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2530,"y":1840,"wires":[]},{"id":"d98d4fa4.3dc3d","type":"function","z":"8a997eeb.880fd","name":"buyerMenu","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.buyerType,\n    lang: msg.lang,\n    templateName: \"buyerMenu\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":120,"wires":[["c188a44d.2e5958"]]},{"id":"c188a44d.2e5958","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":850,"y":120,"wires":[["36c69c5e.503064"]]},{"id":"36c69c5e.503064","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"buyerMenu\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":120,"wires":[["d115744c.e55a68"]]},{"id":"d115744c.e55a68","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":120,"wires":[["ea10ca1b.9c92d8"]]},{"id":"ea10ca1b.9c92d8","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":120,"wires":[]},{"id":"9196a755.9472c8","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":1600,"wires":[["c7ef5564.5479c8"],["d136bb55.90a138"]]},{"id":"d136bb55.90a138","type":"function","z":"8a997eeb.880fd","name":"buyerNOTSearchByHashtag","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerNOTSearchByHashtag\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":1620,"wires":[["e6139d4d.812eb"]]},{"id":"e6139d4d.812eb","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1410,"y":1620,"wires":[[]]},{"id":"3317a809.3213c8","type":"function","z":"873bdacb.594338","name":"artActionsNOTPictureSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTPictureSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":2180,"wires":[["847faca3.73672"]]},{"id":"847faca3.73672","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1750,"y":2180,"wires":[[]]},{"id":"ae60fe3.cc54","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.photo) {\n    msg.QQ = true;\n} \nelse msg.QQ = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2120,"wires":[["49ed887a.aa0f78"]]},{"id":"49ed887a.aa0f78","type":"switch","z":"873bdacb.594338","name":"","property":"QQ","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2120,"wires":[["1d6a761a.46d98a"],["f24ed31f.cc9cc"]]},{"id":"961f37aa.930408","type":"function","z":"873bdacb.594338","name":"","func":"msg.size = msg.text.split(\"-\");\n\nif (msg.size[0]!= 0 && msg.size[1]!= 0 && msg.size[1]!= null && msg.size[2]== null) {\n    \n    msg.size = true\n} else msg.size = false\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":2340,"wires":[["d6739a13.2c2098"]]},{"id":"d6739a13.2c2098","type":"switch","z":"873bdacb.594338","name":"","property":"size","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1150,"y":2340,"wires":[["f5b96ca5.27acd"],["bf5ccbfe.a12fb8"]]},{"id":"bf5ccbfe.a12fb8","type":"function","z":"873bdacb.594338","name":"artActionsNOTSizeSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTSizeSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":2360,"wires":[["f0e9e533.9c16d8"]]},{"id":"f0e9e533.9c16d8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1890,"y":2360,"wires":[[]]},{"id":"f245b97b.ef1ae8","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"addPictureSize","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":340,"y":2360,"wires":[[]]},{"id":"45141290.2b8b3c","type":"function","z":"fe29b5bc.5d8348","name":"artActionsNOTPictureSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorNumber\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":260,"wires":[["e2239eab.02ba2"]]},{"id":"e2239eab.02ba2","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":260,"wires":[[]]},{"id":"f5b96ca5.27acd","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"regex","v":"(?=.*[a-zA-Zа-яА-Я])(?=.*)[a-zA-Zа-яА-Я]+","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1290,"y":2320,"wires":[["bf5ccbfe.a12fb8"],["b2e71246.2d97b"]]},{"id":"3d4e7656.6bd0da","type":"function","z":"fe29b5bc.5d8348","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"startNumberMessage\",\n    settings: {\n        restart: true,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":100,"wires":[["20436dd2.47e332"]]},{"id":"20436dd2.47e332","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":100,"wires":[[]]},{"id":"71e3a6da.6b83f8","type":"switch","z":"fe29b5bc.5d8348","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"startNumberMessage","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":200,"wires":[["92ba5cc6.f33d9"],["84161ff5.b618c"]]},{"id":"ab106b7.1919d98","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.TT = true;\n} \nelse msg.TT = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2260,"wires":[["21339ab5.a0db46"]]},{"id":"21339ab5.a0db46","type":"switch","z":"873bdacb.594338","name":"","property":"TT","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2260,"wires":[["e48edd43.2a0e6"],["19226a66.28a4e6"]]},{"id":"19226a66.28a4e6","type":"function","z":"873bdacb.594338","name":"artActionsNOTDescriotionSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTDescriotionSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":2280,"wires":[["7947f283.32f4bc"]]},{"id":"7947f283.32f4bc","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":2280,"wires":[[]]},{"id":"b96b99b2.62f758","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.SS = true;\n} \nelse msg.SS = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2360,"wires":[["50ef5522.35ccfc"]]},{"id":"50ef5522.35ccfc","type":"switch","z":"873bdacb.594338","name":"","property":"SS","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2360,"wires":[["961f37aa.930408"],["bf5ccbfe.a12fb8"]]},{"id":"8ec9accf.0b5f6","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.HH = true;\n} \nelse msg.HH = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2500,"wires":[["d0889e1d.8b88e"]]},{"id":"d0889e1d.8b88e","type":"switch","z":"873bdacb.594338","name":"","property":"HH","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2500,"wires":[["1e7a8e67.bede12"],["95916398.0b6b4"]]},{"id":"95916398.0b6b4","type":"function","z":"873bdacb.594338","name":"artActionsNOTDescriotionSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTDescriotionSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":2540,"wires":[["ca050d1e.6f9f6"]]},{"id":"ca050d1e.6f9f6","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":2540,"wires":[[]]},{"id":"273d90f2.2c657","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.DD = true;\n} \nelse msg.DD = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2640,"wires":[["dbcc846e.0d1198"]]},{"id":"dbcc846e.0d1198","type":"switch","z":"873bdacb.594338","name":"","property":"DD","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2640,"wires":[["81f535a0.2ebdc8"],["985c5242.54227"]]},{"id":"985c5242.54227","type":"function","z":"873bdacb.594338","name":"artActionsNOTDescriotionSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTDescriotionSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":2660,"wires":[["8958e41f.91f508"]]},{"id":"8958e41f.91f508","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":2660,"wires":[[]]},{"id":"3df5045a.a5803c","type":"switch","z":"b679fedf.127e3","name":"","property":"nickname","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":1370,"y":500,"wires":[["780781bb.ea5b"],["a4748e3f.04fae"],["780781bb.ea5b"]]},{"id":"38efc119.4c063e","type":"function","z":"b679fedf.127e3","name":"helloArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistStiker\",\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":520,"wires":[["621fcece.a7f24"]]},{"id":"621fcece.a7f24","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2570,"y":520,"wires":[["65213e07.1ff39"]]},{"id":"2be184e2.f76b1c","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1850,"y":520,"wires":[["7a4b3d36.4119f4"]]},{"id":"fbe24764.3c7128","type":"function","z":"b679fedf.127e3","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":520,"wires":[["2be184e2.f76b1c"]]},{"id":"a8e3c2f2.17eed","type":"link out","z":"b679fedf.127e3","name":"","links":["5b36f5ca.00b06c"],"x":215,"y":860,"wires":[]},{"id":"b60a7f4d.1ebc4","type":"function","z":"fe29b5bc.5d8348","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    // nickname: msg.text,\n    //nickname: \"0\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2200,"y":160,"wires":[["9872bd8c.1753d"]]},{"id":"9872bd8c.1753d","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2370,"y":160,"wires":[["a37e0cd0.84206"]]},{"id":"7a4b3d36.4119f4","type":"function","z":"b679fedf.127e3","name":"helloArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtist\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2020,"y":520,"wires":[["597b0edc.14cbb"]]},{"id":"597b0edc.14cbb","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2190,"y":520,"wires":[["38efc119.4c063e"]]},{"id":"25a834da.35818c","type":"function","z":"b679fedf.127e3","name":"errorTextStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorTextStiker\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":1360,"wires":[["9b47495d.8892b8"]]},{"id":"9b47495d.8892b8","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1670,"y":1360,"wires":[["17f54753.1cd5b9"]]},{"id":"17f54753.1cd5b9","type":"function","z":"b679fedf.127e3","name":"errorText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorText\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":1360,"wires":[["ea53bccd.d9957"]]},{"id":"ea53bccd.d9957","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2010,"y":1360,"wires":[[]]},{"id":"c2c47e7f.03319","type":"function","z":"aa9d0df9.2dbd7","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artistMenu\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":380,"wires":[["6bada487.0936ec"]]},{"id":"6bada487.0936ec","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2550,"y":380,"wires":[["c45dc77c.e4c8d8"]]},{"id":"ba8c6628.114478","type":"function","z":"fe29b5bc.5d8348","name":"changeTypeToArtistStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistSettings\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":480,"wires":[["5a22fb16.ac7f14"]]},{"id":"5a22fb16.ac7f14","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":480,"wires":[[]]},{"id":"53f51767.63ff08","type":"link out","z":"fe29b5bc.5d8348","name":"","links":["40cf8292.f004ac"],"x":435,"y":560,"wires":[]},{"id":"40cf8292.f004ac","type":"link in","z":"b679fedf.127e3","name":"","links":["53f51767.63ff08"],"x":2355,"y":460,"wires":[["c56116e1.9855f8"]]},{"id":"5c6bb266.03f27c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":800,"wires":[["7d0be8e7.901f28"]]},{"id":"7d0be8e7.901f28","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":800,"wires":[["502e06e3.4c6b88"]]},{"id":"502e06e3.4c6b88","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1460,"y":800,"wires":[["aae96a5a.ffff98"]]},{"id":"e75d6cf2.8c6c3","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":980,"wires":[["38882824.069b18"]]},{"id":"38882824.069b18","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1990,"y":980,"wires":[["c14b563d.7baeb8"]]},{"id":"c14b563d.7baeb8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2160,"y":980,"wires":[["17da4cda.df3303"]]},{"id":"3e4e328.e62fbce","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":2560,"wires":[["374794cc.bc0c2c"]]},{"id":"374794cc.bc0c2c","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":350,"y":2560,"wires":[["75291083.9fd15"]]},{"id":"75291083.9fd15","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2560,"wires":[[]]},{"id":"cc180b1d.2144e8","type":"comment","z":"8a997eeb.880fd","name":"чи тут треба оце?","info":"","x":290,"y":2600,"wires":[]},{"id":"bfea180d.f6d458","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1240,"y":1980,"wires":[["c58fe96d.35f768"]]},{"id":"c58fe96d.35f768","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1390,"y":1980,"wires":[["cd82f570.00ef18"]]},{"id":"cd82f570.00ef18","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1560,"y":1980,"wires":[["de9bd35e.a5fda"]]},{"id":"cd93b18b.6fbfc","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":3600,"wires":[["c9fd5594.0e2538"]]},{"id":"c9fd5594.0e2538","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2090,"y":3600,"wires":[["96067325.3b24"]]},{"id":"96067325.3b24","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":3600,"wires":[["59b12533.68a51c"]]},{"id":"15e98be.49c5074","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3800,"wires":[["c04bfaae.666938"]]},{"id":"c04bfaae.666938","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":3800,"wires":[["a431dcca.a58ae"]]},{"id":"a431dcca.a58ae","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":3800,"wires":[["9c9f7abd.ed23a8"]]},{"id":"e1c4b70b.9b8238","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":1240,"wires":[["44c92203.340cdc"]]},{"id":"44c92203.340cdc","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2050,"y":1240,"wires":[["ad844c11.6592c"]]},{"id":"ad844c11.6592c","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2220,"y":1240,"wires":[["36adb7ff.268888"]]},{"id":"f0c31433.2b5a38","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3180,"wires":[["6108be79.3e88c"]]},{"id":"6108be79.3e88c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":3180,"wires":[["df051e9d.bef33"]]},{"id":"df051e9d.bef33","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":3180,"wires":[["a9643e82.bb1ed"]]},{"id":"4d09dde6.bb3a84","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":3080,"wires":[["a5b6346f.cfc5c8"]]},{"id":"a5b6346f.cfc5c8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2130,"y":3080,"wires":[["b38738b6.bdc358"]]},{"id":"b38738b6.bdc358","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":3080,"wires":[["b6ecff6a.e62ea"]]},{"id":"630080eb.000d8","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":3000,"wires":[["1da5239b.28420c"]]},{"id":"1da5239b.28420c","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2130,"y":3000,"wires":[["a8ca05ad.366908"]]},{"id":"a8ca05ad.366908","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":3000,"wires":[["9352ad04.a211"]]},{"id":"d2f93ccf.59878","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":3040,"wires":[["beef6989.f9ec18"]]},{"id":"beef6989.f9ec18","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2130,"y":3040,"wires":[["6fc465d0.63bebc"]]},{"id":"6fc465d0.63bebc","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":3040,"wires":[["36117cee.865bd4"]]},{"id":"c145718a.96921","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1860,"y":1060,"wires":[["a94e8a0f.f643e8"]]},{"id":"a94e8a0f.f643e8","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2030,"y":1060,"wires":[["2fefd690.98426a"]]},{"id":"2fefd690.98426a","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2200,"y":1060,"wires":[["c4dbfd75.5e323"]]},{"id":"6814c3de.03a33c","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3380,"wires":[["16f146a2.fdeed9"]]},{"id":"16f146a2.fdeed9","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1160,"y":3380,"wires":[["1bbafccb.a2d283"]]},{"id":"1bbafccb.a2d283","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":3380,"wires":[["7b92689.695ef98"]]},{"id":"f88a90bd.25a5e","type":"comment","z":"8a997eeb.880fd","name":"category","info":"","x":1510,"y":840,"wires":[]},{"id":"39c0dafa.b0de26","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":4520,"wires":[["362a5def.8ac3a2"]]},{"id":"362a5def.8ac3a2","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":4520,"wires":[["1ab6882b.9d5af8"]]},{"id":"1ab6882b.9d5af8","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":4520,"wires":[["8cdb5160.4d2f3"]]},{"id":"1cfa8e61.afa142","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":2160,"wires":[["a8674b5c.ae3518"]]},{"id":"a8674b5c.ae3518","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1670,"y":2160,"wires":[["4942e3fc.75b65c"]]},{"id":"4942e3fc.75b65c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":2160,"wires":[["a1c77f6c.13f1"]]},{"id":"6ddbff1a.8e727","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":620,"wires":[["f71007a7.1b0218"]]},{"id":"f71007a7.1b0218","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":870,"y":620,"wires":[["dbd3e282.54dae"]]},{"id":"dbd3e282.54dae","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":620,"wires":[["29eeb34b.f4259c"]]},{"id":"c3380de0.34c54","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":1480,"wires":[["b2ff4d54.765d4"]]},{"id":"b2ff4d54.765d4","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2430,"y":1480,"wires":[["6dc59038.980b6"]]},{"id":"6dc59038.980b6","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2610,"y":1480,"wires":[["8af4dab7.34f5a8"]]},{"id":"f12fbc5c.38eda","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":1580,"wires":[["805ff839.ead428"]]},{"id":"805ff839.ead428","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":1580,"wires":[["704fe803.0eda08"]]},{"id":"704fe803.0eda08","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":1580,"wires":[["2b47cb25.9ca664"]]},{"id":"f4449008.b5abb","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":1840,"wires":[["bab6887d.c0ae08"]]},{"id":"bab6887d.c0ae08","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1840,"wires":[["205cecde.3d4b04"]]},{"id":"205cecde.3d4b04","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1840,"wires":[["c572824b.2f2ff"]]},{"id":"c501e2c0.1294e","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":1940,"wires":[["507b276a.fc3bf8"]]},{"id":"507b276a.fc3bf8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":1940,"wires":[["bf10a455.1545a8"]]},{"id":"bf10a455.1545a8","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":1940,"wires":[["8328657f.b7ecd8"]]},{"id":"3331f9b9.80e836","type":"comment","z":"873bdacb.594338","name":"тут додала","info":"","x":4420,"y":420,"wires":[]},{"id":"f181befb.4fc85","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3800,"y":280,"wires":[["c5bbb00e.5170a"]]},{"id":"c5bbb00e.5170a","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3950,"y":280,"wires":[["ef6627b6.c900a8"]]},{"id":"ef6627b6.c900a8","type":"function","z":"873bdacb.594338","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4120,"y":280,"wires":[["62b4377f.2717d8","6615acad.39a8e4"]]},{"id":"32969831.639f18","type":"debug","z":"873bdacb.594338","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4730,"y":440,"wires":[]},{"id":"62b4377f.2717d8","type":"debug","z":"873bdacb.594338","name":"11","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4710,"y":300,"wires":[]},{"id":"dfcfed5f.ac4d5","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1420,"y":2200,"wires":[["8fb5aa85.ffe5f8"]]},{"id":"8fb5aa85.ffe5f8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":2200,"wires":[["3ba3a8d8.77ea78"]]},{"id":"3ba3a8d8.77ea78","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1760,"y":2200,"wires":[["5a9f4347.aec2fc"]]},{"id":"8cc07272.1f93d","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":2200,"wires":[["dfcfed5f.ac4d5"]]},{"id":"d7a6f75.2662108","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":2060,"wires":[[]]},{"id":"d5b562a8.48c98","type":"comment","z":"54326a95.39a714","name":"1730284858:AAHdzHY6NkNnPRuHMtl6PF1evR8BpcejtyY","info":"","x":890,"y":380,"wires":[]},{"id":"72a7bf55.5f15f","type":"comment","z":"54326a95.39a714","name":"1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8","info":"","x":880,"y":420,"wires":[]},{"id":"581a4d7a.1aea24","type":"link out","z":"b679fedf.127e3","name":"","links":["f2cb3c2a.60f0e"],"x":1275,"y":1340,"wires":[]},{"id":"cb4899b4.729e58","type":"debug","z":"fe29b5bc.5d8348","name":"Base","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":150,"y":120,"wires":[]},{"id":"a16c7247.2f9f2","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":730,"y":620,"wires":[[]]},{"id":"6a01d400.e013bc","type":"function","z":"fe29b5bc.5d8348","name":"startNumberMessage","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    templateName: \"startNOTNumberMessage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":620,"wires":[["a16c7247.2f9f2"]]},{"id":"a37e0cd0.84206","type":"function","z":"fe29b5bc.5d8348","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"chooseLanguage\",\n    // settings: {\n    //     restart: true,\n    // }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2540,"y":160,"wires":[["336969f4.fa41f6"]]},{"id":"336969f4.fa41f6","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2710,"y":160,"wires":[[]]},{"id":"b2e71246.2d97b","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"(","vt":"str"},{"t":"cont","v":")","vt":"str"},{"t":"cont","v":".","vt":"str"},{"t":"cont","v":",","vt":"str"},{"t":"cont","v":":","vt":"str"},{"t":"cont","v":";","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":7,"x":1450,"y":2340,"wires":[["bf5ccbfe.a12fb8"],["bf5ccbfe.a12fb8"],["bf5ccbfe.a12fb8"],["bf5ccbfe.a12fb8"],["bf5ccbfe.a12fb8"],["bf5ccbfe.a12fb8"],["812c3aa2.9d0e98"]]},{"id":"375d2b1c.6d7934","type":"function","z":"b679fedf.127e3","name":"changeArtistName","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistName\",\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":680,"wires":[["bab01230.ca708"]]},{"id":"bab01230.ca708","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3010,"y":640,"wires":[["1eaf5452.a29f6c"]]},{"id":"8cfffa02.980be8","type":"debug","z":"b679fedf.127e3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3170,"y":600,"wires":[]},{"id":"1eaf5452.a29f6c","type":"function","z":"b679fedf.127e3","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"changeArtistName\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3180,"y":640,"wires":[["8cfffa02.980be8","a58f3070.1a1ef"]]},{"id":"a58f3070.1a1ef","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3350,"y":640,"wires":[[]]},{"id":"a4748e3f.04fae","type":"switch","z":"b679fedf.127e3","name":"","property":"payload.settings.restart","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1530,"y":500,"wires":[["780781bb.ea5b"],["fbe24764.3c7128"],["780781bb.ea5b"]]},{"id":"4f7aee9d.b3254","type":"function","z":"fe29b5bc.5d8348","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"chooseLanguage\",\n    settings: {\n        restart: false,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":520,"wires":[["a623629a.b4cbf"]]},{"id":"a623629a.b4cbf","type":"http request","z":"fe29b5bc.5d8348","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1510,"y":520,"wires":[[]]},{"id":"1e8953f0.82cd7c","type":"switch","z":"b679fedf.127e3","name":"","property":"originalMessage.message.text","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1310,"y":1300,"wires":[["25a834da.35818c"],["e68e3a0e.a40148"]]},{"id":"c7b84001.7ad69","type":"function","z":"873bdacb.594338","name":"artActionsNOTPictureSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTPictureSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":4680,"wires":[["5acea1f5.dbae9"]]},{"id":"5acea1f5.dbae9","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":4680,"wires":[[]]},{"id":"e780d4f6.057678","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.photo) {\n    msg.QQ = true;\n} \nelse msg.QQ = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4660,"wires":[["6061d3ba.ff8e6c"]]},{"id":"6061d3ba.ff8e6c","type":"switch","z":"873bdacb.594338","name":"","property":"QQ","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":4660,"wires":[["20711b8.88135e4"],["c7b84001.7ad69"]]},{"id":"cae2549a.3b3e18","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.TT = true;\n} \nelse msg.TT = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4740,"wires":[["a715e41b.8556a8"]]},{"id":"a715e41b.8556a8","type":"switch","z":"873bdacb.594338","name":"","property":"TT","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":4740,"wires":[["b6eb11eb.f04f4"],["5ac5486f.0ad728"]]},{"id":"5ac5486f.0ad728","type":"function","z":"873bdacb.594338","name":"artActionsNOTDescriotionSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTDescriotionSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":4760,"wires":[["76746117.d2f2d"]]},{"id":"76746117.d2f2d","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":4760,"wires":[[]]},{"id":"f6d581b4.d2a79","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"cont","v":"editPostImage_","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":820,"wires":[["dd0e469.39117b8"],["55eae37a.d340bc"]]},{"id":"aa23ee55.5a794","type":"debug","z":"873bdacb.594338","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":3420,"wires":[]},{"id":"64afe071.4e93a","type":"debug","z":"873bdacb.594338","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2190,"y":3420,"wires":[]},{"id":"6f018b10.7cf5b4","type":"debug","z":"873bdacb.594338","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1910,"y":3420,"wires":[]},{"id":"f2fc1623.591418","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3170,"y":4800,"wires":[["6ecfb529.f03e6c"]]},{"id":"89c592b.ba7927","type":"function","z":"873bdacb.594338","name":"","func":"msg.url = msg.imageApiHost + \"/picture\";\nmsg.method = \"POST\";\nmsg.size = msg.text.split(\"-\");\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    //height: msg.text.split('-')[0],\n    //width: msg.text.split('-')[1]\n    height: msg.size[0],\n    width: msg.size[1]\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3000,"y":4800,"wires":[["f2fc1623.591418"]]},{"id":"6ecfb529.f03e6c","type":"link out","z":"873bdacb.594338","name":"","links":["79e82596.8c6f3c"],"x":3295,"y":4800,"wires":[]},{"id":"7f45e832.ad2818","type":"function","z":"873bdacb.594338","name":"","func":"msg.size = msg.text.split(\"-\");\n\nif (msg.size[0]!= 0 && msg.size[1]!= 0 && msg.size[1]!= null && msg.size[2]== null) {\n    \n    msg.size = true\n} else msg.size = false\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":4940,"wires":[["4bf2a8b5.a60838"]]},{"id":"4bf2a8b5.a60838","type":"switch","z":"873bdacb.594338","name":"","property":"size","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1050,"y":4940,"wires":[["6880cb9b.8458e4"],["12fff64d.7e590a"]]},{"id":"12fff64d.7e590a","type":"function","z":"873bdacb.594338","name":"artActionsNOTSizeSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTSizeSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":4940,"wires":[["b70903dc.51da4"]]},{"id":"b70903dc.51da4","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2190,"y":4940,"wires":[[]]},{"id":"6880cb9b.8458e4","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"regex","v":"(?=.*[a-zA-Zа-яА-Я])(?=.*)[a-zA-Zа-яА-Я]+","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":4940,"wires":[["12fff64d.7e590a"],["915643ea.35004"]]},{"id":"15910595.1bb30a","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.SS = true;\n} \nelse msg.SS = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4960,"wires":[["65a0be31.fcfca"]]},{"id":"65a0be31.fcfca","type":"switch","z":"873bdacb.594338","name":"","property":"SS","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":4960,"wires":[["7f45e832.ad2818"],["12fff64d.7e590a"]]},{"id":"811cd1e2.d987b","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.HH = true;\n} \nelse msg.HH = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4820,"wires":[["f85bf039.d77f3"]]},{"id":"f85bf039.d77f3","type":"switch","z":"873bdacb.594338","name":"","property":"HH","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":4820,"wires":[["bc1def2e.034c5"],["f1760d10.70aa9"]]},{"id":"f1760d10.70aa9","type":"function","z":"873bdacb.594338","name":"artActionsNOTDescriotionSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTDescriotionSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":4840,"wires":[["99522521.666718"]]},{"id":"99522521.666718","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":4840,"wires":[[]]},{"id":"da641564.a5aea8","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.DD = true;\n} \nelse msg.DD = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4900,"wires":[["3d987cfe.1f41a4"]]},{"id":"3d987cfe.1f41a4","type":"switch","z":"873bdacb.594338","name":"","property":"DD","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":4900,"wires":[["a90383c8.8467"],["30f4abae.e06ed4"]]},{"id":"30f4abae.e06ed4","type":"function","z":"873bdacb.594338","name":"artActionsNOTDescriotionSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTDescriotionSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":4920,"wires":[["9072209.cee09e"]]},{"id":"9072209.cee09e","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":4920,"wires":[[]]},{"id":"dd0e469.39117b8","type":"link out","z":"873bdacb.594338","name":"","links":["7dc96063.78c5b"],"x":695,"y":780,"wires":[]},{"id":"2cd55850.d86358","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToArtistMenu\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1660,"y":860,"wires":[["7e4b86bf.1e0888"]]},{"id":"7e4b86bf.1e0888","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1830,"y":860,"wires":[[]]},{"id":"f24ed31f.cc9cc","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1010,"y":2160,"wires":[["5c198ded.dc6cc4"],["3317a809.3213c8"]]},{"id":"71eee101.82b9b","type":"link out","z":"873bdacb.594338","name":"","links":["db6b7ab1.baa748"],"x":1435,"y":2140,"wires":[]},{"id":"db6b7ab1.baa748","type":"link in","z":"b679fedf.127e3","name":"","links":["71eee101.82b9b"],"x":1335,"y":1420,"wires":[["25a834da.35818c"]]},{"id":"5c198ded.dc6cc4","type":"function","z":"873bdacb.594338","name":"","func":"if(msg.originalMessage.message.sticker || msg.originalMessage.message.document) {\n    msg.QQ = true;\n} \nelse msg.QQ = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":2140,"wires":[["5bf573b9.b3991c"]]},{"id":"5bf573b9.b3991c","type":"switch","z":"873bdacb.594338","name":"","property":"QQ","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1330,"y":2140,"wires":[["3317a809.3213c8"],["71eee101.82b9b"]]},{"id":"417afa8d.ea9374","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"cont","v":"editPostSize_","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1690,"y":2100,"wires":[["cd51c3af.ef3dd"],["cf15cced.31bff"]]},{"id":"cd51c3af.ef3dd","type":"link out","z":"873bdacb.594338","name":"","links":["7dc96063.78c5b"],"x":1795,"y":2080,"wires":[]},{"id":"c14ec69b.0a2468","type":"switch","z":"873bdacb.594338","name":"","property":"state","propertyType":"msg","rules":[{"t":"cont","v":"editPostSize_","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":1580,"wires":[["9d01a722.a046a8"],["28c12a3a.bfac36"]]},{"id":"9d01a722.a046a8","type":"link out","z":"873bdacb.594338","name":"","links":["7dc96063.78c5b"],"x":835,"y":1580,"wires":[]},{"id":"2b41c8ee.f1ccd8","type":"function","z":"b679fedf.127e3","name":"errorTextStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorTextStiker\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":1920,"wires":[["29d61740.027198"]]},{"id":"29d61740.027198","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":1920,"wires":[["6ba51cd2.f9df64"]]},{"id":"6ba51cd2.f9df64","type":"function","z":"b679fedf.127e3","name":"errorText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorText\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":1920,"wires":[["e377db42.266b38"]]},{"id":"e377db42.266b38","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1920,"wires":[[]]},{"id":"378ad992.26e356","type":"function","z":"8a997eeb.880fd","name":"errorTextStiker","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorTextStiker\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":1700,"wires":[["6d9f5341.2cecbc"]]},{"id":"6d9f5341.2cecbc","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":690,"y":1700,"wires":[["998cca8.113df38"]]},{"id":"998cca8.113df38","type":"function","z":"8a997eeb.880fd","name":"errorText","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"errorText\"\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":1700,"wires":[["2e0c6094.e98e8"]]},{"id":"2e0c6094.e98e8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":1700,"wires":[[]]},{"id":"872e2941.edff38","type":"comment","z":"8a997eeb.880fd","name":"otut","info":"","x":290,"y":1400,"wires":[]},{"id":"dbd69ae6.0d3868","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.size = msg.text.split(\"-\");\n\nif (msg.size[0]!= 0 && msg.size[1]!= 0 && msg.size[1]!= null && msg.size[2]== null) {\n    \n    msg.size = true\n} else msg.size = false\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1300,"wires":[["58aee409.5444dc"]]},{"id":"58aee409.5444dc","type":"switch","z":"8a997eeb.880fd","name":"","property":"size","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1070,"y":1300,"wires":[["db4ca744.559318"],["bd144c7d.1bd22"]]},{"id":"bd144c7d.1bd22","type":"function","z":"8a997eeb.880fd","name":"artActionsNOTSizeSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTSizeSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":1320,"wires":[["c440b844.3084c8"]]},{"id":"c440b844.3084c8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1770,"y":1300,"wires":[[]]},{"id":"db4ca744.559318","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"regex","v":"(?=.*[a-zA-Zа-яА-Я])(?=.*)[a-zA-Zа-яА-Я]+","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1210,"y":1300,"wires":[["bd144c7d.1bd22"],["e3871dfc.72f0f"]]},{"id":"41cda4be.419a6c","type":"function","z":"8a997eeb.880fd","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.SS = true;\n} \nelse msg.SS = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":1320,"wires":[["5c618b8e.6528b4"]]},{"id":"5c618b8e.6528b4","type":"switch","z":"8a997eeb.880fd","name":"","property":"SS","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":1320,"wires":[["dbd69ae6.0d3868"],["bd144c7d.1bd22"]]},{"id":"e3871dfc.72f0f","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":".","vt":"str"},{"t":"cont","v":"(","vt":"str"},{"t":"cont","v":")","vt":"str"},{"t":"cont","v":",","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":5,"x":1330,"y":1360,"wires":[["bd144c7d.1bd22"],["bd144c7d.1bd22"],["bd144c7d.1bd22"],["bd144c7d.1bd22"],["737f83fd.b005bc"]]},{"id":"6baafda9.2cbd24","type":"switch","z":"8a997eeb.880fd","name":"","property":"originalMessage.callback_query.data","propertyType":"msg","rules":[{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":1300,"wires":[["591687c7.0dbaa8"],["41cda4be.419a6c"]]},{"id":"24c8438f.06c65c","type":"link in","z":"8a997eeb.880fd","name":"","links":["1ebd0f98.fd84b","35b8074c.315968"],"x":375,"y":380,"wires":[["fe143a49.87dd08"]]},{"id":"7054c306.c7b40c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.size = msg.text.split(\"-\");\n\nif (msg.size[0]!= 0 && msg.size[1]!= 0 && msg.size[1]!= null && msg.size[2]== null) {\n    \n    msg.size = true\n} else msg.size = false\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":520,"wires":[["dee9c715.0bf1c8"]]},{"id":"dee9c715.0bf1c8","type":"switch","z":"8a997eeb.880fd","name":"","property":"size","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1270,"y":520,"wires":[["a8ddf3b.21e791"],["cb201ccb.6f7f4"]]},{"id":"cb201ccb.6f7f4","type":"function","z":"8a997eeb.880fd","name":"artActionsNOTSizeSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTSizeSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":560,"wires":[["5cbbb293.880b7c"]]},{"id":"5cbbb293.880b7c","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1870,"y":560,"wires":[[]]},{"id":"a8ddf3b.21e791","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"regex","v":"(?=.*[a-zA-Zа-яА-Я])(?=.*)[a-zA-Zа-яА-Я]+","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":520,"wires":[["cb201ccb.6f7f4"],["90ffe1e0.8e42e"]]},{"id":"453e4826.caded8","type":"function","z":"8a997eeb.880fd","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.SS = true;\n} \nelse msg.SS = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":540,"wires":[["25ce38d5.d541c8"]]},{"id":"25ce38d5.d541c8","type":"switch","z":"8a997eeb.880fd","name":"","property":"SS","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":990,"y":540,"wires":[["7054c306.c7b40c"],["cb201ccb.6f7f4"]]},{"id":"90ffe1e0.8e42e","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":".","vt":"str"},{"t":"cont","v":"(","vt":"str"},{"t":"cont","v":")","vt":"str"},{"t":"cont","v":",","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":1330,"y":560,"wires":[["cb201ccb.6f7f4"],["cb201ccb.6f7f4"],["cb201ccb.6f7f4"],["cb201ccb.6f7f4"],[]]},{"id":"dd8b34d1.97e378","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.picture.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":1420,"wires":[["4d18ac01.8ba6c4"]]},{"id":"4d18ac01.8ba6c4","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1830,"y":1420,"wires":[[]]},{"id":"78b0f2f.2a3430c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.size = msg.text.split(\"-\");\n\nif (msg.size[0]!= 0 && msg.size[1]!= 0 && msg.size[1]!= null && msg.size[2]== null) {\n    \n    msg.size = true\n} else msg.size = false\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1440,"wires":[["5ec73e29.4aa95"]]},{"id":"5ec73e29.4aa95","type":"switch","z":"8a997eeb.880fd","name":"","property":"size","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1010,"y":1440,"wires":[["7a88dd6c.302a54"],["7107f051.26d3d"]]},{"id":"7107f051.26d3d","type":"function","z":"8a997eeb.880fd","name":"artActionsNOTSizeSend","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsNOTSizeSend\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1510,"y":1460,"wires":[["be5a1323.773b3"]]},{"id":"be5a1323.773b3","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1730,"y":1460,"wires":[[]]},{"id":"7a88dd6c.302a54","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"regex","v":"(?=.*[a-zA-Zа-яА-Я])(?=.*)[a-zA-Zа-яА-Я]+","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1150,"y":1420,"wires":[["7107f051.26d3d"],["c9e223d3.a61a3"]]},{"id":"7f816b77.280d24","type":"function","z":"8a997eeb.880fd","name":"","func":"if(msg.originalMessage.message.text) {\n    msg.SS = true;\n} \nelse msg.SS = false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":1500,"wires":[["5fd4a6b6.5a4fb8"]]},{"id":"5fd4a6b6.5a4fb8","type":"switch","z":"8a997eeb.880fd","name":"","property":"SS","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":750,"y":1500,"wires":[["78b0f2f.2a3430c"],["7107f051.26d3d"]]},{"id":"c9e223d3.a61a3","type":"switch","z":"8a997eeb.880fd","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":".","vt":"str"},{"t":"cont","v":"(","vt":"str"},{"t":"cont","v":")","vt":"str"},{"t":"cont","v":",","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":1290,"y":1480,"wires":[["7107f051.26d3d"],["7107f051.26d3d"],["7107f051.26d3d"],["7107f051.26d3d"],["6a3a7d3a.55a1c4"]]},{"id":"7ad9b5da.641d6c","type":"switch","z":"8a997eeb.880fd","name":"","property":"originalMessage.callback_query.data","propertyType":"msg","rules":[{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":1460,"wires":[["48f1cc88.f63dc4"],["7f816b77.280d24"]]},{"id":"cbfc9ef1.c2a65","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    //state: \"buyerSerchPictures\"\n    state: \"buyerSerchPicturesssss\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":180,"wires":[["efdd68be.0058f8"]]},{"id":"efdd68be.0058f8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":180,"wires":[[]]},{"id":"55f8dae4.5c8424","type":"link in","z":"8a997eeb.880fd","name":"","links":["591687c7.0dbaa8","48f1cc88.f63dc4"],"x":555,"y":220,"wires":[["5c6ac94.cc82b38"]]},{"id":"591687c7.0dbaa8","type":"link out","z":"8a997eeb.880fd","name":"","links":["55f8dae4.5c8424"],"x":575,"y":1280,"wires":[]},{"id":"48f1cc88.f63dc4","type":"link out","z":"8a997eeb.880fd","name":"","links":["55f8dae4.5c8424"],"x":555,"y":1448,"wires":[]},{"id":"5f9aae9d.9c3fb","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3020,"y":1580,"wires":[["88e12b3f.8ba3e8"]]},{"id":"88e12b3f.8ba3e8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3190,"y":1580,"wires":[[]]},{"id":"23c52bea.59c674","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    //state: \"buyerSerchPictures\"backToAdministrator\n    state: \"backToAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":1000,"wires":[["8bd96442.6e88a8"]]},{"id":"8bd96442.6e88a8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3890,"y":1000,"wires":[[]]},{"id":"cdb962cb.7d393","type":"function","z":"aa9d0df9.2dbd7","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backFromAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2420,"y":340,"wires":[["b68c23e2.2180b"]]},{"id":"b68c23e2.2180b","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2590,"y":340,"wires":[[]]},{"id":"298960a6.4eaf1","type":"function","z":"b679fedf.127e3","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"buyerMenuAfterAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":1840,"wires":[["53800999.b68a98"]]},{"id":"53800999.b68a98","type":"http request","z":"b679fedf.127e3","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1840,"wires":[[]]},{"id":"c45dc77c.e4c8d8","type":"function","z":"aa9d0df9.2dbd7","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backFromAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2720,"y":380,"wires":[["311be54e.5ba4fa"]]},{"id":"311be54e.5ba4fa","type":"http request","z":"aa9d0df9.2dbd7","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2890,"y":380,"wires":[[]]},{"id":"b4e6b083.8ce98","type":"comment","z":"aa9d0df9.2dbd7","name":"otut1","info":"","x":2710,"y":340,"wires":[]},{"id":"3f280e25.092462","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.picture","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":2420,"wires":[["b7bc09de.b17298"]]},{"id":"7466e3a0.951c4c","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":2120,"wires":[[]]},{"id":"b7d91a9f.a2af38","type":"function","z":"8a997eeb.880fd","name":"","func":"msg.picture = msg.payload[0].Picture ? msg.payload[0].Picture : msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":2160,"wires":[["1cfa8e61.afa142"]]},{"id":"7a554d74.5b5624","type":"comment","z":"8a997eeb.880fd","name":"otut","info":"","x":310,"y":1600,"wires":[]},{"id":"915643ea.35004","type":"switch","z":"873bdacb.594338","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"(","vt":"str"},{"t":"cont","v":")","vt":"str"},{"t":"cont","v":".","vt":"str"},{"t":"cont","v":",","vt":"str"},{"t":"cont","v":":","vt":"str"},{"t":"cont","v":";","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":7,"x":1770,"y":4940,"wires":[["12fff64d.7e590a"],["12fff64d.7e590a"],["12fff64d.7e590a"],["12fff64d.7e590a"],["12fff64d.7e590a"],["12fff64d.7e590a"],["c4d02f4f.f18c8"]]},{"id":"c17d1fef.f97ee","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2820,"y":2620,"wires":[["6f938a80.026924"]]},{"id":"6f938a80.026924","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2990,"y":2620,"wires":[[]]},{"id":"d39a4cfb.1581b","type":"comment","z":"873bdacb.594338","name":"otut","info":"","x":2800,"y":2580,"wires":[]},{"id":"b21ccc1c.788c8","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"buyerSerchPictures\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":400,"wires":[["d0c5b162.b53d2"]]},{"id":"d0c5b162.b53d2","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1800,"y":400,"wires":[[]]},{"id":"41976647.5abd58","type":"comment","z":"8a997eeb.880fd","name":"otut","info":"","x":1610,"y":360,"wires":[]},{"id":"1835ff13.b68b11","type":"comment","z":"8a997eeb.880fd","name":"otut","info":"","x":1050,"y":220,"wires":[]},{"id":"7e05204f.d1267","type":"comment","z":"8a997eeb.880fd","name":"?","info":"","x":770,"y":1580,"wires":[]},{"id":"a0f4eb8d.e71ab8","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1950,"y":1500,"wires":[["e5cf7529.f1af08"],["53e6b50a.5782fc"]]},{"id":"53e6b50a.5782fc","type":"function","z":"8a997eeb.880fd","name":"buyerNOTSearchBySize","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerNOTSearchBySize\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2150,"y":1520,"wires":[["64e4333f.601bac"]]},{"id":"64e4333f.601bac","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2370,"y":1520,"wires":[[]]},{"id":"a5653b25.29e7d8","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3860,"y":1480,"wires":[["ca17aa17.636e18"]]},{"id":"ca17aa17.636e18","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":4030,"y":1480,"wires":[[]]},{"id":"a31b9999.2f62a8","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":820,"wires":[["a40fd9ad.44fb28"],["a55b4199.09323"]]},{"id":"a55b4199.09323","type":"function","z":"8a997eeb.880fd","name":"buyerNOTSearchByArtist","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerNOTSearchByArtist\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":840,"wires":[["7f2408f3.4a83e8"]]},{"id":"7f2408f3.4a83e8","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":840,"wires":[[]]},{"id":"96c12299.e54c8","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":700,"wires":[["4a28022.7a7c6fc"],["9f1740ee.45256"]]},{"id":"9f1740ee.45256","type":"function","z":"8a997eeb.880fd","name":"buyerNOTSearchByCategory","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerNOTSearchByCategory\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":700,"wires":[["17efb83d.5bcd48"]]},{"id":"17efb83d.5bcd48","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":700,"wires":[[]]},{"id":"33c82177.2d738e","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":1980,"wires":[]},{"id":"90509969.5dd3d8","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":1960,"wires":[["cf55df4c.f9cdb"],["e2558883.b86d58"]]},{"id":"e2558883.b86d58","type":"function","z":"8a997eeb.880fd","name":"buyerNOTFavouritePicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerNOTFavouritePicture\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":1980,"wires":[["1864ded5.ab8721"]]},{"id":"1864ded5.ab8721","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":1980,"wires":[[]]},{"id":"6ec49e90.547e","type":"debug","z":"8a997eeb.880fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1880,"wires":[]},{"id":"175bd892.a5dcc7","type":"switch","z":"8a997eeb.880fd","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":1860,"wires":[["78fba30f.0f65dc"],["996389c2.608298"]]},{"id":"996389c2.608298","type":"function","z":"8a997eeb.880fd","name":"buyerNOTViewedPicture","func":"msg.url = msg.messageApiHost + \"/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerNOTViewedPicture\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":1880,"wires":[["c7fd5293.c28ca"]]},{"id":"c7fd5293.c28ca","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1090,"y":1880,"wires":[[]]},{"id":"92022b0.748cdd8","type":"comment","z":"8a997eeb.880fd","name":"5 byHistorySearchType","info":"","x":2780,"y":1060,"wires":[]},{"id":"84161ff5.b618c","type":"switch","z":"fe29b5bc.5d8348","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"buyerSerchPicturesssss","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":220,"wires":[["2fce8b7f.6fff74"],["14973bcf.3ffa24"]]},{"id":"14973bcf.3ffa24","type":"switch","z":"fe29b5bc.5d8348","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"statisic","vt":"str"},{"t":"cont","v":"artistIdSPic","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":750,"y":240,"wires":[[],["3a95c0c1.09ee1"],["45141290.2b8b3c"]]},{"id":"2fce8b7f.6fff74","type":"link out","z":"fe29b5bc.5d8348","name":"","links":["ed8694a4.4b21f8"],"x":715,"y":200,"wires":[]},{"id":"21a79636.daceaa","type":"link in","z":"fe29b5bc.5d8348","name":"","links":["b721e972.dac418"],"x":855,"y":240,"wires":[["45141290.2b8b3c"]]},{"id":"b721e972.dac418","type":"link out","z":"8a997eeb.880fd","name":"","links":["21a79636.daceaa"],"x":435,"y":1100,"wires":[]},{"id":"310d4b4f.e5f174","type":"switch","z":"b679fedf.127e3","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"startNumberMessage","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":560,"wires":[["66430dc1.7996b4"],["6872b79.f316348"]]},{"id":"66430dc1.7996b4","type":"link out","z":"b679fedf.127e3","name":"","links":["f2cb3c2a.60f0e"],"x":635,"y":540,"wires":[]},{"id":"fefa9353.6b023","type":"function","z":"8a997eeb.880fd","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    //state: \"buyerSerchPictures\"backToAdministrator\n    //state: \"backToAdministratorAndBuyerMenu\"\n    state: \"viewHistory\"\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2880,"y":1020,"wires":[["8b766e28.14033"]]},{"id":"8b766e28.14033","type":"http request","z":"8a997eeb.880fd","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3050,"y":1020,"wires":[[]]},{"id":"cf193690.625648","type":"comment","z":"8a997eeb.880fd","name":"http://localhost:300","info":"","x":530,"y":880,"wires":[]},{"id":"e44ef84e.5bb858","type":"function","z":"873bdacb.594338","name":"set state","func":"msg.url = msg.userApiHost + \"/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":1300,"wires":[["af46a308.73a9e"]]},{"id":"af46a308.73a9e","type":"http request","z":"873bdacb.594338","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1300,"wires":[[]]},{"id":"c801eb06.4b29e8","type":"comment","z":"873bdacb.594338","name":"otut","info":"","x":950,"y":1260,"wires":[]},{"id":"3cf4ccb8.2a7984","type":"link in","z":"8a997eeb.880fd","name":"","links":["94e12094.4b113","3a95c0c1.09ee1"],"x":355,"y":820,"wires":[["23b38487.0b46fc"]]},{"id":"22b857ad.775c78","type":"comment","z":"8a997eeb.880fd","name":"artistIdSPic","info":"","x":90,"y":680,"wires":[]},{"id":"3a95c0c1.09ee1","type":"link out","z":"fe29b5bc.5d8348","name":"","links":["3cf4ccb8.2a7984"],"x":855,"y":200,"wires":[]},{"id":"1ac28f58.55a621","type":"switch","z":"b679fedf.127e3","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"changeTypeToArtist","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1310,"y":1380,"wires":[[],["25a834da.35818c"]]},{"id":"f2558846.566378","type":"debug","z":"54326a95.39a714","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":910,"y":100,"wires":[]},{"id":"456176da.dfb858","type":"debug","z":"b679fedf.127e3","name":"otherwise","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1180,"y":920,"wires":[]},{"id":"8bef2357.2d37f","type":"dialogflowv2","z":"aa9d0df9.2dbd7","dialogflow":"321a3beb.5f6474","language":"uk","debug":false,"queryParamsOK":false,"x":560,"y":260,"wires":[["c8225250.c0788","cb54b513.07aa38"]]}]
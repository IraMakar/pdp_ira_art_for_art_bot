[{"id":"116704c1.2aeebb","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"1783749d.eafb2b","type":"tab","label":"switch","disabled":false,"info":""},{"id":"fa8df506.b0c4c8","type":"tab","label":"Artist Menu","disabled":false,"info":""},{"id":"912e5aba.30c308","type":"tab","label":"Buyer Menu","disabled":false,"info":""},{"id":"e6d2d53c.160948","type":"tab","label":"Actions with picture","disabled":false,"info":""},{"id":"d043a9c8.5c1ca8","type":"tab","label":"Contact with administrator","disabled":false,"info":""},{"id":"39fed9a2.d496c6","type":"tab","label":"Base actions","disabled":false,"info":""},{"id":"f13711e4.d179d","type":"dialogflowv2-token","name":"pdp-ira-bot-nqgr"},{"id":"a36dcb58.d4ef28","type":"mqtt-broker","z":"","name":"","broker":"cow.rmq2.cloudamqp.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"87e8bbd9.9b7488","type":"http in","z":"116704c1.2aeebb","name":"","url":"/webhook","method":"post","upload":false,"swaggerDoc":"","x":140,"y":120,"wires":[["9278ee7a.39687","d169bebe.423ef","5da31a63.2b6334"]]},{"id":"d169bebe.423ef","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":110,"y":80,"wires":[]},{"id":"9278ee7a.39687","type":"http response","z":"116704c1.2aeebb","name":"","statusCode":"200","headers":{},"x":160,"y":160,"wires":[]},{"id":"9f05c756.bec1e8","type":"function","z":"116704c1.2aeebb","name":"","func":"if (msg.payload && msg.payload.callback_query) {\n    msg.text = msg.payload.callback_query.data;\n    msg.chat_id = msg.payload.callback_query.from.id;\n}\n\nif (msg.payload && msg.payload.message && msg.payload.message.contact) {\n    msg.text = msg.payload.message.contact.phone_number;\n    msg.chat_id = msg.payload.message.from.id;\n} else if (msg.payload && msg.payload.message && msg.payload.message.photo) {\n    msg.text = msg.payload.message.photo[1].file_id;\n    msg.chat_id = msg.payload.message.from.id;\n} else if (msg.payload && msg.payload.message && msg.payload.message.successful_payment) {\n    msg.text = msg.payload.message.successful_payment.invoice_payload;\n    msg.chat_id = msg.payload.message.from.id;\n} else if (msg.payload && msg.payload.message) {\n    msg.text = msg.payload.message.text;\n    msg.chat_id = msg.payload.message.from.id;\n}\n\n\nmsg.originalMessage = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":220,"wires":[["2aaa4844.41c3e8","e79a1030.78e18"]]},{"id":"2aaa4844.41c3e8","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":180,"wires":[]},{"id":"e79a1030.78e18","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    //lang: msg.lang,\n    chat_id: msg.chat_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":220,"wires":[["b8e6d295.78bed","449bc62b.6a79a8"]]},{"id":"b8e6d295.78bed","type":"http request","z":"116704c1.2aeebb","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":220,"wires":[["7cab531.800d5ac"]]},{"id":"7cab531.800d5ac","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.lang = msg.payload.lang;\nmsg.type = msg.payload.type;\nmsg.nickname = msg.payload.nickname;\nmsg.state = msg.payload.state;\nmsg.settings = msg.payload.settings;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":220,"wires":[["9838eaa9.486038","9344632d.711fa"]]},{"id":"2ff248e.12b42b8","type":"switch","z":"1783749d.eafb2b","name":"Artist ","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"regex","v":"((\\+38)?\\(?\\d{3}\\)?[\\s\\.-]?(\\d{7}|\\d{3}[\\s\\.-]\\d{2}[\\s\\.-]\\d{2}|\\d{3}-\\d{4}))","vt":"str","case":false},{"t":"eq","v":"uk","vt":"str"},{"t":"eq","v":"ru","vt":"str"},{"t":"eq","v":"en","vt":"str"},{"t":"eq","v":"artist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"changeTypeToBuyer","vt":"str"},{"t":"eq","v":"artActionsWithPicturesHello","vt":"str"},{"t":"eq","v":"actionsWithPictures","vt":"str"},{"t":"eq","v":"advertisingPicture","vt":"str"},{"t":"eq","v":"advertising","vt":"str"},{"t":"eq","v":"viewStatistics","vt":"str"},{"t":"eq","v":"viewApplications","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"setting","vt":"str"},{"t":"eq","v":"exhibitPicture","vt":"str"},{"t":"eq","v":"editPostOfPicture","vt":"str"},{"t":"eq","v":"deletePainting","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"},{"t":"cont","v":"categId","vt":"str"},{"t":"eq","v":"viewCreatedPost","vt":"str"},{"t":"eq","v":"moreAboutAdvertising","vt":"str"},{"t":"eq","v":"toAdvertisingPicture","vt":"str"},{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"artActionsPostPictureSize","vt":"str"},{"t":"eq","v":"artActionsPostPictureHashtags","vt":"str"},{"t":"eq","v":"advertisingPicture","vt":"str"},{"t":"eq","v":"moreAboutAdvertising","vt":"str"},{"t":"eq","v":"thisPictureForAdvertising","vt":"str"},{"t":"eq","v":"statisticByHashtags","vt":"str"},{"t":"eq","v":"statisticByPictures","vt":"str"},{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"cont","v":"deletePicture","vt":"str"},{"t":"cont","v":"deleteSelectedPicture","vt":"str"},{"t":"eq","v":"noDeleteSelectedPicture","vt":"str"},{"t":"cont","v":"editPicture","vt":"str"},{"t":"cont","v":"editCategory","vt":"str"},{"t":"cont","v":"editImage","vt":"str"},{"t":"cont","v":"editDescription","vt":"str"},{"t":"cont","v":"editSize","vt":"str"},{"t":"cont","v":"editHashtags","vt":"str"},{"t":"cont","v":"editNamePicture","vt":"str"},{"t":"eq","v":"viewEditedPost","vt":"str"},{"t":"eq","v":"backToEditPost","vt":"str"},{"t":"cont","v":"advertisePicture","vt":"str"},{"t":"eq","v":"payAdvertisingPicture","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":50,"x":610,"y":560,"wires":[["c07cc980.eb7768","6be5e88b.038cf8"],["28332c6a.b8b934","120b46b5.288089"],["b0edffc9.f70fb","8a57b5e7.e7f698"],["b0edffc9.f70fb","8b3c33f5.86c83"],["b0edffc9.f70fb","fd81655a.b421d8"],["f7e3c53.264c638"],["8d7d7066.56cff"],["8d7d7066.56cff","4656d29d.1f808c"],["86a28dd0.823a5","ac049a2a.6699c8"],["86a28dd0.823a5","537535b8.691b7c"],["86a28dd0.823a5","c9820b7c.6e7de8"],["86a28dd0.823a5","2d942921.cef8b6"],["86a28dd0.823a5","cef137d9.89f6c8"],["86a28dd0.823a5","1a77d82.3cfac28"],["86a28dd0.823a5","1481808c.1029df"],["86a28dd0.823a5","548bc106.2c04a"],["c856a004.df92f","89d02394.2ab3f"],["c856a004.df92f","c4aa4434.1ee608"],["c856a004.df92f"],["c856a004.df92f"],["71f26ae7.fd5474","2a179599.b2c2ea"],["71f26ae7.fd5474"],[],[],["71f26ae7.fd5474"],["71f26ae7.fd5474"],["71f26ae7.fd5474"],["71f26ae7.fd5474"],["f606c7ca.7a0168"],["f606c7ca.7a0168"],["f606c7ca.7a0168"],["6ea6a4fc.02415c"],["6ea6a4fc.02415c"],["d7669393.fe6f7"],["d7669393.fe6f7"],["d7669393.fe6f7"],["d7669393.fe6f7"],["d7669393.fe6f7"],["d7669393.fe6f7"],["fa555e9c.1fe5"],["fa555e9c.1fe5"],["fa555e9c.1fe5"],["fa555e9c.1fe5"],["fa555e9c.1fe5"],["fa555e9c.1fe5"],["879515c4.1610e8"],["8371a8ec.346e48"],["f606c7ca.7a0168"],[],["4bca1927.9a8c18","d858f55c.515b78"]]},{"id":"2d61704.21b989","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":300,"wires":[[]]},{"id":"c07cc980.eb7768","type":"function","z":"1783749d.eafb2b","name":"startNumberMessage","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    templateName: \"startNumberMessage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":300,"wires":[["2d61704.21b989"]]},{"id":"9442e2ae.3c77b","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":380,"wires":[["4333cdea.26aec4"]]},{"id":"b0edffc9.f70fb","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":380,"wires":[["9442e2ae.3c77b"]]},{"id":"9838eaa9.486038","type":"link out","z":"116704c1.2aeebb","name":"","links":["17181ba3.a65394"],"x":1275,"y":220,"wires":[]},{"id":"17181ba3.a65394","type":"link in","z":"1783749d.eafb2b","name":"","links":["9838eaa9.486038"],"x":75,"y":560,"wires":[["bb18d86d.65d3f8","31b47f62.f2bb6"]]},{"id":"f84c0c16.daa5a","type":"function","z":"1783749d.eafb2b","name":"artistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2390,"y":800,"wires":[["2367340b.95ecec"]]},{"id":"2367340b.95ecec","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2570,"y":800,"wires":[[]]},{"id":"9344632d.711fa","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":180,"wires":[]},{"id":"23f22653.75568a","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.buyerType = \"buyer\";\nmsg.artistType = \"artist\";\nmsg.delete_picture_action = 'delete_picture';\nmsg.edit_picture_action = 'edit_picture';\nmsg.advertise_picture_action = 'advertise_picture';\nmsg.byArtistSearchType = 'byArtistSearchType';\nmsg.byCategorySearchType = 'byCategorySearchType';\nmsg.bySizeSearchType = 'bySizeSearchType';\nmsg.byHashtagSearchType = 'byHashtagSearchType';\nmsg.byHistorySearchType = 'byHistorySearchType';\nmsg.byLikedSearchType = 'byLikedSearchType';\n//msg.state = msg.payload.state;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":220,"wires":[["9f05c756.bec1e8"]]},{"id":"d15e5ebf.20484","type":"function","z":"1783749d.eafb2b","name":"helloArtistStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":420,"wires":[["a23aff07.5c2b"]]},{"id":"a23aff07.5c2b","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":420,"wires":[["990201b.9490a"]]},{"id":"3c6b5964.961a46","type":"switch","z":"1783749d.eafb2b","name":"Buyer","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"changeTypeToBuyer","vt":"str"},{"t":"eq","v":"changeTypeToArtist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"searchPictures","vt":"str"},{"t":"eq","v":"searchByArtist","vt":"str"},{"t":"eq","v":"searchByCategory","vt":"str"},{"t":"eq","v":"searchBySize","vt":"str"},{"t":"eq","v":"searchByHashtag","vt":"str"},{"t":"cont","v":"artistIdSPic","vt":"str"},{"t":"cont","v":"categIdSPic","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"viewHistory","vt":"str"},{"t":"eq","v":"viewLiked","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"backToBuyerMenu","vt":"str"},{"t":"cont","v":"like","vt":"str"},{"t":"cont","v":"apply","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":19,"x":350,"y":1760,"wires":[["cf4c1bd1.703018"],["bf5cc3dd.098d1"],["69b4bc3.6b08444"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["c2276917.ed4488"],["886d8ced.eca4e"],["886d8ced.eca4e"],[],["2804f051.68596"],["3cbed2f.51dda2e"],["3cbed2f.51dda2e"],["cc1eae2b.810a9"]]},{"id":"384b6fb5.0479c","type":"link in","z":"1783749d.eafb2b","name":"","links":["8d7d7066.56cff","a990112a.fcc76","4778b79e.6eca28"],"x":175,"y":1760,"wires":[["3c6b5964.961a46","c6a0946c.ae97b8"]]},{"id":"bb18d86d.65d3f8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":70,"y":520,"wires":[]},{"id":"449bc62b.6a79a8","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":180,"wires":[]},{"id":"a12327df.17d228","type":"function","z":"1783749d.eafb2b","name":"helloArtistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1440,"y":920,"wires":[["372775b8.d3dd7a"]]},{"id":"372775b8.d3dd7a","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1630,"y":920,"wires":[["32445665.7284aa"]]},{"id":"608d4104.f87ea","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1770,"y":380,"wires":[[]]},{"id":"4333cdea.26aec4","type":"function","z":"1783749d.eafb2b","name":"chooseWhoAreYou","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text,\n    templateName: \"chooseWhoAreYou\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":380,"wires":[["608d4104.f87ea"]]},{"id":"ea4fbd2b.21eef","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1970,"y":920,"wires":[["57229e94.05b2e"]]},{"id":"32445665.7284aa","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    nickname: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":920,"wires":[["ea4fbd2b.21eef"]]},{"id":"ff13bb00.6a1e88","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":340,"wires":[["9632c66c.6ad308"]]},{"id":"28332c6a.b8b934","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    phone: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":340,"wires":[["ff13bb00.6a1e88"]]},{"id":"990201b.9490a","type":"function","z":"1783749d.eafb2b","name":"artistName","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistName\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2390,"y":420,"wires":[["3b199390.3a774c"]]},{"id":"3b199390.3a774c","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2570,"y":420,"wires":[["d7038503.23ca18"]]},{"id":"fed52cec.3cde7","type":"function","z":"1783749d.eafb2b","name":"set state","func":"msg.payload = {  \n    \"state\": \"depSuccess\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2820,"y":300,"wires":[[]]},{"id":"b8d1e9dc.5359e8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2730,"y":380,"wires":[]},{"id":"d7038503.23ca18","type":"function","z":"1783749d.eafb2b","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artistName\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2740,"y":420,"wires":[["b8d1e9dc.5359e8","a4b19f49.bbf1b"]]},{"id":"9632c66c.6ad308","type":"function","z":"1783749d.eafb2b","name":"succesRegistration","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"succesRegistration\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":340,"wires":[["c9957337.7f0e9"]]},{"id":"c9957337.7f0e9","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1770,"y":340,"wires":[["fe455fa4.f0c01"]]},{"id":"c45fb01a.e5f7f","type":"function","z":"1783749d.eafb2b","name":"chooseLanguage","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"chooseLanguage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2410,"y":340,"wires":[["227673fa.6cd12c"]]},{"id":"227673fa.6cd12c","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2590,"y":340,"wires":[[]]},{"id":"fe455fa4.f0c01","type":"function","z":"1783749d.eafb2b","name":"succesRegistrationStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"succesRegistrationStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1990,"y":340,"wires":[["836ef4aa.5c9248"]]},{"id":"836ef4aa.5c9248","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":340,"wires":[["c45fb01a.e5f7f"]]},{"id":"a4b19f49.bbf1b","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2910,"y":420,"wires":[["10cd90ec.377dcf"]]},{"id":"10cd90ec.377dcf","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3090,"y":420,"wires":[]},{"id":"d858f55c.515b78","type":"switch","z":"1783749d.eafb2b","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"artistName","vt":"str"},{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"addPictureSize","vt":"str"},{"t":"eq","v":"addPictureHashtags","vt":"str"},{"t":"eq","v":"addPictureName","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"cont","v":"editPostCategory","vt":"str"},{"t":"cont","v":"editPostImage","vt":"str"},{"t":"cont","v":"editPostDescription","vt":"str"},{"t":"cont","v":"editPostSize","vt":"str"},{"t":"cont","v":"editPostHashtags","vt":"str"},{"t":"cont","v":"editPostName","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":15,"x":830,"y":1040,"wires":[["37d80720.6187e8"],["b1bd55d3.9f9a18"],["b1bd55d3.9f9a18"],["b1bd55d3.9f9a18"],["b1bd55d3.9f9a18"],["b1bd55d3.9f9a18"],["fd459470.d19b88"],["6eef3c72.8d3064"],["6eef3c72.8d3064"],["6eef3c72.8d3064"],["6eef3c72.8d3064"],["6eef3c72.8d3064"],["6eef3c72.8d3064"],["32e4120b.0bc03e"],[]]},{"id":"37d80720.6187e8","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    nickname: msg.text,\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":980,"wires":[["2a1552aa.e5900e"]]},{"id":"2a1552aa.e5900e","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":980,"wires":[["a12327df.17d228"]]},{"id":"86a28dd0.823a5","type":"link out","z":"1783749d.eafb2b","name":"Artist Menu","links":["f833a7dd.c2ead8"],"x":950,"y":560,"wires":[],"l":true},{"id":"30ad3c98.0d4194","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"artActionsWithPicturesHello","vt":"str"},{"t":"eq","v":"actionsWithPictures","vt":"str"},{"t":"eq","v":"advertising","vt":"str"},{"t":"eq","v":"viewStatistics","vt":"str"},{"t":"eq","v":"viewApplications","vt":"str"},{"t":"eq","v":"contactWithAdministrator","vt":"str"},{"t":"eq","v":"setting","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":310,"y":320,"wires":[["411a4ff1.c75f","7d055e52.e1a5d"],["e727256.2105bd8","89699514.e15168"],["c35a181.949e8e8","77b068fa.9e5598"],["440cfa5e.5688c4","919560a4.1f07"],["84bf2478.187f08","76c37e67.bc946"],["37c93e68.f473d2","31527248.ab217e"],["8752f401.a4e608","2d5092f2.4d5d9e"]]},{"id":"f833a7dd.c2ead8","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["86a28dd0.823a5"],"x":155,"y":320,"wires":[["30ad3c98.0d4194"]]},{"id":"e727256.2105bd8","type":"function","z":"fa8df506.b0c4c8","name":"artActionsWithPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithPictures\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":160,"wires":[["f9ba4752.e53978"]]},{"id":"f9ba4752.e53978","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":160,"wires":[[]]},{"id":"96ef586b.115708","type":"link in","z":"e6d2d53c.160948","name":"","links":[],"x":195,"y":320,"wires":[[]]},{"id":"c856a004.df92f","type":"link out","z":"1783749d.eafb2b","name":"Actions with pictures","links":["1d73fb7a.427b15"],"x":980,"y":600,"wires":[],"l":true},{"id":"168328bc.d99ee7","type":"switch","z":"e6d2d53c.160948","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"exhibitPicture","vt":"str"},{"t":"eq","v":"editPostOfPicture","vt":"str"},{"t":"eq","v":"deletePainting","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":350,"y":320,"wires":[[],[],[],[]]},{"id":"3ce772a1.dd52ae","type":"function","z":"e6d2d53c.160948","name":"artActionsPostPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":100,"wires":[["5066230d.96364c"]]},{"id":"5066230d.96364c","type":"http request","z":"e6d2d53c.160948","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":830,"y":100,"wires":[[]]},{"id":"1d73fb7a.427b15","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["c856a004.df92f","ffce86a9.8fcaa8"],"x":155,"y":1020,"wires":[["30bea287.f7773e"]]},{"id":"30bea287.f7773e","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"exhibitPicture","vt":"str"},{"t":"eq","v":"editPostOfPicture","vt":"str"},{"t":"eq","v":"deletePainting","vt":"str"},{"t":"eq","v":"backToArtistMenu","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":310,"y":1020,"wires":[["2eb78ebc.14a172","75df5d59.137094"],["98e12c95.a5473","e7bbc4fa.539168"],["7bb22684.cd4a38","7afcf826.9171a8"],["1ab2d2a9.5b78dd"]]},{"id":"ac93b303.11647","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPicture\",\n    templateVars: {\n      categories: msg.categories,  \n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":900,"wires":[["249e13d.c7331ec","c8ebf037.c6127"]]},{"id":"249e13d.c7331ec","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":900,"wires":[["30f9f72.c84b308"]]},{"id":"9bc0ea1.c53b218","type":"comment","z":"fa8df506.b0c4c8","name":"Actions with pictures","info":"","x":240,"y":940,"wires":[]},{"id":"9e76dcfe.fc02b","type":"comment","z":"fa8df506.b0c4c8","name":"Artist Menu","info":"","x":210,"y":240,"wires":[]},{"id":"c35a181.949e8e8","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertising","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertising\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":260,"wires":[["d1e53009.cc3b9"]]},{"id":"d1e53009.cc3b9","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":260,"wires":[["ba4e3232.01bc2"]]},{"id":"440cfa5e.5688c4","type":"function","z":"fa8df506.b0c4c8","name":"artViewStatistics","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artViewStatistics\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":360,"wires":[["ac7820f9.40069"]]},{"id":"84bf2478.187f08","type":"function","z":"fa8df506.b0c4c8","name":"artActionsWithPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithPictures\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":460,"wires":[["8760055f.9c90f8"]]},{"id":"8760055f.9c90f8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":870,"y":460,"wires":[[]]},{"id":"37c93e68.f473d2","type":"function","z":"fa8df506.b0c4c8","name":"contactWithAdministratorStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"contactWithAdministratorStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":560,"wires":[["2c2cb939.df87e6"]]},{"id":"2c2cb939.df87e6","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":560,"wires":[["bdb31dba.87dd6"]]},{"id":"adf1336c.7b825","type":"function","z":"fa8df506.b0c4c8","name":"changeTypeToBuyer","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    //templateName: \"changeWhoAreYou\"\n    templateName: \"changeTypeToBuyer\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":660,"wires":[["21f96b41.274a34"]]},{"id":"21f96b41.274a34","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":660,"wires":[["f59b24f4.cead98"]]},{"id":"1ab2d2a9.5b78dd","type":"function","z":"fa8df506.b0c4c8","name":"artistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":1300,"wires":[["b81afec5.51091"]]},{"id":"b81afec5.51091","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":1300,"wires":[[]]},{"id":"bc179188.3249","type":"function","z":"fa8df506.b0c4c8","name":"artistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":1540,"wires":[["76fe761a.b07698"]]},{"id":"76fe761a.b07698","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2130,"y":1540,"wires":[[]]},{"id":"245fbbde.481294","type":"function","z":"fa8df506.b0c4c8","name":"перелік картин -карусель","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1240,"y":840,"wires":[["a65e37ea.5948a8"]]},{"id":"a65e37ea.5948a8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1470,"y":840,"wires":[[]]},{"id":"551f9dbf.f13574","type":"comment","z":"fa8df506.b0c4c8","name":"Post Picture","info":"","x":190,"y":1700,"wires":[]},{"id":"f336b2c5.1ee82","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["71f26ae7.fd5474","b1bd55d3.9f9a18"],"x":135,"y":1800,"wires":[["768893bb.0c96fc"]]},{"id":"768893bb.0c96fc","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"categId","vt":"str"},{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"artActionsPostPictureSize","vt":"str"},{"t":"eq","v":"artActionsPostPictureHashtags","vt":"str"},{"t":"eq","v":"viewCreatedPost","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":290,"y":1800,"wires":[["26db2c4c.2bf934","d03b4ddc.81b22"],["26db2c4c.2bf934"],["6570405.ac920c","2305e4a5.4687fc"],["64aab369.77266c","298483bd.3f1b6c"],["68b46b20.1d1a24","7310c46e.2ed0ac"],["b87285a5.f47698","dbc8264f.4f78e8"],["7c653299.bc91ec","de31255e.9e9b48"]]},{"id":"26db2c4c.2bf934","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureImage","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureImage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1500,"wires":[["425ff0d2.ccebf"]]},{"id":"425ff0d2.ccebf","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1010,"y":1500,"wires":[["6558274b.bb8ff8"]]},{"id":"71f26ae7.fd5474","type":"link out","z":"1783749d.eafb2b","name":"Post Picture","links":["f336b2c5.1ee82"],"x":950,"y":640,"wires":[],"l":true},{"id":"708f25be.74db1c","type":"comment","z":"fa8df506.b0c4c8","name":"1 ❤️ треба записувати в бд дану категорію картин","info":"","x":1000,"y":1460,"wires":[]},{"id":"6558274b.bb8ff8","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.chosed_category_id = msg.text.split('_')[1];\nmsg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artActionsPostPictureImage\",\n    settings: {\n        chosed_category_id: msg.chosed_category_id,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":1500,"wires":[["46e4397d.797758"]]},{"id":"46e4397d.797758","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1500,"wires":[[]]},{"id":"b1bd55d3.9f9a18","type":"link out","z":"1783749d.eafb2b","name":"to artist menu","links":["f336b2c5.1ee82"],"x":1100,"y":1020,"wires":[],"l":true},{"id":"6570405.ac920c","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureDescript","func":"msg.picture = msg.payload;\nmsg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDescript\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1620,"wires":[["da8a16d3.024e88"]]},{"id":"da8a16d3.024e88","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":1620,"wires":[["8a1933d0.a402e"]]},{"id":"8a1933d0.a402e","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"artActionsPostPictureDescript\",\n    settings: {\n        picture_id: msg.picture.id\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":1620,"wires":[["e11811aa.0457e"]]},{"id":"e11811aa.0457e","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":1620,"wires":[[]]},{"id":"7c653299.bc91ec","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"artActionsPostPictureImage","vt":"str"},{"t":"eq","v":"artActionsPostPictureDescript","vt":"str"},{"t":"eq","v":"addPictureSize","vt":"str"},{"t":"eq","v":"addPictureHashtags","vt":"str"},{"t":"eq","v":"addPictureName","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":6,"x":470,"y":2180,"wires":[["7ff7f2b9.79991c","d80057ee.557d68"],["545aa8cb.d1e8d8","56fdfec2.66568"],["d0e66280.9ef99","3182dd1a.1f5722"],["f1627642.e724a8","13c59227.9d2f4e"],["5e6374eb.4df98c","e8492665.54fe88"],[]]},{"id":"64aab369.77266c","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureSize","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureSize\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1740,"wires":[["aea0e375.96548"]]},{"id":"aea0e375.96548","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":990,"y":1740,"wires":[["118777b8.08fd88"]]},{"id":"118777b8.08fd88","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"addPictureSize\",\n    settings: {\n        picture_id: msg.picture.id\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":1740,"wires":[["ce3888e2.704ed8"]]},{"id":"ce3888e2.704ed8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1330,"y":1740,"wires":[[]]},{"id":"68b46b20.1d1a24","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureHashtags","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureHashtags\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1860,"wires":[["3327a70e.766e08"]]},{"id":"3327a70e.766e08","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":1860,"wires":[["e8e68d67.01f2d"]]},{"id":"e8e68d67.01f2d","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"addPictureHashtags\",\n    settings: {\n        picture_id: msg.picture.id\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":1860,"wires":[["d9e19c04.67d5c"]]},{"id":"d9e19c04.67d5c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":1860,"wires":[[]]},{"id":"504f5f1c.2dd0a","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureDoneText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDoneText\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":2600,"wires":[["825e3411.d8b0f8"]]},{"id":"825e3411.d8b0f8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":2600,"wires":[["1abfef5.3c4b511"]]},{"id":"1abfef5.3c4b511","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureDoneStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDoneStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":2600,"wires":[["ec3af7f2.a23488"]]},{"id":"ec3af7f2.a23488","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1870,"y":2600,"wires":[["a300a5cf.f7a278"]]},{"id":"d9aaf52d.e98948","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureCreated","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureCreated\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags:msg.picture.hashtags ? '#' + msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":1980,"wires":[["ef9c5525.5c5358"]]},{"id":"ef9c5525.5c5358","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1550,"y":1980,"wires":[["c9cf7943.8f77a8"]]},{"id":"a300a5cf.f7a278","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureDoneView","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureDoneView\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2110,"y":2600,"wires":[["b0995fc2.b3228"]]},{"id":"b0995fc2.b3228","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2350,"y":2600,"wires":[[]]},{"id":"2a179599.b2c2ea","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":260,"wires":[]},{"id":"d03b4ddc.81b22","type":"debug","z":"fa8df506.b0c4c8","name":"121","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1460,"wires":[]},{"id":"7f978abe.cc2924","type":"comment","z":"fa8df506.b0c4c8","name":"Edit Post","info":"","x":240,"y":4160,"wires":[]},{"id":"2cef7bbe.648c44","type":"comment","z":"fa8df506.b0c4c8","name":"Action With Post","info":"","x":220,"y":3020,"wires":[]},{"id":"c9cf7943.8f77a8","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureCreatedMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureCreatedMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":1980,"wires":[["f4963236.d637d"]]},{"id":"f4963236.d637d","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2050,"y":1980,"wires":[[]]},{"id":"411a4ff1.c75f","type":"function","z":"fa8df506.b0c4c8","name":"artActionsWithPicturesHello","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithPicturesHello\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":60,"wires":[["9beacd94.83fde"]]},{"id":"9beacd94.83fde","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":60,"wires":[[]]},{"id":"62438b17.8400b4","type":"function","z":"fa8df506.b0c4c8","name":"artDeletePictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeletePictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1910,"y":1240,"wires":[["9a6bf52.b680f08"]]},{"id":"9a6bf52.b680f08","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2110,"y":1240,"wires":[["3bcf044f.e85dbc"]]},{"id":"39d508fa.31b108","type":"comment","z":"fa8df506.b0c4c8","name":"нема ще картин в художника","info":"","x":1510,"y":1100,"wires":[]},{"id":"a990112a.fcc76","type":"link out","z":"1783749d.eafb2b","name":"","links":["384b6fb5.0479c"],"x":515,"y":800,"wires":[]},{"id":"d846730.da3099","type":"function","z":"1783749d.eafb2b","name":"helloArtist","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtist\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":420,"wires":[["21803f1e.da4f3"]]},{"id":"21803f1e.da4f3","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":420,"wires":[["ebfd7a62.cb9ab8"]]},{"id":"238e7fd.dfca28","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1770,"y":420,"wires":[["d15e5ebf.20484"]]},{"id":"ebfd7a62.cb9ab8","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.artistType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":420,"wires":[["238e7fd.dfca28"]]},{"id":"bb40efe1.8047f","type":"function","z":"1783749d.eafb2b","name":"helloArtistStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1580,"wires":[["bfded3bc.c3468"]]},{"id":"9910eea8.e856e","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":1580,"wires":[["bb40efe1.8047f"]]},{"id":"bec358a3.c76818","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":730,"y":1600,"wires":[["38e27230.86350e","69b4bc3.6b08444"]]},{"id":"cf4c1bd1.703018","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    type: msg.buyerType,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1600,"wires":[["bec358a3.c76818"]]},{"id":"bfded3bc.c3468","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1470,"y":1580,"wires":[["aa194e6b.9947e"]]},{"id":"c6a0946c.ae97b8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":230,"y":1640,"wires":[]},{"id":"57229e94.05b2e","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":920,"wires":[]},{"id":"38e27230.86350e","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1560,"wires":[]},{"id":"aa194e6b.9947e","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1450,"y":1540,"wires":[]},{"id":"23c4310d.2a6c1e","type":"switch","z":"1783749d.eafb2b","name":"","property":"type","propertyType":"msg","rules":[{"t":"eq","v":"artistType","vt":"msg"},{"t":"eq","v":"buyerType","vt":"msg"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":560,"wires":[["2ff248e.12b42b8","2571d69a.82d9ba"],["a990112a.fcc76","2571d69a.82d9ba"]]},{"id":"8d7d7066.56cff","type":"link out","z":"1783749d.eafb2b","name":"buyer","links":["384b6fb5.0479c"],"x":930,"y":500,"wires":[],"l":true},{"id":"6be5e88b.038cf8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1030,"y":240,"wires":[]},{"id":"120b46b5.288089","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":60,"wires":[]},{"id":"8a57b5e7.e7f698","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":100,"wires":[]},{"id":"8b3c33f5.86c83","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":140,"wires":[]},{"id":"fd81655a.b421d8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":180,"wires":[]},{"id":"f7e3c53.264c638","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2190,"y":500,"wires":[]},{"id":"4656d29d.1f808c","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1868.5714721679688,"y":302.857177734375,"wires":[]},{"id":"4bca1927.9a8c18","type":"debug","z":"1783749d.eafb2b","name":"otherwise","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1180,"y":920,"wires":[]},{"id":"ac049a2a.6699c8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1812.857177734375,"y":818.5714111328125,"wires":[]},{"id":"537535b8.691b7c","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1810,"y":860,"wires":[]},{"id":"c9820b7c.6e7de8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":20,"wires":[]},{"id":"2d942921.cef8b6","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":60,"wires":[]},{"id":"cef137d9.89f6c8","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":100,"wires":[]},{"id":"1a77d82.3cfac28","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":140,"wires":[]},{"id":"1481808c.1029df","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":180,"wires":[]},{"id":"548bc106.2c04a","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":220,"wires":[]},{"id":"89d02394.2ab3f","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":260,"wires":[]},{"id":"c4aa4434.1ee608","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2030,"y":300,"wires":[]},{"id":"7bcdf7bc.10e8e8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":2120,"wires":[["84b9774b.5c5068"]]},{"id":"7ff7f2b9.79991c","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2120,"wires":[["7bcdf7bc.10e8e8"]]},{"id":"de31255e.9e9b48","type":"debug","z":"fa8df506.b0c4c8","name":"6","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":2100,"wires":[]},{"id":"7744773c.5e8058","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":2120,"wires":[["43b330a9.318b9"]]},{"id":"84b9774b.5c5068","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    artist_id: msg.chat_id,\n    category_id: msg.settings.chosed_category_id,\n    externalPictureUrl: \"https://api.telegram.org/file/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/\"+msg.payload.result.file_path,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":2120,"wires":[["7744773c.5e8058","b014636d.5f8ff"]]},{"id":"2d55e826.89b068","type":"function","z":"fa8df506.b0c4c8","name":"artActionsPostPictureName","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsPostPictureName\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":2480,"wires":[["edf8b0b5.0acf8"]]},{"id":"edf8b0b5.0acf8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1510,"y":2480,"wires":[["bb9a76f6.b30198"]]},{"id":"bb9a76f6.b30198","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"addPictureName\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":2480,"wires":[["3f9a1ed4.b24cf2"]]},{"id":"3f9a1ed4.b24cf2","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1850,"y":2480,"wires":[[]]},{"id":"d24aecc3.4f65c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":2240,"wires":[["ea98b15c.bd67b"]]},{"id":"545aa8cb.d1e8d8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    description: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2240,"wires":[["d24aecc3.4f65c"]]},{"id":"3fc56557.74263a","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":2360,"wires":[["6eeb7df5.869874"]]},{"id":"d0e66280.9ef99","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.size = msg.text.split(\"-\");\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    //height: msg.text.split('-')[0],\n    //width: msg.text.split('-')[1]\n    height: msg.size[0],\n    width: msg.size[1]\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2360,"wires":[["3fc56557.74263a"]]},{"id":"d8c2c74f.056d88","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":2480,"wires":[["2d55e826.89b068"]]},{"id":"f1627642.e724a8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"let text = msg.text;\n\n//text = text.replace(/\\s/g, '');\n\ntext = text.replace(/# /g, \"#\");\n\ntext = text.replace(',', \"\");\n\nif(text[0] == '#') {\ntext = text.substring(1, text.length);\nconsole.log(text);\n}\n\nmsg.hashtags = text.split('#');\n\nreturn msg;\n//msg.picture.hashtags = msg.picture.hashtags.replace(/# /g, \"#\");","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2480,"wires":[["ed5465ba.fe0468"]]},{"id":"d2208fca.5c923","type":"dialogflowv2","z":"1783749d.eafb2b","dialogflow":"f13711e4.d179d","language":"uk","debug":false,"queryParamsOK":false,"x":1280,"y":1200,"wires":[["ea60df6b.0da04","9df8dab4.357528"]]},{"id":"dd2e7bcc.d2ff48","type":"function","z":"1783749d.eafb2b","name":"Set user text to payload","func":"msg.payload = msg.text;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":1200,"wires":[["d2208fca.5c923"]]},{"id":"ea60df6b.0da04","type":"function","z":"1783749d.eafb2b","name":"Set Dialogflow responce to msg.answer","func":"msg.answer = msg._dialogflow.fulfillmentText;\nmsg.intent = msg._dialogflow.intent.displayName;\n//msg.prevState = msg.user.state;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1560,"y":1200,"wires":[["724a201a.6221b"]]},{"id":"724a201a.6221b","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.intent = msg._dialogflow.intent.displayName;\nif(msg.intent === \"Greetings\") {\n    msg.state = \"welcome\"\n}\nelse msg.state = \"no intent\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":1200,"wires":[["47a64a20.9323c4"]]},{"id":"10db9f70.153721","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.answer = `The word ${msg.text} that means`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":980,"wires":[[]]},{"id":"24eeff37.62aab","type":"function","z":"1783749d.eafb2b","name":"helloArtistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2620,"y":1180,"wires":[["91b1b352.49d08"]]},{"id":"91b1b352.49d08","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2810,"y":1180,"wires":[["ba0eb038.426ed"]]},{"id":"47a64a20.9323c4","type":"switch","z":"1783749d.eafb2b","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"welcome","vt":"str"},{"t":"eq","v":"no intent","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1970,"y":1200,"wires":[["7b053bba.e92684","dac28943.79b798"],["a51e1aad.a6ed98"],["92ce583d.c30878"]]},{"id":"7b053bba.e92684","type":"function","z":"1783749d.eafb2b","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    nickname: msg.text,\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":1180,"wires":[["6db25e.55a70da4"]]},{"id":"6db25e.55a70da4","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2430,"y":1180,"wires":[["24eeff37.62aab"]]},{"id":"dac28943.79b798","type":"debug","z":"1783749d.eafb2b","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":1300,"wires":[]},{"id":"a51e1aad.a6ed98","type":"debug","z":"1783749d.eafb2b","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":1340,"wires":[]},{"id":"92ce583d.c30878","type":"debug","z":"1783749d.eafb2b","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":1380,"wires":[]},{"id":"ba0eb038.426ed","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2810,"y":1240,"wires":[]},{"id":"9df8dab4.357528","type":"debug","z":"1783749d.eafb2b","name":"Dialogflow","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1520,"y":1260,"wires":[]},{"id":"bdb31dba.87dd6","type":"function","z":"fa8df506.b0c4c8","name":"contactWithAdministrator","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"contactWithAdministrator\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":560,"wires":[["6361cb84.64e4b4"]]},{"id":"6361cb84.64e4b4","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":560,"wires":[["546a85e7.a6aa5c"]]},{"id":"546a85e7.a6aa5c","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"contactWithAdministrator\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":560,"wires":[["30184f73.88835"]]},{"id":"30184f73.88835","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1650,"y":560,"wires":[[]]},{"id":"fd459470.d19b88","type":"link out","z":"1783749d.eafb2b","name":"to contact with administrator","links":["fef42953.9d5678"],"x":1140,"y":1060,"wires":[],"l":true},{"id":"dcaa2f64.ac36d","type":"dialogflowv2","z":"d043a9c8.5c1ca8","dialogflow":"f13711e4.d179d","language":"uk","debug":false,"queryParamsOK":false,"x":560,"y":260,"wires":[["4d1c62bc.aaca2c","d08235b4.2865d8"]]},{"id":"cc4db6d6.d44598","type":"function","z":"d043a9c8.5c1ca8","name":"Set user text to payload","func":"msg.payload = msg.text;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":260,"wires":[["dcaa2f64.ac36d"]]},{"id":"4d1c62bc.aaca2c","type":"function","z":"d043a9c8.5c1ca8","name":"Set Dialogflow responce to msg.answer","func":"msg.answer = msg._dialogflow.fulfillmentText;\nmsg.intent = msg._dialogflow.intent.displayName;\n//msg.prevState = msg.user.state;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":260,"wires":[["6b9157d6.15f4a8"]]},{"id":"6b9157d6.15f4a8","type":"function","z":"d043a9c8.5c1ca8","name":"","func":"msg.intent = msg._dialogflow.intent.displayName;\nif(msg.intent === \"Greetings\") {\n    msg.state = \"nlp_welcome\"\n}\nelse if(msg.intent === \"Додати категорію\") {\n    msg.state = \"nlp_addCategory\"\n}\nelse if(msg.intent === \"Кількість на рекламу\") {\n    msg.state = \"nlp_quantityForAdvertising\"\n}\nelse if(msg.intent === \"Не публікується\") {\n    msg.state = \"nlp_notPublishing\"\n}\nelse if(msg.intent === \"Не публікується - yes\") {\n    msg.state = \"nlp_notPublishing_yes\"\n}\nelse if(msg.state == \"nlp_notPublishing\") {\n    msg.intent === \"Не публікується - yes\";\n    msg.state = \"nlp_notPublishing_yes\"\n}\nelse if(msg.intent === \"Не рекламується\") {\n    msg.state = \"nlp_notAdvertising\"\n}\nelse if(msg.intent === \"Охоплення поста\") {\n    msg.state = \"nlp_сoverageOfPost\"\n}\nelse if(msg.intent === \"Попит\") {\n    msg.state = \"nlp_demand\"\n}\nelse if(msg.intent === \"Реклама\") {\n    msg.state = \"nlp_advertising\"\n}\nelse if(msg.intent === \"Час реклами\") {\n    msg.state = \"nlp_advertisingTime\"\n}\nelse if(msg.intent === \"Що публікується\") {\n    msg.state = \"nlp_whatIsPublishing\"\n}\nelse if(msg.intent === \"Що рекламується\") {\n    msg.state = \"nlp_whatIsAdvertising\"\n}\nelse if(msg.intent === \"До побачення\") {\n    msg.state = \"nlp_goodbye\"\n}\nelse if(msg.intent === \"Підтвердження\") {\n    msg.state = \"nlp_yes\"\n}\nelse if(msg.intent === \"Заперечення\") {\n    msg.state = \"nlp_no\"\n}\nelse if(msg.intent === \"Default Fallback Intent\") {\n    msg.state = \"nlp_noIntent\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":260,"wires":[["7e57bc86.0134f4"]]},{"id":"27dff003.7dcc7","type":"function","z":"d043a9c8.5c1ca8","name":"helloArtistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloArtistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1900,"y":240,"wires":[["1b3794af.d6f30b"]]},{"id":"1b3794af.d6f30b","type":"http request","z":"d043a9c8.5c1ca8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2090,"y":240,"wires":[["5342f48b.c3f3fc"]]},{"id":"7e57bc86.0134f4","type":"switch","z":"d043a9c8.5c1ca8","name":"","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"nlp_welcome","vt":"str"},{"t":"eq","v":"nlp_addCategory","vt":"str"},{"t":"eq","v":"nlp_quantityForAdvertising","vt":"str"},{"t":"eq","v":"nlp_notPublishing","vt":"str"},{"t":"eq","v":"nlp_notPublishing_yes","vt":"str"},{"t":"eq","v":"nlp_notAdvertising","vt":"str"},{"t":"eq","v":"nlp_сoverageOfPost","vt":"str"},{"t":"eq","v":"nlp_demand","vt":"str"},{"t":"eq","v":"nlp_advertising","vt":"str"},{"t":"eq","v":"nlp_advertisingTime","vt":"str"},{"t":"eq","v":"nlp_whatIsPublishing","vt":"str"},{"t":"eq","v":"nlp_whatIsAdvertising","vt":"str"},{"t":"eq","v":"nlp_yes","vt":"str"},{"t":"eq","v":"nlp_noIntent","vt":"str"},{"t":"eq","v":"nlp_goodbye","vt":"str"},{"t":"eq","v":"nlp_no","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":17,"x":1270,"y":260,"wires":[["dbf17055.b6882","dc4c550e.d524c8"],["4cf5d51c.ab67ec","dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["dc4c550e.d524c8"],["d36e9ff8.36193"],["d36e9ff8.36193"],["5a3cb19b.1681d","d36e9ff8.36193"]]},{"id":"ebc0df1d.55ca5","type":"function","z":"d043a9c8.5c1ca8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    nickname: msg.text,\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":240,"wires":[["1af8eb1f.c48bf5"]]},{"id":"1af8eb1f.c48bf5","type":"http request","z":"d043a9c8.5c1ca8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":240,"wires":[["27dff003.7dcc7"]]},{"id":"dbf17055.b6882","type":"debug","z":"d043a9c8.5c1ca8","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":200,"wires":[]},{"id":"4cf5d51c.ab67ec","type":"debug","z":"d043a9c8.5c1ca8","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":260,"wires":[]},{"id":"5a3cb19b.1681d","type":"debug","z":"d043a9c8.5c1ca8","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":560,"wires":[]},{"id":"5342f48b.c3f3fc","type":"debug","z":"d043a9c8.5c1ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":240,"wires":[]},{"id":"d08235b4.2865d8","type":"debug","z":"d043a9c8.5c1ca8","name":"Dialogflow","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":800,"y":320,"wires":[]},{"id":"fef42953.9d5678","type":"link in","z":"d043a9c8.5c1ca8","name":"","links":["fd459470.d19b88"],"x":155,"y":260,"wires":[["cc4db6d6.d44598"]]},{"id":"71423918.99c328","type":"http request","z":"d043a9c8.5c1ca8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2050,"y":340,"wires":[["5ce2b564.d6ef8c"]]},{"id":"dc4c550e.d524c8","type":"function","z":"d043a9c8.5c1ca8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\n\nmsg.payload = {\n    chat_id: msg.chat_id,\n    \n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":340,"wires":[["4499c47.65b163c"]]},{"id":"4499c47.65b163c","type":"http request","z":"d043a9c8.5c1ca8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":340,"wires":[["35c9f28c.3c49fe"]]},{"id":"35c9f28c.3c49fe","type":"function","z":"d043a9c8.5c1ca8","name":"","func":"msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/sendMessage\";\nmsg.method = \"POST\";\n\nlet answ = msg.answer.split(\"\\n\")\n\nif(msg.lang == \"uk\") {\n    msg.answ = answ[0]\n}\nelse if(msg.lang == \"ru\") {\n    msg.answ = answ[1]\n}\nelse msg.answ = answ[2]\n\nmsg.payload = {\n    \"text\": msg.answ,\n    \"chat_id\": msg.chat_id,\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":340,"wires":[["71423918.99c328"]]},{"id":"5ce2b564.d6ef8c","type":"debug","z":"d043a9c8.5c1ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2210,"y":340,"wires":[]},{"id":"d36e9ff8.36193","type":"function","z":"d043a9c8.5c1ca8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\n\nmsg.payload = {\n    chat_id: msg.chat_id,\n    \n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":420,"wires":[["85a7a0f4.2a4e7"]]},{"id":"85a7a0f4.2a4e7","type":"http request","z":"d043a9c8.5c1ca8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":420,"wires":[["d01d7e3a.26dcd"]]},{"id":"d01d7e3a.26dcd","type":"function","z":"d043a9c8.5c1ca8","name":"helloArtistMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artistMenu\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1900,"y":420,"wires":[["4036ad05.4c6f74"]]},{"id":"4036ad05.4c6f74","type":"http request","z":"d043a9c8.5c1ca8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2090,"y":420,"wires":[["21aea56c.832d9a"]]},{"id":"21aea56c.832d9a","type":"debug","z":"d043a9c8.5c1ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":420,"wires":[]},{"id":"b12064f.c0aa598","type":"inject","z":"116704c1.2aeebb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":340,"wires":[["4773f1a5.b7ed4"]]},{"id":"4773f1a5.b7ed4","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.method = \"POST\";\nmsg.payload = {\n    \"url\": \"https://7e428dbe2b5d.ngrok.io/webhook\"\n};\nmsg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/setWebhook\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":340,"wires":[["9fb23ebd.08867"]]},{"id":"9fb23ebd.08867","type":"http request","z":"116704c1.2aeebb","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":450,"y":340,"wires":[["19e9ed14.ec7033"]]},{"id":"19e9ed14.ec7033","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":340,"wires":[]},{"id":"b87285a5.f47698","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1980,"wires":[["295e2ab1.a37576"]]},{"id":"295e2ab1.a37576","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":1980,"wires":[["d96b54ad.232848"]]},{"id":"d96b54ad.232848","type":"function","z":"fa8df506.b0c4c8","name":" save picture","func":"msg.picture = msg.payload;\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":1980,"wires":[["d9aaf52d.e98948"]]},{"id":"ed5465ba.fe0468","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/hashtags\";\nmsg.method = \"POST\";\nmsg.payload = {\n  picture_id: msg.settings.picture_id, \n  hashtags: msg.hashtags,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":2480,"wires":[["d8c2c74f.056d88"]]},{"id":"5e6374eb.4df98c","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    name: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2600,"wires":[["ac738ccd.1731c"]]},{"id":"ac738ccd.1731c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":2600,"wires":[["504f5f1c.2dd0a"]]},{"id":"f59b24f4.cead98","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: \"backToArtistMenu\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":660,"wires":[["5816b757.34fab8"]]},{"id":"5816b757.34fab8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1650,"y":660,"wires":[[]]},{"id":"f606c7ca.7a0168","type":"link out","z":"1783749d.eafb2b","name":"Advertising Picture","links":["4b6557f9.7f6508"],"x":970,"y":680,"wires":[],"l":true},{"id":"3ba40e05.299212","type":"comment","z":"fa8df506.b0c4c8","name":"Advertising Picture","info":"","x":210,"y":3680,"wires":[]},{"id":"4b6557f9.7f6508","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["f606c7ca.7a0168"],"x":155,"y":3760,"wires":[["77976e7.37b549"]]},{"id":"77976e7.37b549","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"advertisingPicture","vt":"str"},{"t":"eq","v":"moreAboutAdvertising","vt":"str"},{"t":"cont","v":"advertisePicture","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":260,"y":3760,"wires":[["c3a58fff.1c31e"],["7309e25.d6e1b1c"],["5d903ed5.d3c3f","1073d68.f07782a"],[]]},{"id":"7309e25.d6e1b1c","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingMore","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingMore\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":3720,"wires":[["36f761b6.850cde"]]},{"id":"36f761b6.850cde","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":680,"y":3720,"wires":[[]]},{"id":"31c81aa7.e5cac6","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingAllPicturesText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesText\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":3680,"wires":[["51b86dc9.3eb324"]]},{"id":"51b86dc9.3eb324","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":740,"y":3680,"wires":[["54eb0008.de9bf"]]},{"id":"54eb0008.de9bf","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingAllPicturesButton","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesButton\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":3680,"wires":[["acd9487c.dae548"]]},{"id":"acd9487c.dae548","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":3680,"wires":[[]]},{"id":"c46bc745.6e7928","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingSelectedPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3760,"wires":[["64c13666.6cc368"]]},{"id":"64c13666.6cc368","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":720,"y":3760,"wires":[["513783fe.d37d3c"]]},{"id":"513783fe.d37d3c","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingPictureButton","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingPictureButton\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":3760,"wires":[["18093deb.284812"]]},{"id":"18093deb.284812","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1180,"y":3760,"wires":[[]]},{"id":"db39aca5.b100a","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"statisticByPictures","vt":"str"},{"t":"eq","v":"statisticByHashtags","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":260,"y":3920,"wires":[["d9f8b025.488c7"],[]]},{"id":"23793645.aab22a","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["6ea6a4fc.02415c"],"x":145,"y":3920,"wires":[["db39aca5.b100a"]]},{"id":"6ea6a4fc.02415c","type":"link out","z":"1783749d.eafb2b","name":"Statistic","links":["23793645.aab22a"],"x":940,"y":720,"wires":[],"l":true},{"id":"d9f8b025.488c7","type":"function","z":"fa8df506.b0c4c8","name":"statisticByPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artViewStatistics\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":3900,"wires":[["e329ff8e.34ecd"]]},{"id":"e329ff8e.34ecd","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":720,"y":3900,"wires":[[]]},{"id":"ac7820f9.40069","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":360,"wires":[[]]},{"id":"1bd82e0b.e276b2","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["d7669393.fe6f7"],"x":175,"y":3140,"wires":[["49e232e9.03228c"]]},{"id":"7bb22684.cd4a38","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&limit=1`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1160,"wires":[["43d8a769.198388"]]},{"id":"43d8a769.198388","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1160,"wires":[["85d00532.3817e8","970c30b8.b4af2"]]},{"id":"40e76e66.2cb17","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1240,"wires":[["bc451c5d.aa2bf"]]},{"id":"85d00532.3817e8","type":"debug","z":"fa8df506.b0c4c8","name":"oooooooo","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":970,"y":1320,"wires":[]},{"id":"3bcf044f.e85dbc","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.delete_picture_action,\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":1240,"wires":[["16ce2f0b.f09891"]]},{"id":"16ce2f0b.f09891","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2450,"y":1240,"wires":[[]]},{"id":"d7669393.fe6f7","type":"link out","z":"1783749d.eafb2b","name":"Action With Post","links":["1bd82e0b.e276b2"],"x":970,"y":760,"wires":[],"l":true},{"id":"49e232e9.03228c","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"cont","v":"deletePicture","vt":"str"},{"t":"cont","v":"deleteSelectedPicture","vt":"str"},{"t":"eq","v":"noDeleteSelectedPicture","vt":"str"},{"t":"cont","v":"editPicture","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":290,"y":3140,"wires":[["e3c45c45.b6de7","d99c37e3.adf8a8"],["2534f08f.e68bf"],["3d497289.8dc30e"],["86a8a111.f5e1f"],["1ba33cbb.0c2463"],["8602642c.267028"]]},{"id":"e3c45c45.b6de7","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3000,"wires":[["25cdf173.07a41e"]]},{"id":"25cdf173.07a41e","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":630,"y":3000,"wires":[["b89296fd.7e1ee8"]]},{"id":"b89296fd.7e1ee8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = 1;\n} else {\n    msg.picture_index++;\n}\nif(msg.picture_index >= msg.numberOfArtistsPictures) {\n    msg.picture_index = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":3000,"wires":[["82a428a.f27dcd8"]]},{"id":"b87f2780.883c38","type":"comment","z":"116704c1.2aeebb","name":"set webhook","info":"","x":130,"y":300,"wires":[]},{"id":"bc451c5d.aa2bf","type":"function","z":"fa8df506.b0c4c8","name":"artDeletePicturesText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeletePicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":1240,"wires":[["1b53110a.1303ff"]]},{"id":"1b53110a.1303ff","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":1240,"wires":[["62438b17.8400b4"]]},{"id":"2305e4a5.4687fc","type":"debug","z":"fa8df506.b0c4c8","name":"122","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1580,"wires":[]},{"id":"298483bd.3f1b6c","type":"debug","z":"fa8df506.b0c4c8","name":"123","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1700,"wires":[]},{"id":"7310c46e.2ed0ac","type":"debug","z":"fa8df506.b0c4c8","name":"124","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1820,"wires":[]},{"id":"dbc8264f.4f78e8","type":"debug","z":"fa8df506.b0c4c8","name":"126","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1940,"wires":[]},{"id":"d80057ee.557d68","type":"debug","z":"fa8df506.b0c4c8","name":"121","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2080,"wires":[]},{"id":"43b330a9.318b9","type":"link out","z":"fa8df506.b0c4c8","name":"","links":["2b4731a8.4ae0ee"],"x":1355,"y":2120,"wires":[]},{"id":"2b4731a8.4ae0ee","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["43b330a9.318b9","cde2a2cf.442c"],"x":635,"y":1660,"wires":[["6570405.ac920c"]]},{"id":"56fdfec2.66568","type":"debug","z":"fa8df506.b0c4c8","name":"122","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2200,"wires":[]},{"id":"ea98b15c.bd67b","type":"link out","z":"fa8df506.b0c4c8","name":"","links":["cc7ce9d7.666e18"],"x":1015,"y":2240,"wires":[]},{"id":"cc7ce9d7.666e18","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["ea98b15c.bd67b"],"x":635,"y":1780,"wires":[["64aab369.77266c"]]},{"id":"3182dd1a.1f5722","type":"debug","z":"fa8df506.b0c4c8","name":"123","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2320,"wires":[]},{"id":"6eeb7df5.869874","type":"link out","z":"fa8df506.b0c4c8","name":"","links":["b45fd8b8.7e8e98"],"x":1015,"y":2360,"wires":[]},{"id":"b45fd8b8.7e8e98","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["6eeb7df5.869874"],"x":635,"y":1900,"wires":[["68b46b20.1d1a24"]]},{"id":"13c59227.9d2f4e","type":"debug","z":"fa8df506.b0c4c8","name":"124","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2440,"wires":[]},{"id":"e8492665.54fe88","type":"debug","z":"fa8df506.b0c4c8","name":"125","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2560,"wires":[]},{"id":"7d055e52.e1a5d","type":"debug","z":"fa8df506.b0c4c8","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":20,"wires":[]},{"id":"89699514.e15168","type":"debug","z":"fa8df506.b0c4c8","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":120,"wires":[]},{"id":"77b068fa.9e5598","type":"debug","z":"fa8df506.b0c4c8","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":220,"wires":[]},{"id":"919560a4.1f07","type":"debug","z":"fa8df506.b0c4c8","name":"4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":320,"wires":[]},{"id":"76c37e67.bc946","type":"debug","z":"fa8df506.b0c4c8","name":"5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":420,"wires":[]},{"id":"31527248.ab217e","type":"debug","z":"fa8df506.b0c4c8","name":"6","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":520,"wires":[]},{"id":"8752f401.a4e608","type":"debug","z":"fa8df506.b0c4c8","name":"7","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":620,"wires":[]},{"id":"2eb78ebc.14a172","type":"debug","z":"fa8df506.b0c4c8","name":"12","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":350,"y":840,"wires":[]},{"id":"7ddd1828.abb7d8","type":"comment","z":"fa8df506.b0c4c8","name":"2 ❤️ погано ропарсує хештеги","info":"","x":1130,"y":1940,"wires":[]},{"id":"98e12c95.a5473","type":"debug","z":"fa8df506.b0c4c8","name":"21","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":960,"wires":[]},{"id":"7afcf826.9171a8","type":"debug","z":"fa8df506.b0c4c8","name":"31","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":1120,"wires":[]},{"id":"970c30b8.b4af2","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1160,"wires":[["b2d717fe.98ff28","73e1f372.5e20fc"],["d1c5d535.6cd388","40e76e66.2cb17"]]},{"id":"d1c5d535.6cd388","type":"debug","z":"fa8df506.b0c4c8","name":"> 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1200,"wires":[]},{"id":"b2d717fe.98ff28","type":"debug","z":"fa8df506.b0c4c8","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1100,"wires":[]},{"id":"73e1f372.5e20fc","type":"function","z":"fa8df506.b0c4c8","name":"artActionsWithoutPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithoutPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":1140,"wires":[["3db5a442.12350c"]]},{"id":"3db5a442.12350c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1570,"y":1140,"wires":[[]]},{"id":"e7bbc4fa.539168","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&limit=1`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1000,"wires":[["6835ff34.ffd19"]]},{"id":"6835ff34.ffd19","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1000,"wires":[["f2a677ff.fb0f88"]]},{"id":"1cc67bb4.d77ca4","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":1060,"wires":[["992f4daa.a7691","ee76e3a4.8bfd3"]]},{"id":"992f4daa.a7691","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2090,"y":1060,"wires":[["904c62f1.b1608"]]},{"id":"8136c20a.3e36c","type":"comment","z":"fa8df506.b0c4c8","name":"нема ще картин в художника","info":"","x":1510,"y":920,"wires":[]},{"id":"69da02e4.1d28cc","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1060,"wires":[["a110ff5f.9433"]]},{"id":"904c62f1.b1608","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.edit_picture_action,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":1060,"wires":[["9ec638cf.018228"]]},{"id":"9ec638cf.018228","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2430,"y":1060,"wires":[[]]},{"id":"a110ff5f.9433","type":"function","z":"fa8df506.b0c4c8","name":"artEditPicturesText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1060,"wires":[["5074354b.90083c","99da36bd.d1e498"]]},{"id":"f2a677ff.fb0f88","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1000,"wires":[["1907d1a9.a7d87e","7b6dc6bb.dbfb98"],["3fc1b0c3.0fb8f","69da02e4.1d28cc"]]},{"id":"3fc1b0c3.0fb8f","type":"debug","z":"fa8df506.b0c4c8","name":"> 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1020,"wires":[]},{"id":"1907d1a9.a7d87e","type":"debug","z":"fa8df506.b0c4c8","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":920,"wires":[]},{"id":"7b6dc6bb.dbfb98","type":"function","z":"fa8df506.b0c4c8","name":"artActionsWithoutPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithoutPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":960,"wires":[["50fd5465.dde75c"]]},{"id":"50fd5465.dde75c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1570,"y":960,"wires":[[]]},{"id":"5074354b.90083c","type":"debug","z":"fa8df506.b0c4c8","name":"oooooooo","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1690,"y":1020,"wires":[]},{"id":"ee76e3a4.8bfd3","type":"debug","z":"fa8df506.b0c4c8","name":"oooooooo","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2010,"y":1000,"wires":[]},{"id":"99da36bd.d1e498","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":1060,"wires":[["1cc67bb4.d77ca4"]]},{"id":"86c7cba6.d24af8","type":"comment","z":"fa8df506.b0c4c8","name":"3 ❤️ натискання кнопки \"далі\" при видаленні чи редагуванні поста","info":"","x":670,"y":2960,"wires":[]},{"id":"1d16dd5f.f1eaf3","type":"comment","z":"fa8df506.b0c4c8","name":"4 ❤️ натискання кнопки \"назад\" при видаленні чи редагуванні поста","info":"","x":680,"y":3040,"wires":[]},{"id":"a98ac8dc.01ad88","type":"comment","z":"fa8df506.b0c4c8","name":"5 ❤️ вибір поста для видалення","info":"","x":560,"y":3140,"wires":[]},{"id":"feab7a6.9757d88","type":"comment","z":"fa8df506.b0c4c8","name":"7 ❤️ вибір поста для редагування","info":"","x":560,"y":3340,"wires":[]},{"id":"a54645af.5c7088","type":"comment","z":"fa8df506.b0c4c8","name":"8 ❤️ можливість перегляду зредагованого поста","info":"","x":610,"y":3420,"wires":[]},{"id":"3d497289.8dc30e","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nmsg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&id=${msg.picture_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3180,"wires":[["adf002e7.d8453"]]},{"id":"adf002e7.d8453","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3180,"wires":[["662633f.01242cc"]]},{"id":"bb338dbf.1b25","type":"function","z":"fa8df506.b0c4c8","name":"artDeleteSelectedPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":3180,"wires":[["22526173.89a9de"]]},{"id":"22526173.89a9de","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":3180,"wires":[["6ef11b68.ce5df4"]]},{"id":"662633f.01242cc","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\nmsg.picture.hashtags = msg.picture.Hashtags.map(hashtag => {return hashtag.tag; }).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3180,"wires":[["bb338dbf.1b25"]]},{"id":"2d193413.252f4c","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        currentViewPicture: msg.picture\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":3180,"wires":[["f7f6e5b9.235758"]]},{"id":"f7f6e5b9.235758","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2010,"y":3180,"wires":[[]]},{"id":"6ef11b68.ce5df4","type":"function","z":"fa8df506.b0c4c8","name":"artDeleteSelectedPictureText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPictureButtons\",\n    templateVars: {\n        picture_id: msg.picture_id,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1440,"y":3180,"wires":[["763683de.ec2c9c"]]},{"id":"763683de.ec2c9c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1670,"y":3180,"wires":[["2d193413.252f4c"]]},{"id":"8602642c.267028","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nmsg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&id=${msg.picture_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3380,"wires":[["c644f896.dec578"]]},{"id":"c644f896.dec578","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3380,"wires":[["bacf2177.f57d9"]]},{"id":"5d7fb43b.14916c","type":"function","z":"fa8df506.b0c4c8","name":"artEditSelectedPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditSelectedPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":3380,"wires":[["5c68b38f.4afc9c"]]},{"id":"5c68b38f.4afc9c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1210,"y":3380,"wires":[["36b8f8f5.ed7dc8"]]},{"id":"bacf2177.f57d9","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\nmsg.picture.hashtags = msg.picture.Hashtags.map(hashtag => {return hashtag.tag; }).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3380,"wires":[["5d7fb43b.14916c"]]},{"id":"c2db7049.36482","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        currentViewPicture: msg.picture\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":3380,"wires":[["8ef1b5ee.3cc018"]]},{"id":"8ef1b5ee.3cc018","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1990,"y":3380,"wires":[[]]},{"id":"36b8f8f5.ed7dc8","type":"function","z":"fa8df506.b0c4c8","name":"artEditSelectedPictureButtons","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditSelectedPictureButtons\",\n    templateVars: {\n        picture_id: msg.picture_id,\n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1430,"y":3380,"wires":[["51b701d4.aa6ac"]]},{"id":"51b701d4.aa6ac","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1650,"y":3380,"wires":[["c2db7049.36482"]]},{"id":"62d15661.bc2568","type":"comment","z":"fa8df506.b0c4c8","name":"6 ❤️ видалення вибраного поста","info":"","x":560,"y":3220,"wires":[]},{"id":"86a8a111.f5e1f","type":"function","z":"fa8df506.b0c4c8","name":"artDeleteSelectedPictureStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPictureStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":3260,"wires":[["336060c5.feeef"]]},{"id":"336060c5.feeef","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":3260,"wires":[["9bfbad7b.237e"]]},{"id":"9bfbad7b.237e","type":"function","z":"fa8df506.b0c4c8","name":"artDeleteSelectedPictureText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artDeleteSelectedPictureText\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":3260,"wires":[["a04c1434.06ff58"]]},{"id":"a04c1434.06ff58","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":3260,"wires":[["ae57f5ef.769af8"]]},{"id":"24b0d10d.4d74ee","type":"function","z":"fa8df506.b0c4c8","name":"artNotDeleteSelectedPictureStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artNotDeleteSelectedPictureStiker\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":3300,"wires":[["4cd25d0f.f539c4"]]},{"id":"4cd25d0f.f539c4","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":3300,"wires":[["a540bac3.2cd698"]]},{"id":"a540bac3.2cd698","type":"link out","z":"fa8df506.b0c4c8","name":"","links":["c333257c.4532e8"],"x":1395,"y":3300,"wires":[]},{"id":"c333257c.4532e8","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["a540bac3.2cd698"],"x":515,"y":200,"wires":[["e727256.2105bd8"]]},{"id":"1ba33cbb.0c2463","type":"function","z":"fa8df506.b0c4c8","name":"artNotDeleteSelectedPictureText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.picture = msg.payload;\nmsg.payload = {\n    id: msg.payload.id,\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artNotDeleteSelectedPictureText\",\n    /*templateVars: {\n\t   name: msg.text\n\n\t}*/\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":3300,"wires":[["8ddcb2f.a93055"]]},{"id":"8ddcb2f.a93055","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":3300,"wires":[["24b0d10d.4d74ee"]]},{"id":"fa555e9c.1fe5","type":"link out","z":"1783749d.eafb2b","name":"Edit Post","links":["9a2862da.e3c52"],"x":940,"y":800,"wires":[],"l":true},{"id":"9a2862da.e3c52","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["fa555e9c.1fe5"],"x":75,"y":4260,"wires":[["a202f42a.311b38","c3f1daeb.4fd498"]]},{"id":"a6d096d3.b662c8","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"originalMessage.callback_query.data","propertyType":"msg","rules":[{"t":"cont","v":"editCategory","vt":"str"},{"t":"cont","v":"editImage","vt":"str"},{"t":"cont","v":"editDescription","vt":"str"},{"t":"cont","v":"editSize","vt":"str"},{"t":"cont","v":"editHashtags","vt":"str"},{"t":"cont","v":"editNamePicture","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":330,"y":4260,"wires":[["29d06955.7ffb36","7cf43eda.613d6"],["ba9a91d3.d251a","51828505.1f694c"],["3252f9e1.1e5516","9aefb01.859fa5"],["ea9973af.82587","35da26e3.89a83a"],["facc5ff5.d066b","224bc624.1441fa"],["32b1c0e8.6951d","856e2967.3cdaa8"]]},{"id":"29d06955.7ffb36","type":"debug","z":"fa8df506.b0c4c8","name":"editCategory","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":4040,"wires":[]},{"id":"ba9a91d3.d251a","type":"debug","z":"fa8df506.b0c4c8","name":"editImage","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":4120,"wires":[]},{"id":"3252f9e1.1e5516","type":"debug","z":"fa8df506.b0c4c8","name":"editDescription","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":500,"y":4200,"wires":[]},{"id":"ea9973af.82587","type":"debug","z":"fa8df506.b0c4c8","name":"editSize","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":4280,"wires":[]},{"id":"facc5ff5.d066b","type":"debug","z":"fa8df506.b0c4c8","name":"editHashtags","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":4360,"wires":[]},{"id":"32b1c0e8.6951d","type":"debug","z":"fa8df506.b0c4c8","name":"editNamePicture","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":510,"y":4440,"wires":[]},{"id":"865034ae.9beaa8","type":"link in","z":"fa8df506.b0c4c8","name":"","links":[],"x":635,"y":1540,"wires":[["26db2c4c.2bf934"]]},{"id":"82a428a.f27dcd8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?user_id=${msg.chat_id}&artist_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3000,"wires":[["6a351ec3.ae272"]]},{"id":"6a351ec3.ae272","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":3000,"wires":[["cd55e35e.c7c62"]]},{"id":"cd55e35e.c7c62","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":3000,"wires":[["c225a0ff.c3a43"]]},{"id":"2534f08f.e68bf","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3080,"wires":[["86a3bda5.0c5bc"]]},{"id":"86a3bda5.0c5bc","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":630,"y":3080,"wires":[["f600c4ab.39b008"]]},{"id":"f600c4ab.39b008","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n} else {\n    msg.picture_index--;\n}\nif(msg.picture_index < 0) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":3080,"wires":[["33030857.fcc578"]]},{"id":"2e47e6be.9b07ca","type":"function","z":"fa8df506.b0c4c8","name":"artEditDeletePictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditDeletePictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":3100,"wires":[["ac9282e9.ff072"]]},{"id":"ac9282e9.ff072","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":3100,"wires":[[]]},{"id":"33030857.fcc578","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?user_id=${msg.chat_id}&artist_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3080,"wires":[["495d3cf5.84cf74"]]},{"id":"495d3cf5.84cf74","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":3080,"wires":[["a1ce7bb7.7f15d8"]]},{"id":"a1ce7bb7.7f15d8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":3080,"wires":[["c225a0ff.c3a43"]]},{"id":"ae57f5ef.769af8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1440,"y":3260,"wires":[["1ab7348b.38c1bb"]]},{"id":"1ab7348b.38c1bb","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.method = \"DELETE\";\nmsg.url = `http://localhost:3002/picture/${msg.picture_id}`;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1600,"y":3260,"wires":[["491272a3.fdc3fc","2bf77898.34c978"]]},{"id":"491272a3.fdc3fc","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1770,"y":3260,"wires":[["2bf77898.34c978"]]},{"id":"2bf77898.34c978","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1910,"y":3220,"wires":[]},{"id":"39fd1489.cb3dac","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"settings.action","propertyType":"msg","rules":[{"t":"eq","v":"delete_picture_action","vt":"msg"},{"t":"eq","v":"edit_picture_action","vt":"msg"},{"t":"eq","v":"advertise_picture_action","vt":"msg"}],"checkall":"true","repair":false,"outputs":3,"x":1770,"y":3080,"wires":[["2e47e6be.9b07ca"],["896adccd.d2f25"],["d1c56a10.a2bc18"]]},{"id":"896adccd.d2f25","type":"function","z":"fa8df506.b0c4c8","name":"artEditEditPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditEditPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":3140,"wires":[["c642f611.362968"]]},{"id":"c642f611.362968","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":3140,"wires":[[]]},{"id":"75df5d59.137094","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/categories`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":900,"wires":[["3bd3f9b4.d46d76"]]},{"id":"3bd3f9b4.d46d76","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":900,"wires":[["c4026cd7.69dbb","7b3c0741.13cb58"]]},{"id":"c4026cd7.69dbb","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.categories = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":900,"wires":[["ac93b303.11647","5b950073.8a157"]]},{"id":"a202f42a.311b38","type":"debug","z":"fa8df506.b0c4c8","name":"editCategory","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":270,"y":4080,"wires":[]},{"id":"55dec334.94a3ec","type":"comment","z":"fa8df506.b0c4c8","name":"9 ❤️ перезапис в бд кожного поля зробити треба","info":"","x":610,"y":4660,"wires":[]},{"id":"a3a8fe4d.7a064","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":1420,"wires":[[]]},{"id":"939dd855.7a22e8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n    description: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1420,"wires":[["a3a8fe4d.7a064"]]},{"id":"51828505.1f694c","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureImage","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureImage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4160,"wires":[["48c7535c.aa5e8c"]]},{"id":"48c7535c.aa5e8c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4160,"wires":[["2984897.13f2976"]]},{"id":"2984897.13f2976","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostImage_${msg.picture_id}`\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4160,"wires":[["2c0cb608.761d6a"]]},{"id":"2c0cb608.761d6a","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4160,"wires":[[]]},{"id":"bc66f23e.35b53","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"state","propertyType":"msg","rules":[{"t":"cont","v":"editPostCategory","vt":"str"},{"t":"cont","v":"editPostImage","vt":"str"},{"t":"cont","v":"editPostDescription","vt":"str"},{"t":"cont","v":"editPostSize","vt":"str"},{"t":"cont","v":"editPostHashtags","vt":"str"},{"t":"cont","v":"editPostName","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":290,"y":4920,"wires":[["55b0b333.ddab7c"],["651cc60c.606888"],["a06105a9.1e1728"],["a8a383f8.98206"],["29345762.599938"],["6846a0d9.ba942"]]},{"id":"e384e9c3.3c7bf8","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["6eef3c72.8d3064"],"x":55,"y":4920,"wires":[["33032d6b.547f42"]]},{"id":"6ee1f46e.276c6c","type":"comment","z":"fa8df506.b0c4c8","name":"Successfull Edit Post","info":"","x":180,"y":4840,"wires":[]},{"id":"1e994cbb.e38063","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureCategoryDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureCategoryDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":4760,"wires":[["5dcb0b21.c7e484"]]},{"id":"5dcb0b21.c7e484","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1430,"y":4760,"wires":[["6219f818.94dd08"]]},{"id":"6eef3c72.8d3064","type":"link out","z":"1783749d.eafb2b","name":"Successfull Edit Post","links":["e384e9c3.3c7bf8"],"x":1120,"y":1100,"wires":[],"l":true},{"id":"c1cc69ab.5ec8a8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":4700,"wires":[["8358c689.f9ce88"]]},{"id":"3f88aed.1e6d452","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":4700,"wires":[["c1cc69ab.5ec8a8"]]},{"id":"c41ebc0c.905de","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":990,"y":4700,"wires":[[]]},{"id":"8358c689.f9ce88","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    artist_id: msg.chat_id,\n    externalPictureUrl: \"https://api.telegram.org/file/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/\"+msg.payload.result.file_path,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":4700,"wires":[["c41ebc0c.905de"]]},{"id":"bccde8ad.45bab8","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureCategory","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureCategory\",\n    templateVars: {\n        picture_id: msg.picture_id,\n        categories: msg.categories,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":4080,"wires":[["829fff89.d0b0f"]]},{"id":"829fff89.d0b0f","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":4080,"wires":[["796c908f.03c4b"]]},{"id":"796c908f.03c4b","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostCategory_${msg.picture_id}`\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":4080,"wires":[["f0858816.fcb058"]]},{"id":"f0858816.fcb058","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1530,"y":4080,"wires":[[]]},{"id":"9aefb01.859fa5","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureDescription","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureDescription\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":4240,"wires":[["6b64cd25.342074"]]},{"id":"6b64cd25.342074","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4240,"wires":[["9eecadf8.ae689"]]},{"id":"9eecadf8.ae689","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostDescription_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4240,"wires":[["da69685f.e87b58"]]},{"id":"da69685f.e87b58","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4240,"wires":[[]]},{"id":"35da26e3.89a83a","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureSize","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureSize\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4320,"wires":[["af47d482.3a93f8"]]},{"id":"af47d482.3a93f8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4320,"wires":[["f63968d9.537648"]]},{"id":"f63968d9.537648","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostSize_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4320,"wires":[["1e29ced9.75ca01"]]},{"id":"1e29ced9.75ca01","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4320,"wires":[[]]},{"id":"224bc624.1441fa","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureHashtags","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureHashtags\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":4400,"wires":[["c9c94f8d.2de9b"]]},{"id":"c9c94f8d.2de9b","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4400,"wires":[["17c29df9.6900a2"]]},{"id":"17c29df9.6900a2","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostHashtags_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4400,"wires":[["21cd8c00.6a9f84"]]},{"id":"21cd8c00.6a9f84","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4400,"wires":[[]]},{"id":"856e2967.3cdaa8","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureName","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureName\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4480,"wires":[["9755d5c.a3e6028"]]},{"id":"9755d5c.a3e6028","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4480,"wires":[["fba21cef.76bb9"]]},{"id":"fba21cef.76bb9","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    state: `editPostName_${msg.picture_id}`,\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4480,"wires":[["ce470079.522a3"]]},{"id":"ce470079.522a3","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4480,"wires":[[]]},{"id":"24c9b65d.be8ffa","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureImageDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureImageDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":4800,"wires":[["470b2ee7.aca3b"]]},{"id":"470b2ee7.aca3b","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1510,"y":4800,"wires":[["6219f818.94dd08"]]},{"id":"af5be599.833db8","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureDescriptionDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureDescriptionDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":4840,"wires":[["57984780.3a57b8"]]},{"id":"57984780.3a57b8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":4840,"wires":[["6219f818.94dd08"]]},{"id":"a9abd60a.afd638","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureSizeDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureSizeDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":4880,"wires":[["ff32455b.0e45f8"]]},{"id":"ff32455b.0e45f8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1410,"y":4880,"wires":[["6219f818.94dd08"]]},{"id":"ce674532.2f92d8","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureHashtagsDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureHashtagsDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":4920,"wires":[["fdbc4d99.d4ee8"]]},{"id":"fdbc4d99.d4ee8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1490,"y":4920,"wires":[["6219f818.94dd08"]]},{"id":"32faae03.108442","type":"function","z":"fa8df506.b0c4c8","name":"artEditPictureNameDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditPictureNameDone\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":4960,"wires":[["b1a6b6fe.0ebed8"]]},{"id":"b1a6b6fe.0ebed8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1410,"y":4960,"wires":[["6219f818.94dd08"]]},{"id":"88a16b1a.7da948","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["8371a8ec.346e48"],"x":1275,"y":3420,"wires":[["36b8f8f5.ed7dc8"]]},{"id":"8371a8ec.346e48","type":"link out","z":"1783749d.eafb2b","name":"","links":["88a16b1a.7da948","54afbb3f.87fd44"],"x":935,"y":860,"wires":[]},{"id":"396e705a.79e34","type":"function","z":"fa8df506.b0c4c8","name":"artEditSelectedPictureDone","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artEditSelectedPictureDone\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags:msg.picture.hashtags ? '#' + msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":4560,"wires":[["4e3fa426.38101c","77628fcd.8815b"]]},{"id":"4e3fa426.38101c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":4560,"wires":[["70927703.50b0a8"]]},{"id":"e4724a40.dbaf88","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.payload.settings.picture_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":4560,"wires":[["55c887ac.b2d9b8"]]},{"id":"55c887ac.b2d9b8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":4560,"wires":[["2227cd28.188832"]]},{"id":"2227cd28.188832","type":"function","z":"fa8df506.b0c4c8","name":" save picture","func":"msg.picture = msg.payload;\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":4560,"wires":[["396e705a.79e34"]]},{"id":"de11cf5.0ef9e3","type":"debug","z":"fa8df506.b0c4c8","name":"126","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":4520,"wires":[]},{"id":"5f559ce1.c76004","type":"comment","z":"fa8df506.b0c4c8","name":"10 ❤️підтянуввання зредагованої картинки зробити треба","info":"","x":800,"y":4520,"wires":[]},{"id":"879515c4.1610e8","type":"link out","z":"1783749d.eafb2b","name":"","links":["1b006797.d49e08"],"x":895,"y":840,"wires":[]},{"id":"1b006797.d49e08","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["879515c4.1610e8"],"x":375,"y":4560,"wires":[["e4724a40.dbaf88"]]},{"id":"1d882678.39a4da","type":"comment","z":"fa8df506.b0c4c8","name":"1 ❤️ через категоріі крашнулося і категоріі не приходять","info":"","x":660,"y":860,"wires":[]},{"id":"32e4120b.0bc03e","type":"link out","z":"1783749d.eafb2b","name":"","links":[],"x":1035,"y":1140,"wires":[]},{"id":"ba4e3232.01bc2","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.advertise_picture_action,\n    }\n};\nreturn msg;\n//msg.advertise_picture_action = 'advertise_picture';","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":260,"wires":[["b0dc44b2.b9e188"]]},{"id":"b0dc44b2.b9e188","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":260,"wires":[[]]},{"id":"1b689cba.ac1563","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingAllPicturesButton","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesButton\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":3640,"wires":[["4edab848.7c2b78"]]},{"id":"4edab848.7c2b78","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":3640,"wires":[[]]},{"id":"53cea80d.a57dc8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3640,"wires":[["8e1e1427.ab9bb8"]]},{"id":"de729b86.ee9808","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.delete_picture_action,\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":3640,"wires":[["43f01d9d.54e1d4"]]},{"id":"43f01d9d.54e1d4","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":3640,"wires":[[]]},{"id":"8e1e1427.ab9bb8","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingAllPicturesText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":3640,"wires":[["d3c1423c.8a996"]]},{"id":"d3c1423c.8a996","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":3640,"wires":[["1b689cba.ac1563"]]},{"id":"e04e31df.85c2e","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingAllPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":3600,"wires":[["e3355daa.47f59"]]},{"id":"e3355daa.47f59","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2210,"y":3600,"wires":[["bfaf6161.28802"]]},{"id":"dfff27b9.289568","type":"comment","z":"fa8df506.b0c4c8","name":"нема ще картин в художника","info":"","x":1530,"y":3460,"wires":[]},{"id":"c3a58fff.1c31e","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&limit=1&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":3520,"wires":[["7827a0c9.81e58"]]},{"id":"7827a0c9.81e58","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":3520,"wires":[["14908846.d02388"]]},{"id":"77fcd199.854a1","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":3600,"wires":[["aeacf455.2a9c78"]]},{"id":"bfaf6161.28802","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        action: msg.advertise_picture_action,\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":3600,"wires":[["3b6f73e7.3ddebc"]]},{"id":"3b6f73e7.3ddebc","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2550,"y":3600,"wires":[[]]},{"id":"aeacf455.2a9c78","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingAllPicturesText","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingAllPicturesText\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":3600,"wires":[["a3234e6e.1de2d"]]},{"id":"a3234e6e.1de2d","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1750,"y":3600,"wires":[["e04e31df.85c2e"]]},{"id":"14908846.d02388","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1150,"y":3520,"wires":[["72c634cb.1e965c","3cb5249b.9dae1c"],["31e1906.9b8f17","77fcd199.854a1"]]},{"id":"31e1906.9b8f17","type":"debug","z":"fa8df506.b0c4c8","name":"> 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":3560,"wires":[]},{"id":"72c634cb.1e965c","type":"debug","z":"fa8df506.b0c4c8","name":"= 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":3460,"wires":[]},{"id":"3cb5249b.9dae1c","type":"function","z":"fa8df506.b0c4c8","name":"artActionsWithoutPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artActionsWithoutPicture\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1370,"y":3500,"wires":[["9f1f55a3.39a628"]]},{"id":"9f1f55a3.39a628","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1590,"y":3500,"wires":[[]]},{"id":"d6c372df.ad89d","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2430,"y":2980,"wires":[]},{"id":"d99c37e3.adf8a8","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":430,"y":2920,"wires":[]},{"id":"d1c56a10.a2bc18","type":"function","z":"fa8df506.b0c4c8","name":"artEditAdvertisingAllPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditAdvertisingAllPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":3060,"wires":[["8341c579.5fde58"]]},{"id":"8341c579.5fde58","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2190,"y":3060,"wires":[[]]},{"id":"fc19c9c7.8ef588","type":"comment","z":"fa8df506.b0c4c8","name":"4 ❤️ коли вперід то нове повідомлення прихолить, а коли назад то все ок","info":"","x":2310,"y":2880,"wires":[]},{"id":"edfd7ba1.116548","type":"comment","z":"fa8df506.b0c4c8","name":"8 ❤️ можливість перегляду зредагованого поста","info":"","x":610,"y":3840,"wires":[]},{"id":"5d903ed5.d3c3f","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nmsg.url = `http://localhost:3002/picture?artist_id=${msg.chat_id}&id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3800,"wires":[["cd5bd4fa.a03778"]]},{"id":"cd5bd4fa.a03778","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":3800,"wires":[["7476d2ad.0c9fac"]]},{"id":"36a2528.3fa48ae","type":"function","z":"fa8df506.b0c4c8","name":"artEditSelectedPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingSelectedPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":3800,"wires":[["215c6ddf.ba99c2"]]},{"id":"215c6ddf.ba99c2","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1210,"y":3800,"wires":[["10718f0a.179211"]]},{"id":"7476d2ad.0c9fac","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\nmsg.picture.hashtags = msg.picture.Hashtags.map(hashtag => {return hashtag.tag; }).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3800,"wires":[["36a2528.3fa48ae"]]},{"id":"ed920171.83971","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    // settings: {\n    //     currentViewPicture: msg.picture\n    // }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":3800,"wires":[["7977c5c1.ad3ddc"]]},{"id":"7977c5c1.ad3ddc","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1990,"y":3800,"wires":[[]]},{"id":"10718f0a.179211","type":"function","z":"fa8df506.b0c4c8","name":"artAdvertisingPictureButton","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"artAdvertisingPictureButton\",\n    templateVars: {\n        picture_id: msg.picture_id,\n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1420,"y":3800,"wires":[["dbb00765.914248"]]},{"id":"dbb00765.914248","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1650,"y":3800,"wires":[["ed920171.83971"]]},{"id":"7b3c0741.13cb58","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":790,"y":820,"wires":[]},{"id":"5b950073.8a157","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":950,"y":820,"wires":[]},{"id":"c8ebf037.c6127","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1110,"y":800,"wires":[]},{"id":"30f9f72.c84b308","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":800,"wires":[]},{"id":"b014636d.5f8ff","type":"debug","z":"fa8df506.b0c4c8","name":"121","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":2080,"wires":[]},{"id":"c3f1daeb.4fd498","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":4260,"wires":[["a6d096d3.b662c8"]]},{"id":"7cf43eda.613d6","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/categories`;\nmsg.method = \"GET\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":4080,"wires":[["ddf6fad2.177ad8"]]},{"id":"ddf6fad2.177ad8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":4080,"wires":[["8e30445e.d77178"]]},{"id":"8e30445e.d77178","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.categories = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":4080,"wires":[["bccde8ad.45bab8"]]},{"id":"fb993270.f4d57","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.picture_id,\n    category_id: msg.category_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":4760,"wires":[["832a1749.e51078"]]},{"id":"832a1749.e51078","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":950,"y":4760,"wires":[["1e994cbb.e38063","ae60079f.06a418"]]},{"id":"33032d6b.547f42","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.state.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":4920,"wires":[["bc66f23e.35b53"]]},{"id":"55b0b333.ddab7c","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.category_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":4760,"wires":[["fb993270.f4d57"]]},{"id":"ae60079f.06a418","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":4700,"wires":[]},{"id":"6219f818.94dd08","type":"function","z":"fa8df506.b0c4c8","name":"set state","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {  \n    chat_id: msg.chat_id,\n    settings: {\n    picture_id: msg.picture_id,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":4860,"wires":[["2e9bf617.cd8b6a","d5bf5ae2.0938e8"]]},{"id":"2e9bf617.cd8b6a","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":4860,"wires":[[]]},{"id":"70927703.50b0a8","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":4600,"wires":[]},{"id":"77628fcd.8815b","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":4600,"wires":[]},{"id":"d5bf5ae2.0938e8","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1970,"y":4820,"wires":[]},{"id":"93895a99.6b18c8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4800,"wires":[["aa1b18e9.93bf08"]]},{"id":"651cc60c.606888","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/getFile\";\nmsg.method = \"GET\";\nmsg.payload = {\n    file_id: msg.text,\n    //url: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":4800,"wires":[["93895a99.6b18c8"]]},{"id":"bb995c9a.5ddd5","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":4800,"wires":[["24c9b65d.be8ffa"]]},{"id":"aa1b18e9.93bf08","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.picture_id,\n    externalPictureUrl: \"https://api.telegram.org/file/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/\"+msg.payload.result.file_path,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":4800,"wires":[["bb995c9a.5ddd5"]]},{"id":"a06105a9.1e1728","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.picture_id,\n    description: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":4840,"wires":[["c1fdc9cc.b56048"]]},{"id":"c1fdc9cc.b56048","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4840,"wires":[["af5be599.833db8"]]},{"id":"616892af.a31e8c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":4880,"wires":[["a9abd60a.afd638"]]},{"id":"a8a383f8.98206","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.size = msg.text.split(\"-\");\nmsg.payload = {\n    id: msg.picture_id,\n    //height: msg.text.split('-')[0],\n    //width: msg.text.split('-')[1]\n    height: msg.size[0],\n    width: msg.size[1]\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":4880,"wires":[["616892af.a31e8c"]]},{"id":"1f3e97db.bd6e38","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":4920,"wires":[["ce674532.2f92d8"]]},{"id":"b4a92f67.13cff","type":"function","z":"fa8df506.b0c4c8","name":"","func":"let text = msg.text;\n\n//text = text.replace(/\\s/g, '');\n\ntext = text.replace(/# /g, \"#\");\n\ntext = text.replace(',', \"\");\n\nif(text[0] == '#') {\ntext = text.substring(1, text.length);\nconsole.log(text);\n}\n\nmsg.hashtags = text.split('#');\n\nreturn msg;\n//msg.picture.hashtags = msg.picture.hashtags.replace(/# /g, \"#\");","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":4920,"wires":[["d6bd74fa.7e75c8"]]},{"id":"d6bd74fa.7e75c8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/hashtags\";\nmsg.method = \"POST\";\nmsg.payload = {\n  picture_id: msg.picture_id, \n  hashtags: msg.hashtags,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":4920,"wires":[["1f3e97db.bd6e38"]]},{"id":"1ebe749f.71846b","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":630,"y":4920,"wires":[["b4a92f67.13cff"]]},{"id":"29345762.599938","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/hashtags/${msg.picture_id}`;\nmsg.method = \"DELETE\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":4920,"wires":[["1ebe749f.71846b"]]},{"id":"6846a0d9.ba942","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3002/picture\";\nmsg.method = \"POST\";\nmsg.payload = {\n    id: msg.picture_id,\n    name: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":4960,"wires":[["fbfee4ee.86d6d8"]]},{"id":"fbfee4ee.86d6d8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":730,"y":4960,"wires":[["32faae03.108442"]]},{"id":"69b4bc3.6b08444","type":"function","z":"1783749d.eafb2b","name":"helloBuyer","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloBuyer\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":1640,"wires":[["af1b9ee0.f3ffa"]]},{"id":"af1b9ee0.f3ffa","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":1640,"wires":[["28471402.59576c"]]},{"id":"28471402.59576c","type":"function","z":"1783749d.eafb2b","name":"helloBuyerStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"helloBuyerStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":1640,"wires":[["b1374419.408428"]]},{"id":"b1374419.408428","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1390,"y":1640,"wires":[["e871ba2f.ea7308"]]},{"id":"e871ba2f.ea7308","type":"function","z":"1783749d.eafb2b","name":"buyerMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":1640,"wires":[["a31641c5.cdc3e"]]},{"id":"a31641c5.cdc3e","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1730,"y":1640,"wires":[[]]},{"id":"1ca05b34.69ac55","type":"switch","z":"912e5aba.30c308","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"searchPictures","vt":"str"},{"t":"eq","v":"searchByArtist","vt":"str"},{"t":"eq","v":"searchByCategory","vt":"str"},{"t":"eq","v":"searchBySize","vt":"str"},{"t":"eq","v":"searchByHashtag","vt":"str"},{"t":"cont","v":"categIdSPic","vt":"str"},{"t":"cont","v":"artistIdSPic","vt":"str"},{"t":"eq","v":"nextPicture","vt":"str"},{"t":"eq","v":"backPicture","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":280,"y":340,"wires":[["27eca22a.0f93ae"],["a0a076b2.f87148"],["7cf19e50.77688"],["2146f80a.b0fb68"],["2a061b8a.b729c4"],["4a598e07.47a9e"],["9bd95a10.97faa8"],["1808d769.cc0e69"],["15307d76.51bab3"],[]]},{"id":"fd6c629d.9ec2b","type":"comment","z":"912e5aba.30c308","name":"пошук картин","info":"","x":430,"y":140,"wires":[]},{"id":"663a45dc.a1dbdc","type":"link in","z":"912e5aba.30c308","name":"","links":["c2276917.ed4488"],"x":175,"y":340,"wires":[["1ca05b34.69ac55","ad9bc84a.064188"]]},{"id":"27eca22a.0f93ae","type":"function","z":"912e5aba.30c308","name":"buyerSerchPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSerchPictures\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":180,"wires":[["2a8404d4.4a95fc"]]},{"id":"2a8404d4.4a95fc","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":630,"y":180,"wires":[[]]},{"id":"c2276917.ed4488","type":"link out","z":"1783749d.eafb2b","name":"searchPictures","links":["663a45dc.a1dbdc"],"x":600,"y":1680,"wires":[],"l":true},{"id":"a4635a2.ac913a8","type":"function","z":"912e5aba.30c308","name":"buyerSearchPicturesByArtist","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchPicturesByArtist\",\n    templateVars: {\n        artists: msg.artists,\n    }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":220,"wires":[["ce7c875b.867798"]]},{"id":"ce7c875b.867798","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1570,"y":220,"wires":[[]]},{"id":"72ffd14e.3a20a","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":570,"y":220,"wires":[["359b707a.a9e1d"]]},{"id":"a0a076b2.f87148","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/artists\";\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":220,"wires":[["72ffd14e.3a20a"]]},{"id":"359b707a.a9e1d","type":"function","z":"912e5aba.30c308","name":"","func":"msg.artist_ids = msg.payload.map(artist => artist.artist_id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":220,"wires":[["18beb2f6.7de5ed"]]},{"id":"7a961b28.465af4","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1010,"y":220,"wires":[["4738144a.d9e0fc"]]},{"id":"18beb2f6.7de5ed","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/findUsers\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.artist_ids,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":220,"wires":[["7a961b28.465af4"]]},{"id":"4738144a.d9e0fc","type":"function","z":"912e5aba.30c308","name":"","func":"msg.artists = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":220,"wires":[["a4635a2.ac913a8"]]},{"id":"8c049c1e.be41d","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":580,"wires":[["7a39e21.f50421c"]]},{"id":"9bd95a10.97faa8","type":"function","z":"912e5aba.30c308","name":"","func":"msg.artist_id = msg.text.split('_')[1];\nmsg.url = `http://localhost:3002/picture?artist_id=${msg.artist_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":580,"wires":[["8c049c1e.be41d","a6f7eb41.adad18"]]},{"id":"7a39e21.f50421c","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":580,"wires":[["189afbd5.4d1284"]]},{"id":"189afbd5.4d1284","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":580,"wires":[["4438b745.997cc8","eed934d4.a3b8c8"]]},{"id":"4438b745.997cc8","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":580,"wires":[["ed7162c7.d34e3"]]},{"id":"ed7162c7.d34e3","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byArtistSearchType,\n        artist_id: msg.artist_id,\n    }\n};\nmsg.settings.searchType = msg.byArtistSearchType;\nmsg.settings.artist_id = msg.artist_id;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":580,"wires":[["3f9cb555.a9a1ca"]]},{"id":"3f9cb555.a9a1ca","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":580,"wires":[["d3ef7f93.45355"]]},{"id":"31b47f62.f2bb6","type":"switch","z":"1783749d.eafb2b","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"regex","v":"((\\+38)?\\(?\\d{3}\\)?[\\s\\.-]?(\\d{7}|\\d{3}[\\s\\.-]\\d{2}[\\s\\.-]\\d{2}|\\d{3}-\\d{4}))","vt":"str","case":false},{"t":"eq","v":"uk","vt":"str"},{"t":"eq","v":"ru","vt":"str"},{"t":"eq","v":"en","vt":"str"},{"t":"eq","v":"artist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"buyerSettings","vt":"str"},{"t":"cont","v":"advertising_","vt":"str"},{"t":"eq","v":"artistSettings","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":11,"x":240,"y":560,"wires":[["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["ad02562f.1c5ba8"],["8c8283a.da5838"],["ad02562f.1c5ba8"],["23c4310d.2a6c1e","5ad037ad.f4a888"]]},{"id":"e63558d7.6e07f8","type":"link in","z":"39fed9a2.d496c6","name":"","links":["ad02562f.1c5ba8"],"x":155,"y":240,"wires":[["25633c5b.d685c4"]]},{"id":"ca02d2c1.52af7","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":180,"wires":[[]]},{"id":"fa638d24.eff4d","type":"function","z":"39fed9a2.d496c6","name":"startNumberMessage","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    templateName: \"startNumberMessage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":180,"wires":[["ca02d2c1.52af7"]]},{"id":"e4a6b9a9.ab55c8","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":260,"wires":[["8cabd09.1ba593"]]},{"id":"8d374b28.57aa98","type":"function","z":"39fed9a2.d496c6","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":260,"wires":[["e4a6b9a9.ab55c8"]]},{"id":"2f2d0d0a.74af92","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":260,"wires":[[]]},{"id":"8cabd09.1ba593","type":"function","z":"39fed9a2.d496c6","name":"chooseWhoAreYou","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.text,\n    templateName: \"chooseWhoAreYou\"\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":260,"wires":[["2f2d0d0a.74af92"]]},{"id":"3ec0de33.103aa2","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":750,"y":220,"wires":[["4eba21f1.df8ce"]]},{"id":"2550ea27.8fd336","type":"function","z":"39fed9a2.d496c6","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    phone: msg.text,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":220,"wires":[["3ec0de33.103aa2"]]},{"id":"4eba21f1.df8ce","type":"function","z":"39fed9a2.d496c6","name":"succesRegistration","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"succesRegistration\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":220,"wires":[["d491a55.46e7758"]]},{"id":"d491a55.46e7758","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":220,"wires":[["cb6bb22b.8a1"]]},{"id":"da4d9533.a2d138","type":"function","z":"39fed9a2.d496c6","name":"chooseLanguage","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"chooseLanguage\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1810,"y":220,"wires":[["48cf5a8.0b95ea4"]]},{"id":"48cf5a8.0b95ea4","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1990,"y":220,"wires":[[]]},{"id":"cb6bb22b.8a1","type":"function","z":"39fed9a2.d496c6","name":"succesRegistrationStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    //lang: msg.lang,\n    templateName: \"succesRegistrationStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1390,"y":220,"wires":[["3f05a9e2.860da6"]]},{"id":"3f05a9e2.860da6","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1610,"y":220,"wires":[["da4d9533.a2d138"]]},{"id":"ad02562f.1c5ba8","type":"link out","z":"1783749d.eafb2b","name":"","links":["e63558d7.6e07f8"],"x":385,"y":480,"wires":[]},{"id":"25633c5b.d685c4","type":"switch","z":"39fed9a2.d496c6","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"/start","vt":"str"},{"t":"regex","v":"((\\+38)?\\(?\\d{3}\\)?[\\s\\.-]?(\\d{7}|\\d{3}[\\s\\.-]\\d{2}[\\s\\.-]\\d{2}|\\d{3}-\\d{4}))","vt":"str","case":false},{"t":"eq","v":"uk","vt":"str"},{"t":"eq","v":"ru","vt":"str"},{"t":"eq","v":"en","vt":"str"},{"t":"eq","v":"artist","vt":"str"},{"t":"eq","v":"buyer","vt":"str"},{"t":"eq","v":"buyerSettings","vt":"str"},{"t":"eq","v":"artistSettings","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":310,"y":240,"wires":[["fa638d24.eff4d"],["2550ea27.8fd336"],["8d374b28.57aa98"],["8d374b28.57aa98"],["8d374b28.57aa98"],["19bb69a.09d6a96"],["4778b79e.6eca28"],["1253a320.22302d","2043dd41.036552"],["9ad54667.004098"]]},{"id":"4778b79e.6eca28","type":"link out","z":"39fed9a2.d496c6","name":"buyer","links":["384b6fb5.0479c"],"x":470,"y":340,"wires":[],"l":true},{"id":"19bb69a.09d6a96","type":"link out","z":"39fed9a2.d496c6","name":"artist","links":["f7c02347.e7edd"],"x":470,"y":300,"wires":[],"l":true},{"id":"f7c02347.e7edd","type":"link in","z":"1783749d.eafb2b","name":"","links":["19bb69a.09d6a96","bf5cc3dd.098d1"],"x":1035,"y":460,"wires":[["d846730.da3099"]]},{"id":"a6f7eb41.adad18","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":620,"wires":[]},{"id":"eed934d4.a3b8c8","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":620,"wires":[]},{"id":"1808d769.cc0e69","type":"function","z":"912e5aba.30c308","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = `http://localhost:3002/picture?artist_id=${msg.settings.artist_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = `http://localhost:3002/picture?category_id=${msg.settings.category_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = `http://localhost:3002/findPicturesByHistory?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = `http://localhost:3002/findPicturesByLiked?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = `http://localhost:3002/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = `http://localhost:3002/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":700,"wires":[["5ee32485.8340ec"]]},{"id":"5ee32485.8340ec","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":700,"wires":[["55694e27.afd4"]]},{"id":"55694e27.afd4","type":"function","z":"912e5aba.30c308","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = 1;\n} else {\n    msg.picture_index++;\n}\nif(msg.picture_index >= msg.numberOfArtistsPictures) {\n    msg.picture_index = 0;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":700,"wires":[["9828a6a7.9ac6c8"]]},{"id":"be795350.21b4c","type":"comment","z":"912e5aba.30c308","name":"3 ❤️ натискання кнопки \"далі\"","info":"","x":470,"y":660,"wires":[]},{"id":"54a21d.be005de4","type":"comment","z":"912e5aba.30c308","name":"4 ❤️ натискання кнопки \"назад\"","info":"","x":480,"y":740,"wires":[]},{"id":"9828a6a7.9ac6c8","type":"function","z":"912e5aba.30c308","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = `http://localhost:3002/picture?user_id=${msg.chat_id}&artist_id=${msg.settings.artist_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = `http://localhost:3002/picture?user_id=${msg.chat_id}&category_id=${msg.settings.category_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = `http://localhost:3002/findPicturesByHistory?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = `http://localhost:3002/findPicturesByLiked?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = `http://localhost:3002/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = `http://localhost:3002/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":700,"wires":[["f922a155.e54f1"]]},{"id":"f922a155.e54f1","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":990,"y":700,"wires":[["56a1fe70.00f04"]]},{"id":"56a1fe70.00f04","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0].Picture ? msg.payload[0].Picture : msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":700,"wires":[["4f95d0c2.ef9a5"]]},{"id":"15307d76.51bab3","type":"function","z":"912e5aba.30c308","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = `http://localhost:3002/picture?artist_id=${msg.settings.artist_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = `http://localhost:3002/picture?category_id=${msg.settings.category_id}&user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = `http://localhost:3002/findPicturesByHistory?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = `http://localhost:3002/findPicturesByLiked?user_id=${msg.chat_id}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = `http://localhost:3002/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = `http://localhost:3002/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":780,"wires":[["5405e42f.d4880c","b3ac50e4.d69c2"]]},{"id":"5405e42f.d4880c","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":780,"wires":[["ead38357.e1a18","9b766013.775ef"]]},{"id":"ead38357.e1a18","type":"function","z":"912e5aba.30c308","name":"","func":"msg.numberOfArtistsPictures = msg.payload.length;\nmsg.picture_index = msg.settings.picture_index;\nif(!msg.picture_index) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n} else {\n    msg.picture_index--;\n}\nif(msg.picture_index < 0) {\n    msg.picture_index = msg.numberOfArtistsPictures - 1;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":780,"wires":[["3bc12e97.ed0e82"]]},{"id":"3bc12e97.ed0e82","type":"function","z":"912e5aba.30c308","name":"","func":"msg.method = \"GET\";\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.url = `http://localhost:3002/picture?user_id=${msg.chat_id}&artist_id=${msg.settings.artist_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.url = `http://localhost:3002/picture?user_id=${msg.chat_id}&category_id=${msg.settings.category_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byHistorySearchType){\n    msg.url = `http://localhost:3002/findPicturesByHistory?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.byLikedSearchType){\n    msg.url = `http://localhost:3002/findPicturesByLiked?user_id=${msg.chat_id}&limit=1&offset=${msg.picture_index}`;\n}\nif(msg.settings.searchType == msg.bySizeSearchType){\n    msg.url = `http://localhost:3002/findPicturesBySize`;\n    msg.method = \"POST\";\n    msg.payload = {\n        minSize: msg.settings.minSize,\n        maxSize: msg.settings.maxSize,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.url = `http://localhost:3002/pictureByHashtags`;\n    msg.method = \"POST\";\n    msg.payload = {\n        hashtags: msg.settings.searchHashtags,\n        limit: 1,\n        offset: msg.picture_index,\n        user_id: msg.chat_id,\n    };\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":780,"wires":[["831c2487.4eadf8"]]},{"id":"831c2487.4eadf8","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":990,"y":780,"wires":[["4bec07e7.16b768","ce458545.d35f58"]]},{"id":"4bec07e7.16b768","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0].Picture ? msg.payload[0].Picture : msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":780,"wires":[["4f95d0c2.ef9a5"]]},{"id":"4f95d0c2.ef9a5","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: msg.picture_index,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":740,"wires":[["87b1839f.2840e","17331818.21ca18"]]},{"id":"87b1839f.2840e","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1470,"y":740,"wires":[["de19e5d9.45c988","a34131c3.4942f"]]},{"id":"17331818.21ca18","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":700,"wires":[]},{"id":"de19e5d9.45c988","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1490,"y":700,"wires":[]},{"id":"b3ac50e4.d69c2","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":820,"wires":[]},{"id":"9b766013.775ef","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":530,"y":820,"wires":[]},{"id":"ce458545.d35f58","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":970,"y":820,"wires":[]},{"id":"3222108d.aa268","type":"function","z":"912e5aba.30c308","name":"bayerSearchCategoryId","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"bayerSearchCategoryId\",\n    templateVars: {\n        categories: msg.categories,\n    }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":260,"wires":[["466d180f.7e4f38"]]},{"id":"466d180f.7e4f38","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":260,"wires":[[]]},{"id":"1d6686d3.360239","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":570,"y":260,"wires":[["3bd4d0b5.4c1d2"]]},{"id":"7cf19e50.77688","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/categories\";\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":260,"wires":[["1d6686d3.360239"]]},{"id":"3bd4d0b5.4c1d2","type":"function","z":"912e5aba.30c308","name":"","func":"msg.categories = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":260,"wires":[["3222108d.aa268"]]},{"id":"720693ef.a3edfc","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":500,"wires":[["5863bec1.211a6"]]},{"id":"4a598e07.47a9e","type":"function","z":"912e5aba.30c308","name":"","func":"msg.category_id = msg.text.split('_')[1];\nmsg.url = `http://localhost:3002/picture?category_id=${msg.category_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":500,"wires":[["720693ef.a3edfc","413335fe.5e260c"]]},{"id":"5863bec1.211a6","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":500,"wires":[["f195c3c7.6e5e5"]]},{"id":"f195c3c7.6e5e5","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\t   \n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":500,"wires":[["f06764b3.323378","1495c3c5.07a22c"]]},{"id":"f06764b3.323378","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":500,"wires":[["8545014.459af"]]},{"id":"8545014.459af","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byCategorySearchType,\n        category_id: msg.category_id,\n    }\n};\nmsg.settings.searchType = msg.byCategorySearchType;\nmsg.settings.category_id = msg.category_id;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":500,"wires":[["b7a8969f.8013a8"]]},{"id":"b7a8969f.8013a8","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":500,"wires":[["d6fcf2fc.e602e"]]},{"id":"413335fe.5e260c","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":540,"wires":[]},{"id":"1495c3c5.07a22c","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":540,"wires":[]},{"id":"2d5092f2.4d5d9e","type":"function","z":"fa8df506.b0c4c8","name":"changeTypeToArtistStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    //templateName: \"changeWhoAreYou\"\n    templateName: \"changeTypeToArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":660,"wires":[["79f0fd91.e9de24"]]},{"id":"79f0fd91.e9de24","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":870,"y":660,"wires":[["adf1336c.7b825"]]},{"id":"2571d69a.82d9ba","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":490,"y":660,"wires":[]},{"id":"5ad037ad.f4a888","type":"debug","z":"1783749d.eafb2b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":700,"wires":[]},{"id":"ad9bc84a.064188","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":164,"y":232,"wires":[]},{"id":"1253a320.22302d","type":"debug","z":"39fed9a2.d496c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":130,"y":400,"wires":[]},{"id":"2043dd41.036552","type":"function","z":"39fed9a2.d496c6","name":"changeTypeToArtistStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":380,"wires":[["a2894bb0.d4ef38"]]},{"id":"a2894bb0.d4ef38","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":380,"wires":[["3bbd7973.b3a016"]]},{"id":"3bbd7973.b3a016","type":"function","z":"39fed9a2.d496c6","name":"changeTypeToArtist","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToArtist\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":380,"wires":[["a9d31662.24fd48"]]},{"id":"a9d31662.24fd48","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":380,"wires":[[]]},{"id":"bf5cc3dd.098d1","type":"link out","z":"1783749d.eafb2b","name":"","links":["f7c02347.e7edd"],"x":475,"y":1660,"wires":[]},{"id":"9ad54667.004098","type":"function","z":"39fed9a2.d496c6","name":"changeTypeToArtistStiker","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToArtistStiker\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":420,"wires":[["968383c8.b7b69"]]},{"id":"968383c8.b7b69","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":420,"wires":[["1f6b4c27.5bb3b4"]]},{"id":"1f6b4c27.5bb3b4","type":"function","z":"39fed9a2.d496c6","name":"changeTypeToBuyer","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"changeTypeToBuyer\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":420,"wires":[["36f5377f.048388"]]},{"id":"36f5377f.048388","type":"http request","z":"39fed9a2.d496c6","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1050,"y":420,"wires":[[]]},{"id":"2804f051.68596","type":"function","z":"1783749d.eafb2b","name":"buyerMenu","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerMenu\"\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1840,"wires":[["d9b6edda.06f28"]]},{"id":"d9b6edda.06f28","type":"http request","z":"1783749d.eafb2b","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":770,"y":1840,"wires":[[]]},{"id":"2146f80a.b0fb68","type":"function","z":"912e5aba.30c308","name":"buyerSearchBySizeSetMin","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchBySizeSetMin\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":300,"wires":[["8f86522d.2daea"]]},{"id":"8f86522d.2daea","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":690,"y":300,"wires":[["ed21309d.5935c"]]},{"id":"ed21309d.5935c","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: 'inputMinSize',\n    settings: {\n        picture_index: 0,\n        searchType: msg.bySizeSearchType,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":300,"wires":[["3ba868a6.22f5a8"]]},{"id":"3ba868a6.22f5a8","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":300,"wires":[[]]},{"id":"c8fa8508.27bf58","type":"switch","z":"912e5aba.30c308","name":"state","property":"state","propertyType":"msg","rules":[{"t":"eq","v":"inputMinSize","vt":"str"},{"t":"eq","v":"inputMaxSize","vt":"str"},{"t":"eq","v":"inputSearchHashtags","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":240,"y":1060,"wires":[["83851953.987448"],["8ab1544a.382ba8"],["f4a0a56d.956908"]]},{"id":"d74b7bca.c3b548","type":"link in","z":"912e5aba.30c308","name":"","links":["cc1eae2b.810a9"],"x":115,"y":1060,"wires":[["c8fa8508.27bf58"]]},{"id":"cc1eae2b.810a9","type":"link out","z":"1783749d.eafb2b","name":"","links":["d74b7bca.c3b548"],"x":435,"y":1880,"wires":[]},{"id":"83851953.987448","type":"function","z":"912e5aba.30c308","name":"buyerSearchBySizeSetMax","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchBySizeSetMax\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1020,"wires":[["559ccc3d.65eca4"]]},{"id":"559ccc3d.65eca4","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":1020,"wires":[["eb11c27a.25e65"]]},{"id":"eb11c27a.25e65","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: 'inputMaxSize',\n    settings: {\n        picture_index: 0,\n        searchType: msg.bySizeSearchType,\n        searchMinSize: msg.text,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":1020,"wires":[["722df74.57f9b08"]]},{"id":"722df74.57f9b08","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":950,"y":1020,"wires":[[]]},{"id":"8ab1544a.382ba8","type":"function","z":"912e5aba.30c308","name":"","func":"msg.minSize = msg.settings.searchMinSize.split('-');\nmsg.maxSize = msg.text.split('-');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":1060,"wires":[["8280c7a2.bd2288"]]},{"id":"9b0f2c80.8e30c","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":1060,"wires":[["3d84035.ab779fc"]]},{"id":"8280c7a2.bd2288","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = `http://localhost:3002/findPicturesBySize`;\nmsg.method = \"POST\";\nmsg.payload = {\n    minSize: msg.minSize,\n    maxSize: msg.maxSize,\n    limit: 1,\n    user_id: msg.chat_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1060,"wires":[["9b0f2c80.8e30c"]]},{"id":"3d84035.ab779fc","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":1060,"wires":[["72ec77e7.f67538"]]},{"id":"72ec77e7.f67538","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":1060,"wires":[["9cefc3dc.1aa95"]]},{"id":"9cefc3dc.1aa95","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":1060,"wires":[["37fac1b4.ba0a8e"]]},{"id":"37fac1b4.ba0a8e","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.bySizeSearchType,\n        category_id: msg.category_id,\n        maxSize: msg.maxSize,\n        minSize: msg.minSize,\n    },\n};\nmsg.settings.searchType = msg.bySizeSearchType;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1060,"wires":[["b624ba3a.adb6e8"]]},{"id":"b624ba3a.adb6e8","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1470,"y":1060,"wires":[["c1b3afbe.a9feb"]]},{"id":"2a061b8a.b729c4","type":"function","z":"912e5aba.30c308","name":"buyerSearchByHashtag","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerSearchByHashtag\",\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":340,"wires":[["3947d46.dd0f12c"]]},{"id":"3947d46.dd0f12c","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":690,"y":340,"wires":[["582b3ae4.1a6684"]]},{"id":"582b3ae4.1a6684","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    state: 'inputSearchHashtags',\n    settings: {\n        picture_index: 0,\n        searchType: msg.byHashtagSearchType,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":340,"wires":[["b13e8fd5.528ce"]]},{"id":"b13e8fd5.528ce","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1030,"y":340,"wires":[[]]},{"id":"f4a0a56d.956908","type":"function","z":"912e5aba.30c308","name":"","func":"msg.text = msg.text.toLowerCase();\nmsg.hashtags = msg.text.replace(/\\s,./g, '');\nmsg.hashtags = msg.hashtags.split('#');\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":1100,"wires":[["5fb70fd6.62bb4","3890b5ef.79278a"]]},{"id":"976e9a33.7889c8","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":1100,"wires":[["c7b6338d.3cb58","3890b5ef.79278a"]]},{"id":"5fb70fd6.62bb4","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = `http://localhost:3002/pictureByHashtags`;\nmsg.method = \"POST\";\nmsg.payload = {\n    hashtags: msg.hashtags,\n    limit: 1,\n    user_id: msg.chat_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1100,"wires":[["976e9a33.7889c8","3890b5ef.79278a"]]},{"id":"c7b6338d.3cb58","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":1100,"wires":[["b84d397d.6822b8"]]},{"id":"b84d397d.6822b8","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":1100,"wires":[["1cb9d8c7.6921e7"]]},{"id":"1cb9d8c7.6921e7","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1170,"y":1100,"wires":[["1d47e374.49597d"]]},{"id":"1d47e374.49597d","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byHashtagSearchType,\n        category_id: msg.category_id,\n        searchHashtags: msg.hashtags,\n    },\n};\nmsg.settings.searchHashtags = msg.hashtags;\nmsg.settings.searchType = msg.byHashtagSearchType;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1100,"wires":[["8db52919.086f78"]]},{"id":"8db52919.086f78","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1470,"y":1100,"wires":[["7306755e.e9c80c"]]},{"id":"3890b5ef.79278a","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":1160,"wires":[]},{"id":"dfd6f580.8d7008","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2800,"y":760,"wires":[["23ee9674.df08ba","6d126f22.e7d31"]]},{"id":"23ee9674.df08ba","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2950,"y":760,"wires":[["7d9cd667.4273c8"]]},{"id":"6d126f22.e7d31","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2810,"y":720,"wires":[]},{"id":"7d9cd667.4273c8","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2970,"y":720,"wires":[]},{"id":"bee387c1.c05208","type":"switch","z":"912e5aba.30c308","name":"","property":"settings.searchType","propertyType":"msg","rules":[{"t":"eq","v":"byHashtagSearchType","vt":"msg"},{"t":"eq","v":"byArtistSearchType","vt":"msg"},{"t":"eq","v":"byCategorySearchType","vt":"msg"},{"t":"eq","v":"bySizeSearchType","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":2050,"y":740,"wires":[["a2270a40.974dc8"],["1ce1d2ae.4c8b3d"],["dfd6f580.8d7008"],["dfd6f580.8d7008"],[]]},{"id":"1ce1d2ae.4c8b3d","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.settings.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2180,"y":740,"wires":[["8ce2bab9.7ba298"]]},{"id":"8ce2bab9.7ba298","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2350,"y":740,"wires":[["6d37ed0e.66ff34"]]},{"id":"a2270a40.974dc8","type":"function","z":"912e5aba.30c308","name":"","func":"msg.Hashtags = msg.picture.Hashtags;\nmsg.searchHashtags = msg.settings.searchHashtags;\nmsg.searchHashtags = msg.searchHashtags.map(hashtag => hashtag.toLowerCase());\nmsg.Hashtags = msg.Hashtags.map(hashtag => ({\n    id: hashtag.id,\n    tag: hashtag.tag.toLowerCase(),\n}));\n\n\nmsg.hashtags_history_view_ids = msg.Hashtags.filter(hashtag => {\n    return msg.searchHashtags.includes(hashtag.tag);\n}).map(hashtag => hashtag.id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2400,"y":700,"wires":[["dfd6f580.8d7008"]]},{"id":"6d37ed0e.66ff34","type":"function","z":"912e5aba.30c308","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2520,"y":740,"wires":[["dfd6f580.8d7008"]]},{"id":"acb7c3fa.0c30b","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":580,"wires":[["611acb76.051c54","cbdc480d.167048"]]},{"id":"611acb76.051c54","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2190,"y":580,"wires":[["d1bfa8f7.213e08"]]},{"id":"cbdc480d.167048","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2050,"y":540,"wires":[]},{"id":"d1bfa8f7.213e08","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2210,"y":540,"wires":[]},{"id":"d3ef7f93.45355","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.settings.artist_id,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":580,"wires":[["b1868b67.fb33a8"]]},{"id":"b1868b67.fb33a8","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1710,"y":580,"wires":[["1df2a100.18d77f"]]},{"id":"1df2a100.18d77f","type":"function","z":"912e5aba.30c308","name":"","func":"msg.artist = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":580,"wires":[["acb7c3fa.0c30b"]]},{"id":"d6fcf2fc.e602e","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":500,"wires":[["d300e7e7.4cea58","98a9f53b.131bd8"]]},{"id":"d300e7e7.4cea58","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1690,"y":500,"wires":[["cade1503.236638"]]},{"id":"98a9f53b.131bd8","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1550,"y":460,"wires":[]},{"id":"cade1503.236638","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1710,"y":460,"wires":[]},{"id":"c1b3afbe.a9feb","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":1060,"wires":[["1b7adc85.748e43","f9d94e46.26c6e"]]},{"id":"1b7adc85.748e43","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1790,"y":1060,"wires":[["3074f5a6.7db71a"]]},{"id":"f9d94e46.26c6e","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1650,"y":1020,"wires":[]},{"id":"3074f5a6.7db71a","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1810,"y":1020,"wires":[]},{"id":"7306755e.e9c80c","type":"function","z":"912e5aba.30c308","name":"","func":"msg.Hashtags = msg.picture.Hashtags;\nmsg.searchHashtags = msg.settings.searchHashtags;\nmsg.searchHashtags = msg.searchHashtags.map(hashtag => hashtag.toLowerCase());\nmsg.Hashtags = msg.Hashtags.map(hashtag => ({\n    id: hashtag.id,\n    tag: hashtag.tag.toLowerCase(),\n}));\n\n\nmsg.hashtags_history_view_ids = msg.Hashtags.filter(hashtag => {\n    return msg.searchHashtags.includes(hashtag.tag);\n}).map(hashtag => hashtag.id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":1100,"wires":[["1eabbaa0.ccf5e5"]]},{"id":"1eabbaa0.ccf5e5","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/history\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    search_type: msg.settings.searchType,\n    picture_id: msg.picture.id,\n};\nif(msg.settings.searchType == msg.byHashtagSearchType){\n    msg.payload.hashtags_history_view_ids = msg.hashtags_history_view_ids;\n}\nif(msg.settings.searchType == msg.byArtistSearchType){\n    msg.payload.nickname = msg.artist.nickname;\n}\nif(msg.settings.searchType == msg.byCategorySearchType){\n    msg.payload.category_id = msg.settings.category_id;\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1760,"y":1100,"wires":[["1f60beef.0fb711","9bd4bded.56b53"]]},{"id":"9bd4bded.56b53","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1770,"y":1140,"wires":[]},{"id":"f3a3bced.c64e4","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1930,"y":1140,"wires":[]},{"id":"1f60beef.0fb711","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1910,"y":1100,"wires":[["f3a3bced.c64e4"]]},{"id":"5938d60c.47dcb8","type":"switch","z":"912e5aba.30c308","name":"","property":"text","propertyType":"msg","rules":[{"t":"eq","v":"viewHistory","vt":"str"},{"t":"eq","v":"viewLiked","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":1340,"wires":[["a686fc50.097cf"],["19ed26e9.6a6009"]]},{"id":"8b9271d5.ff217","type":"link in","z":"912e5aba.30c308","name":"","links":["886d8ced.eca4e"],"x":115,"y":1340,"wires":[["5938d60c.47dcb8"]]},{"id":"886d8ced.eca4e","type":"link out","z":"1783749d.eafb2b","name":"","links":["8b9271d5.ff217","5d43bcf3.5f73c4"],"x":535,"y":1720,"wires":[]},{"id":"a686fc50.097cf","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = `http://localhost:3002/findPicturesByHistory?user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":1300,"wires":[["484356a2.d261a8","bfc8f4e6.ff4238"]]},{"id":"bfc8f4e6.ff4238","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":1260,"wires":[]},{"id":"484356a2.d261a8","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":1300,"wires":[["b1ff408d.3732f"]]},{"id":"b1ff408d.3732f","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0].Picture;\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1300,"wires":[["c621fe7f.75074"]]},{"id":"c621fe7f.75074","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":1300,"wires":[["b3f8d01d.4a207","7ba67c19.764be4"]]},{"id":"7ba67c19.764be4","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":1260,"wires":[]},{"id":"b3f8d01d.4a207","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":1300,"wires":[["f10d6672.b64f78"]]},{"id":"f10d6672.b64f78","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byHistorySearchType,\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":1300,"wires":[["c206d302.24818"]]},{"id":"c206d302.24818","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":1300,"wires":[[]]},{"id":"2632517b.b4d71e","type":"switch","z":"912e5aba.30c308","name":"","property":"text","propertyType":"msg","rules":[{"t":"cont","v":"like","vt":"str"},{"t":"cont","v":"apply","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":1460,"wires":[["eee3af20.08c81"],["56bc858b.97eb9c"]]},{"id":"a724ff22.7d235","type":"link in","z":"912e5aba.30c308","name":"","links":["3cbed2f.51dda2e"],"x":95,"y":1460,"wires":[["2632517b.b4d71e"]]},{"id":"3cbed2f.51dda2e","type":"link out","z":"1783749d.eafb2b","name":"","links":["a724ff22.7d235"],"x":515,"y":1860,"wires":[]},{"id":"eee3af20.08c81","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":1440,"wires":[["9f061d01.8aac6"]]},{"id":"9f061d01.8aac6","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3002/like\";\nmsg.method = \"POST\";\nmsg.payload = {\n    user_id: msg.chat_id,\n    picture_id: msg.picture_id,\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":1440,"wires":[["13021ee3.5bc941"]]},{"id":"13021ee3.5bc941","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":1440,"wires":[["a2e78ef0.7dc57"]]},{"id":"364a6089.dcf06","type":"function","z":"912e5aba.30c308","name":"buyerEditViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"buyerEditViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":1440,"wires":[["db6f3a0d.c7bfc8"]]},{"id":"db6f3a0d.c7bfc8","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1670,"y":1440,"wires":[[]]},{"id":"a2e78ef0.7dc57","type":"function","z":"912e5aba.30c308","name":"","func":"msg.like = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":1440,"wires":[["e68b93da.3ea73"]]},{"id":"e68b93da.3ea73","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = `http://localhost:3002/picture?id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":1440,"wires":[["f8f7d7f3.da0498"]]},{"id":"f8f7d7f3.da0498","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":1440,"wires":[["6ea7dc7b.f1e6d4"]]},{"id":"6ea7dc7b.f1e6d4","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":1440,"wires":[["364a6089.dcf06"]]},{"id":"a34131c3.4942f","type":"function","z":"912e5aba.30c308","name":"buyerEditViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"buyerEditViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":740,"wires":[["887220a6.4853a"]]},{"id":"887220a6.4853a","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1870,"y":740,"wires":[["bee387c1.c05208"]]},{"id":"c225a0ff.c3a43","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: msg.picture_index,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1400,"y":3040,"wires":[["c87d23aa.17bf9"]]},{"id":"c87d23aa.17bf9","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1550,"y":3040,"wires":[["4a4bca80.dc4dc4","39fd1489.cb3dac"]]},{"id":"4a4bca80.dc4dc4","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":3000,"wires":[]},{"id":"1c617942.e69fd7","type":"function","z":"fa8df506.b0c4c8","name":"artEditDeletePictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditDeletePictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":2940,"wires":[["4134c58d.ea333c"]]},{"id":"4134c58d.ea333c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":2940,"wires":[[]]},{"id":"c48058e6.49aad8","type":"switch","z":"fa8df506.b0c4c8","name":"","property":"settings.action","propertyType":"msg","rules":[{"t":"eq","v":"delete_picture_action","vt":"msg"},{"t":"eq","v":"edit_picture_action","vt":"msg"},{"t":"eq","v":"advertise_picture_action","vt":"msg"}],"checkall":"true","repair":false,"outputs":3,"x":1770,"y":3000,"wires":[["1c617942.e69fd7"],["951cd110.8bee3"],["889225f9.852798"]]},{"id":"951cd110.8bee3","type":"function","z":"fa8df506.b0c4c8","name":"artEditEditPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditEditPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":2980,"wires":[["6bb994d.921a46c"]]},{"id":"6bb994d.921a46c","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":2980,"wires":[[]]},{"id":"889225f9.852798","type":"function","z":"fa8df506.b0c4c8","name":"artEditAdvertisingAllPictures","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    message_id: msg.originalMessage.callback_query.message.message_id,\n    templateName: \"artEditAdvertisingAllPictures\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":3020,"wires":[["ea1ef3c9.dd02d"]]},{"id":"ea1ef3c9.dd02d","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2150,"y":3020,"wires":[["d6c372df.ad89d"]]},{"id":"19ed26e9.6a6009","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = `http://localhost:3002/findPicturesByLiked?user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":1360,"wires":[["45af2faf.145fa","8b6f474d.188278"]]},{"id":"8b6f474d.188278","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":1400,"wires":[]},{"id":"45af2faf.145fa","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":1360,"wires":[["48e0310c.f79d"]]},{"id":"48e0310c.f79d","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1360,"wires":[["18a1622c.c4530e"]]},{"id":"18a1622c.c4530e","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"buyerViewPicture\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n\t   liked: !!msg.picture.likes.length\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":1360,"wires":[["6737f3fa.c7668c","828193a5.ff4fb"]]},{"id":"828193a5.ff4fb","type":"debug","z":"912e5aba.30c308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":1400,"wires":[]},{"id":"6737f3fa.c7668c","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1070,"y":1360,"wires":[["c9dc2c59.0aa15"]]},{"id":"c9dc2c59.0aa15","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3001/user\";\nmsg.method = \"POST\";\nmsg.payload = {\n    chat_id: msg.chat_id,\n    settings: {\n        picture_index: 0,\n        searchType: msg.byLikedSearchType,\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":1360,"wires":[["706845bd.97326c"]]},{"id":"706845bd.97326c","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1370,"y":1360,"wires":[[]]},{"id":"6e60b974.fe09b8","type":"function","z":"912e5aba.30c308","name":"buyerViewPicture","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: msg.lang,\n    templateName: \"applicationWasSent\",\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1480,"wires":[["cff3feb7.dc333"]]},{"id":"cff3feb7.dc333","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":1480,"wires":[["5e30d698.78da58"]]},{"id":"56bc858b.97eb9c","type":"function","z":"912e5aba.30c308","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":1480,"wires":[["6e60b974.fe09b8"]]},{"id":"5e30d698.78da58","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = `http://localhost:3002/picture?id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":1480,"wires":[["f5ae99ce.5cca08"]]},{"id":"f5ae99ce.5cca08","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1010,"y":1480,"wires":[["f1066411.5baa18"]]},{"id":"f1066411.5baa18","type":"function","z":"912e5aba.30c308","name":"notificationToAstistAboutApplying","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.payload[0].artist_id,\n    lang: msg.lang,\n    templateName: \"notificationToAstistAboutApplying\",\n    templateVars: {\n        user_login: msg.originalMessage.callback_query.from.username,\n        picture_name: msg.payload[0].name,\n\t }\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":1480,"wires":[["bc20666b.b1add8"]]},{"id":"bc20666b.b1add8","type":"http request","z":"912e5aba.30c308","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1490,"y":1480,"wires":[[]]},{"id":"5da31a63.2b6334","type":"switch","z":"116704c1.2aeebb","name":"","property":"payload.pre_checkout_query","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":120,"wires":[["17a4e9a4.745956"],["23f22653.75568a"]]},{"id":"17a4e9a4.745956","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.url = `https://api.telegram.org/bot1642349293:AAFs_rRylHYO5VWf0uJe-A897aBfjtoJdu8/answerPreCheckoutQuery`\nmsg.payload = {\n    \"pre_checkout_query_id\": msg.payload.pre_checkout_query.id,\n    \"ok\": \"true\",\n    \"error_message\": \"\"\n};\nmsg.method = 'POST';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":100,"wires":[["8deabff7.aa91e"]]},{"id":"8deabff7.aa91e","type":"http request","z":"116704c1.2aeebb","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":730,"y":100,"wires":[[]]},{"id":"38679434.19347c","type":"comment","z":"1783749d.eafb2b","name":"сюди оплата зайшла","info":"","x":2120,"y":880,"wires":[]},{"id":"1073d68.f07782a","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":900,"y":3920,"wires":[]},{"id":"9e674328.47b8f","type":"mqtt out","z":"116704c1.2aeebb","name":"","topic":"","qos":"0","retain":"false","broker":"a36dcb58.d4ef28","x":390,"y":420,"wires":[]},{"id":"2e5ade45.352052","type":"inject","z":"116704c1.2aeebb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"advertising","payload":"","payloadType":"date","x":160,"y":420,"wires":[["9e674328.47b8f"]]},{"id":"3c9c78b5.d9ce28","type":"link in","z":"fa8df506.b0c4c8","name":"","links":["9461190b.bf0578","8c8283a.da5838"],"x":3025,"y":360,"wires":[["de9ca453.fca768"]]},{"id":"de9ca453.fca768","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture_id = msg.text.split('_')[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3140,"y":360,"wires":[["b10398f4.2743b8"]]},{"id":"b4e1fe90.84315","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3001/findUsers`;\nmsg.method = \"POST\";\nmsg.payload = {\n    type: msg.buyerType\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":360,"wires":[["4db84ac7.a3fa24","b4a48455.a557e8"]]},{"id":"4db84ac7.a3fa24","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3870,"y":360,"wires":[["61d7df81.aa02a","842c19d9.f5c2f8"]]},{"id":"61d7df81.aa02a","type":"split","z":"fa8df506.b0c4c8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":4030,"y":360,"wires":[["48ccb3fd.2ae8dc","b94cc659.6e9a78"]]},{"id":"5b17ea23.1625a4","type":"mqtt out","z":"fa8df506.b0c4c8","name":"","topic":"","qos":"0","retain":"false","broker":"a36dcb58.d4ef28","x":4330,"y":360,"wires":[]},{"id":"48ccb3fd.2ae8dc","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.topic = \"advertising\";\nmsg.payload = {\n    chat_id: msg.payload.chat_id,\n    lang: msg.payload.lang,\n    nickname: msg.payload.nickname,\n    picture: msg.picture,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4180,"y":360,"wires":[["5b17ea23.1625a4"]]},{"id":"b94cc659.6e9a78","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4160,"y":280,"wires":[]},{"id":"3002c993.917f46","type":"inject","z":"116704c1.2aeebb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":240,"wires":[["e18b3517.2e8668"]]},{"id":"e18b3517.2e8668","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.payload = {\n    \"update_id\": 642369448,\n    \"message\": {\n        \"message_id\": 5492,\n        \"from\": {\n            \"id\": 467013671,\n            \"is_bot\": false,\n            \"first_name\": \"Ірина\",\n            \"last_name\": \"Макар\",\n            \"username\": \"makarova_16\",\n            \"language_code\": \"uk\"\n        },\n        \"chat\": {\n            \"id\": 467013671,\n            \"first_name\": \"Ірина\",\n            \"last_name\": \"Макар\",\n            \"username\": \"makarova_16\",\n            \"type\": \"private\"\n        },\n        \"date\": 1616356947,\n        \"successful_payment\": {\n            \"currency\": \"UAH\",\n            \"total_amount\": 100,\n            \"invoice_payload\": \"advertising_52\",\n            \"telegram_payment_charge_id\": \"_\",\n            \"provider_payment_charge_id\": \"1597733822\"\n        }\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":240,"wires":[["5da31a63.2b6334"]]},{"id":"842c19d9.f5c2f8","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3940,"y":260,"wires":[]},{"id":"b4a48455.a557e8","type":"debug","z":"fa8df506.b0c4c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3790,"y":260,"wires":[]},{"id":"8c8283a.da5838","type":"link out","z":"1783749d.eafb2b","name":"","links":["3c9c78b5.d9ce28"],"x":395,"y":520,"wires":[]},{"id":"b10398f4.2743b8","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.url = `http://localhost:3002/picture?id=${msg.picture_id}&user_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3280,"y":360,"wires":[["9025a901.867cf8"]]},{"id":"9025a901.867cf8","type":"http request","z":"fa8df506.b0c4c8","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3430,"y":360,"wires":[["28a6f9c3.1bb156"]]},{"id":"28a6f9c3.1bb156","type":"function","z":"fa8df506.b0c4c8","name":"","func":"msg.picture = msg.payload[0];\nif(msg.picture.Hashtags.length) {\n    msg.picture.hashtags = msg.picture.Hashtags.map(Hashtag => Hashtag.tag).join(' #');\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3580,"y":360,"wires":[["b4e1fe90.84315"]]},{"id":"3d6b89ca.f31ac6","type":"mqtt in","z":"912e5aba.30c308","name":"","topic":"advertising","qos":"2","datatype":"auto","broker":"a36dcb58.d4ef28","x":160,"y":1800,"wires":[["21fa7e62.b3e0c2"]]},{"id":"21fa7e62.b3e0c2","type":"function","z":"912e5aba.30c308","name":"","func":"msg.payload = JSON.parse(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":1800,"wires":[["fae681ab.49bc7"]]},{"id":"fae681ab.49bc7","type":"function","z":"912e5aba.30c308","name":"","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\n\nmsg.picture = msg.payload.picture;\n\nmsg.payload = {\n    chat_id: msg.payload.chat_id,\n    lang: msg.payload.lang,\n    templateName: \"advertisingPictureMessage\",\n    templateVars: {\n\t   name: msg.picture.name,\n\t   description: msg.picture.description,\n\t   height:msg.picture.height,\n\t   width:msg.picture.width,\n\t   nickname: msg.payload.nickname,\n\t   hashtags: msg.picture.hashtags ? \"#\"+msg.picture.hashtags : '',\n\t   photoUrl:msg.picture.url,\n\t   picture_id: msg.picture.id,\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":1800,"wires":[["72b13cee.4794b4"]]},{"id":"72b13cee.4794b4","type":"http request","z":"912e5aba.30c308","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":1800,"wires":[[]]},{"id":"1859760f.d5eb6a","type":"inject","z":"116704c1.2aeebb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":560,"wires":[["a6dd0ec0.a7884"]]},{"id":"4388818e.716ba","type":"http request","z":"116704c1.2aeebb","name":"","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":610,"y":560,"wires":[["f3bee051.5268","585e5075.a6984"]]},{"id":"f3bee051.5268","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.statistic = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":560,"wires":[["999bf253.c1fb6","2b16d97a.9e1896"]]},{"id":"999bf253.c1fb6","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":520,"wires":[]},{"id":"da81d173.7c325","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.url = `http://localhost:3002/getTotalStatisticByArtist?artist_id=${msg.chat_id}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":560,"wires":[["fc851579.3cd548","4388818e.716ba"]]},{"id":"fc851579.3cd548","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":520,"wires":[]},{"id":"585e5075.a6984","type":"debug","z":"116704c1.2aeebb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":520,"wires":[]},{"id":"a6dd0ec0.a7884","type":"function","z":"116704c1.2aeebb","name":"","func":"msg.chat_id = 467013671;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":560,"wires":[["da81d173.7c325"]]},{"id":"2b16d97a.9e1896","type":"function","z":"116704c1.2aeebb","name":"showStatisticByArtist","func":"msg.url = \"http://localhost:3000/sendMessage\";\nmsg.method = \"POST\";\nmsg.type = msg.payload.type;\nmsg.payload = {\n    chat_id: msg.chat_id,\n    lang: 'uk',\n    templateName: \"showStatisticByArtist\",\n    templateVars: msg.statistic\n    \n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":560,"wires":[["da817697.f37188"]]},{"id":"da817697.f37188","type":"http request","z":"116704c1.2aeebb","name":"","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":560,"wires":[[]]}]